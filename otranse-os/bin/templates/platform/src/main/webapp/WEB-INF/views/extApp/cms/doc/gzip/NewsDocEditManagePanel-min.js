if(typeof Global==="undefined"){Global={}}Global.mySendDocOrgDirLoader=new Disco.Ext.MemoryTreeLoader({iconCls:"disco-tree-node-icon",varName:"Global.MY_SEND_DOC_ORG_LOADER",url:"newsDir.java?cmd=getDirTreeByCurrentUserOrg&pageSize=-1&treeData=true&all=false&orgdir=true",listeners:{beforeload:function(b,a){b.baseParams.id=(a.id.indexOf("root")<0?a.id:"");if(typeof a.attributes.checked!=="undefined"){b.baseParams.checked=false}}}});Global.mySendDocBranchDirLoader=new Disco.Ext.MemoryTreeLoader({iconCls:"disco-tree-node-icon",varName:"Global.MY_SEND_DOC_BRANCH_DIR_LOADER",url:"newsDir.java?cmd=getBranchDirTree&pageSize=-1&treeData=true&all=false&orgType=null",listeners:{beforeload:function(b,a){b.baseParams.id=(a.id.indexOf("root")<0?a.id:"");if(typeof a.attributes.checked!=="undefined"){b.baseParams.checked=false}}}});NewsDocEditManagePanel=Ext.extend(Ext.Window,{modal:true,shim:false,width:900,height:620,title:"\u93c2\u56e9\u73f7\u7ee0\uff04\u608a1",closable:false,maximizable:false,minimizable:false,border:false,buttonAlign:"center",baseUrl:"newsDoc.java",tempCookie:{dir:null},initComponent:function(){this.buttons=this.createButtons();NewsDocEditManagePanel.superclass.initComponent.call(this);this.buildFormItems()},buildFormItems:function(){this.fp=this.createFormPanel();this.add(this.fp)},createButtons:function(){var b="\u95ab\u4f78\ue178";var a=Global.getCurrentUser;if(a.types==2||a.types==5){b="\u9359\u621d\u7af7"}var c=false;return[{scope:this,text:b,iconCls:"save",handler:this.submitSaveDoc},{scope:this,text:"\u93c6\u509a\u74e8",hidden:c,iconCls:"clean",handler:this.storageDoc},{scope:this,text:"\u9359\u6828\u79f7",iconCls:"delete",handler:function(){this.hide()}}]},submitSaveDoc:function(){this.beforeFormSubmit("save")},storageDoc:function(){this.beforeFormSubmit("storage")},beforeFormSubmit:function(f){var a=Disco.Ext.CrudFunction.validateForm(this.fp.form);if(!a){return false}var e=this.fp.form.findField("id").getValue();f=(f=="storage")?f:(e?"update":"save");var c=this.baseUrl;var d=this.fp.form.findField("cmd");if(d==null){this.fp.add({name:"cmd",value:f,xtype:"hidden"});this.fp.doLayout()}else{d.setValue(f)}Disco.Ext.Util.submitForm(this.fp.form,this.baseUrl+"?cmd="+f,function(b,g){this.fp.form.clearData();this.fp.form.reset();this.fp.form.isValid();this.hide();this.refurbishParentGrid()},this)},refurbishParentGrid:function(){},createFormPanel:function(){var a=new Ext.form.FormPanel({frame:true,labelWidth:70,fileUpload:true,autoScroll:true,labelAlign:"right",defaults:{xtype:"textfield"},items:[{name:"id",xtype:"hidden"},{width:780,name:"title",emptyText:"\u93c2\u56e9\u73f7\u93cd\u56ec\ue57d",fieldLabel:"\u93c2\u56e9\u73f7\u93cd\u56ec\ue57d",allowBlank:false,blankText:"\u93c2\u56e9\u73f7\u93cd\u56ec\ue57d\u6d93\u5d88\u5158\u6d93\u8679\u2516"},{width:780,name:"keywords",emptyText:"\u93c2\u56e9\u73f7\u7ee0\ufffd\u942d\ue15f\u7223\u68f0\u6a3a\u6e6a30\u6d93\ue044\u74e7\u7ed7\ufe40\u5534",fieldLabel:"\u7ee0\ufffd\u942d\ue15f\u7223\u68f0\ufffd"},{width:780,name:"iconPath",emptyText:"\u93c2\u56e9\u73f7\u7035\u7470\u7c32\u9428\u52eb\u3054\u93c9\u2033\u6d58\u9417\u5626RL\u9366\u677f\u6f43",fieldLabel:"\u6fb6\u5b58\u6f6f\u9365\u5267\u5896"},Disco.Ext.Util.columnPanelBuild({columnWidth:0.3,items:{name:"author",fieldLabel:"\u6d63\u6ec6\ufffd\ufffd",allowBlank:false,blankText:"\u6d63\u6ec6\ufffd\u546c\u7b09\u9473\u6212\u8d1f\u7ecc\ufffd"}},{columnWidth:0.3,items:{name:"source",fieldLabel:"\u93c9\u30e6\u7c2e"}},{columnWidth:0.4,items:{name:"putDate",anchor:"93.8%",editable:false,format:"Y-m-d G:i",xtype:"datefield",value:new Date(),fieldLabel:"\u93be\u626e\u01f9\u93c3\u30e6\u6e61"}}),Disco.Ext.Util.columnPanelBuild({columnWidth:0.3,items:{name:"dir",allowBlank:false,blankText:"\u93c2\u56e9\u73f7\u93cd\u5fd5\u6d30\u6d93\u5d88\u5158\u6d93\u8679\u2516",fieldLabel:"\u93c2\u56e9\u73f7\u93cd\u5fd5\u6d30",xtype:"treecombo",valueField:"id",hiddenName:"dirId",displayField:"title",tree:new Ext.tree.TreePanel({autoScroll:true,root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u93b5\ufffd\u93c8\u590b\u722e\u9429\ufffd",expanded:true,iconCls:"treeroot-icon",loader:Global.mySendDocOrgDirLoader})})}},{columnWidth:0.3,items:{name:"toBranch",xtype:"checkbox",inputValue:1,fieldLabel:"\u9359\u621d\u7af7\u9352\u677f\u578e\u741b\ufffd",listeners:{scope:this,check:function(f,e){var g=this.fp.getForm().findField("branchDir");if(e){g.setDisabled(false)}else{g.setDisabled(true)}}}}},{columnWidth:0.4,items:{disabled:true,allowBlank:false,fieldLabel:"\u9352\u55da\ue511\u93cd\u5fd5\u6d30",name:"branchDir",xtype:"treecombo",hiddenName:"branchDirId",displayField:"title",valueField:"id",tree:new Ext.tree.TreePanel({autoScroll:true,root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u93b5\ufffd\u93c8\u590b\u722e\u9429\ufffd",expanded:true,iconCls:"treeroot-icon",loader:Global.mySendDocBranchDirLoader})})}}),{width:880,height:395,margins:{left:10},hideLabel:true,name:"content",xtype:"textarea"}],listeners:{scope:this,render:function(){var e=this;setTimeout(function(){var f="/plugins/editor/kindeditor/kindeditor-min.js";Disco.loadJs(f,false,function(){KindEditor.basePath="/plugins/editor/kindeditor/";var g=e.fp.form.findField("content").id;e.editor=KindEditor.create("#"+g,{uploadJson:"/fileUpload.java",fileManagerJson:"/fileUpload.java?cmd=showByKindeditor",afterBlur:function(){this.sync()}})},null,Disco.ajaxCache)},1)}}});var d=a.getForm();var b=Global.getCurrentUser;if(b.branchAdmin){var c=d.findField("dir");c.destroy();c.setDisabled(true);d.findField("toBranch").destroy();d.findField("branchDir").setDisabled(false)}return a}});
