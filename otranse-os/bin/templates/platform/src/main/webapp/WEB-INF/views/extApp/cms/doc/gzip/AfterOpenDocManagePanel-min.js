if(typeof Global==="undefined"){Global={}}Global.newsDocDirLoader=new Ext.tree.TreeLoader({iconCls:"disco-tree-node-icon",gridSelModel:"checkbox",varName:"Global.BRANCH_DIR_LOADER",url:"newsDir.java?cmd=getNewsDocDirTree&pageSize=-1&treeData=true&all=false",listeners:{beforeload:function(b,a){b.baseParams.id=(a.id.indexOf("root")<0?a.id:"");if(typeof a.attributes.checked!=="undefined"){b.baseParams.checked=false}}}});Global.mySendDocBranchDirLoader=new Disco.Ext.MemoryTreeLoader({iconCls:"disco-tree-node-icon",varName:"Global.MY_SEND_DOC_BRANCH_DIR_LOADER",url:"newsDir.java?cmd=getBranchDirTree&pageSize=-1&treeData=true&all=false&orgType=null",listeners:{beforeload:function(b,a){b.baseParams.id=(a.id.indexOf("root")<0?a.id:"");if(typeof a.attributes.checked!=="undefined"){b.baseParams.checked=false}}}});AfterOpenDocGridPanel=Ext.extend(Disco.Ext.CrudPanel,{gridSelModel:"checkbox",id:"afterOpenDocGridPanel",baseUrl:"newsDoc.java",autoLoadGridData:true,autoScroll:false,totalPhoto:0,pageSize:20,showAdd:false,showRemove:false,showView:false,searchWin:{width:630,height:195,title:"\u6942\u6a3c\u9a87\u93cc\u30e8\ue1d7"},defaultsActions:{create:"save",list:"getAfterOpenDoc",view:"view",update:"update",remove:"remove"},gridViewConfig:{forceFit:true,enableRowBody:true,showPreview:true},tempCookie:{dir:null},searchFormPanel:function(){var a=new Ext.form.FormPanel({frame:true,labelWidth:80,labelAlign:"right",items:[{xtype:"fieldset",title:"\u93cc\u30e8\ue1d7\u93c9\u2032\u6b22",height:115,layout:"column",items:[{columnWidth:0.5,layout:"form",defaultType:"textfield",items:[{fieldLabel:"\u93c2\u56e9\u73f7\u93cd\u56ec\ue57d",name:"title",anchor:"90%"},{fieldLabel:"\u93c2\u56e9\u73f7\u6d63\u6ec6\ufffd\ufffd",name:"author",anchor:"90%"},{fieldLabel:"\u93be\u626e\u01f9\u93c3\u30e6\u6e61(\u6fee\ufffd)",name:"createStartTime",anchor:"90%",xtype:"datefield",format:"Y-m-d"}]},{columnWidth:0.5,layout:"form",defaultType:"textfield",defaults:{width:130},items:[{anchor:"90%",fieldLabel:"\u9359\u621d\u7af7\u9352\u4f34\ue6fb\u6924\ufffd",name:"isTop",xtype:"radiogroup",items:[{boxLabel:"\u93c4\ufffd",name:"isTop",inputValue:1},{boxLabel:"\u935a\ufffd",name:"isTop",inputValue:0}]},{fieldLabel:"\u93c2\u56e9\u73f7\u93c9\u30e6\u7c2e",name:"source",anchor:"90%"},{fieldLabel:"\u93be\u626e\u01f9\u93c3\u30e6\u6e61(\u93c8\ufffd)",name:"createEndTime",anchor:"90%",xtype:"datefield",format:"Y-m-d"}]}]}]});return a},edit:function(){var a=this;if(!this.editWin){Disco.Ext.Util.listObject("NewsDocEditManagePanel",function(b){this.editWin=b;this.editWin.show();this.editWin.refurbishParentGrid=function(){a.grid.store.reload()};this.initWinFormData(this.editWin)}.createDelegate(this),"cms/doc/NewsDocEditManagePanel.js")}else{this.editWin.show();this.initWinFormData(this.editWin)}},moveNewsDocToDir:function(){var a=this.grid.getSelectionModel().getSelected();if(!a){this.alert("\u7487\u5cf0\u539b\u95ab\u590b\u5ae8\u7455\u4f79\u6437\u6d63\u6ec5\u6b91\u93c1\u7248\u5d41\u951b\ufffd","\u93bb\u612e\u305a\u6dc7\u2103\u4f05");return false}if(!this.viewWinPanel){this.viewWinPanel=this.createViewWinPanel()}this.viewWinPanel.show();var b=this.viewWinPanel.getComponent(0).form;b.clearData();b.reset();this.onView(b,a.data);b.findField("branchDir").setValue({id:a.get("branchDir").id,title:a.get("branchDir").name})},createViewWinPanel:function(){var a=new Ext.Window({width:300,height:110,modal:true,closeAction:"hide",buttonAlign:"center",title:"\u95ab\u590b\u5ae8\u93cd\u5fd5\u6d30\u935a\u5ea1\u5f42\u741b\ufffd",buttons:[{text:"\u9359\u6223\u3003(<u>K</u>)",handler:function(){var c=this;var b=c.viewWinPanel.getComponent(0).form;if(!b.isValid()){Ext.Msg.alert("\u93bb\u6130\u554b","\u7487\u5cf0\u539b\u95ab\u590b\u5ae8\u6d93\ufffd\u6d93\ue045\u722e\u9429\ue1bc\u6097\u9350\u5d85\u5f42\u741b\ufffd");return}var d=c.getViewFormObj();c.executeUrl("newsDoc.java",{cmd:"moveNewsDocToDir",mulitId:d.mulitId,branchDirId:d.branchDirId},function(){c.grid.store.reload();c.viewWinPanel.hide()})()},iconCls:"save",scope:this}]});a.add(this.createForm());return a},createForm:function(){var a=new Ext.form.FormPanel({frame:true,labelWidth:70,fileUpload:true,autoScroll:true,labelAlign:"right",defaults:{xtype:"textfield"},items:[{name:"id",xtype:"hidden"},{name:"branchDir",fieldLabel:"\u93c2\u56e9\u73f7\u93cd\u5fd5\u6d301",xtype:"treecombo",valueField:"id",allowBlank:false,blankText:"\u93c2\u56e9\u73f7\u93cd\u5fd5\u6d30\u6d93\u5d88\u5158\u6d93\u8679\u2516",hiddenName:"branchDirId",displayField:"title",tree:new Ext.tree.TreePanel({rootVisible:false,autoScroll:true,root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u93b5\ufffd\u93c8\u590b\u722e\u9429\ufffd",expanded:true,iconCls:"treeroot-icon",loader:Global.mySendDocBranchDirLoader})})}]});return a},getViewFormObj:function(){var e="";var a=this.grid.getSelectionModel().getSelections();for(var b=0;b<a.length;b++){e+=a[b].get("id")+","}var c=this.viewWinPanel.getComponent(0).form;var d={};d.mulitId=e;d.branchDirId=c.findField("branchDir").getValue();return d},initWinFormData:function(f){var a=this.grid.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert("\u93bb\u6130\u554b","\u7487\u70fd\ufffd\u590b\u5ae8\u95c7\ufffd\u7f02\u682c\u7deb\u9428\u52ec\u669f\u93b9\ufffd")}Ext.Ajax.request({scope:this,url:this.baseUrl+"?cmd=getContent&id="+a.get("id"),success:function(g){var h=Ext.decode(g.responseText);h!=null||(h="");f.editor.html(h);f.editor.sync()}});var e=a.get("dir");var d=f.fp.form.findField("dir");if(e){e.title||(e.title=e.name);d.setOriginalValue(e)}var b=a.get("branchDir");var c=f.fp.form.findField("branchDir");if(b){b.title||(b.title=b.name);c.setOriginalValue(b)}f.fp.form.loadRecord(a)},topicRender:function(b,c,a){return String.format('{1}<b><a style="color:green" href="news.java?cmd=show&id={0}" target="_blank">&nbsp\u93cc\u30e7\u6e45</a></b><br/>',a.id,b)},stateRender:function(a){return"\u5bb8\u63d2\u5f42\u741b\ufffd"},toggleDetails:function(b,c){var a=this.grid.getView();a.showPreview=c;a.refresh()},createWin:function(){return this.initWin(900,600,"\u93c2\u56e9\u73f7\u7ee0\uff04\u608a")},storeMapping:["id","isTop","title","keywords","iconPath","createDate","author","source","putDate","dir","toBranch","branchDir","state","branchState",{name:"branchDirId",mapping:"branchDir"},{name:"dirId",mapping:"dir"}],initComponent:function(){var a=Global.getCurrentUser;if(a.types==2||a.types==5){this.showRemove=true;this.batchRemoveMode=true}this.cm=new Ext.grid.ColumnModel([{header:"\u6d93\u5a5a\ue57d",dataIndex:"title",width:200,renderer:this.topicRender},{header:"\u93cd\u5fd5\u6d301",sortable:true,width:70,dataIndex:"dir",renderer:this.objectRender("name")},{width:70,sortable:true,header:"\u9359\u621d\u7af7\u9352\u677f\u578e\u741b\ufffd",dataIndex:"toBranch",renderer:this.booleanRender},{width:70,sortable:true,header:"\u9352\u55da\ue511\u93cd\u5fd5\u6d30",dataIndex:"branchDir",renderer:this.objectRender("name")},{header:"\u6d63\u6ec6\ufffd\ufffd",sortable:true,width:50,dataIndex:"author"},{header:"\u9359\u6223\u3003\u9477\u62bd\ue6fb\u6924\ufffd",sortable:true,width:70,align:"center",dataIndex:"isTop",renderer:this.booleanRender},{header:"\u93be\u626e\u01f9\u93c3\u30e6\u6e61",sortable:true,width:90,dataIndex:"createDate",renderer:this.dateRender()},{width:60,sortable:true,header:"\u5a34\u4f7a\u25bc\u9418\u8235\ufffd\ufffd",dataIndex:"state",renderer:this.stateRender}]);var a=Global.getCurrentUser;if(a.branchAdmin){this.cm.setHidden(1,true)}if(a.types==2||a.types==5){this.gridButtons=[{text:"\u9359\u6223\u3003\u9477\u62bd\ue6fb\u6924\ufffd",cls:"x-btn-text-icon",icon:"img/core/up.gif",handler:this.executeCmd("setTop")},{text:"\u93b5\u5f52\u567a\u6769\u4f7a\u0429\u9477\u866b\u5bda\u7039\u6c2d\u722e\u9429\ufffd",cls:"x-btn-text-icon",icon:"img/core/up.gif",handler:this.moveNewsDocToDir}]}AfterOpenDocGridPanel.superclass.initComponent.call(this)}});AfterOpenDocManagePanel=Ext.extendX(Disco.Ext.TreeCascadePanel,function(a){return{initComponent:function(){AfterOpenDocManagePanel.superclass.initComponent.call(this)},treeCfg:{title:"\u93c2\u56e9\u73f7\u93cd\u5fd5\u6d30\u6dc7\u2103\u4f05",rootText:"\u93b5\ufffd\u93c8\u590b\u722e\u9429\ufffd",expanded:true,autoScroll:true,rootIconCls:"treeroot-icon",loader:Global.newsDocDirLoader},onTreeClick:function(b){var c=(b.id!="root"?b.id:"");this.list.store.baseParams.dirId=c;a.onTreeClick.apply(this,arguments)},getPanel:function(){if(!this.panel){this.panel=new AfterOpenDocGridPanel();this.panel.tree=this.tree;this.list=this.panel.grid}return this.panel}}});
