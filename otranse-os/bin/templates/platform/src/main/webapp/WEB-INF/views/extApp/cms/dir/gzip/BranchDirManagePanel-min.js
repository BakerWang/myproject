if(typeof Global==="undefined"){Global={}}Global.branchDirLoader=new Ext.tree.TreeLoader({iconCls:"disco-tree-node-icon",varName:"Global.BRANCH_DIR_LOADER",url:"newsDir.java?cmd=getBranchDirTree&pageSize=-1&treeData=true&all=false&orgType=null",listeners:{beforeload:function(b,a){b.baseParams.id=(a.id.indexOf("root")<0?a.id:"");if(typeof a.attributes.checked!=="undefined"){b.baseParams.checked=false}}}});BranchDirGridListPanel=Ext.extend(Disco.Ext.CrudPanel,{gridSelModel:"checkbox",id:"branchDirGridListPanel",baseUrl:"newsDir.java",baseQueryParameter:{orgType:null},viewWin:{width:400,height:310,title:"\u9352\u55da\ue511\u9352\u55d9\u88ab\u6dc7\u2103\u4f05"},statusRender:function(a){if(a==1){return"\u935a\ue21c\u6564"}else{if(a==0){return"\u934b\u6ec5\u6564"}else{return"\u93c8\ue046\u7161"}}},onCreate:function(){this.fp.form.findField("parent").setOriginalValue(this.parentDir||null)},edit:function(){var d=BranchDirGridListPanel.superclass.edit.call(this);if(d){var a=this.grid.getSelectionModel().getSelected();var c=a.get("parent");var b=this.fp.form.findField("parent");this.reloadTreeByOrgId(b,null);if(c){c.title||(c.title=c.name);b.setOriginalValue(c)}}},createForm:function(){var a=new Ext.form.FormPanel({frame:true,labelWidth:70,labelAlign:"right",defaultType:"textfield",defaults:{anchor:"-20"},items:[{xtype:"hidden",name:"id"},Disco.Ext.Util.twoColumnPanelBuild({fieldLabel:"\u93cd\u5fd5\u6d30\u6434\u5fd3\u5f7f",name:"sequence",xtype:"numberfield",allowBlank:false},{fieldLabel:"\u93cd\u5fd5\u6d30\u935a\u5d87\u041e",name:"name",allowBlank:false},{fieldLabel:"\u6d93\u5a44\u9a87\u93cd\u5fd5\u6d30",name:"parent",xtype:"treecombo",hiddenName:"parentId",displayField:"title",valueField:"id",tree:new Ext.tree.TreePanel({autoScroll:true,root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u93b5\ufffd\u93c8\u590b\u722e\u9429\ufffd",expanded:true,iconCls:"treeroot-icon",loader:Global.branchDirLoader})})},{fieldLabel:"\u68e3\u682d\u3009\u93c4\u5267\u305a",name:"showDesk",xtype:"radiogroup",items:[{checked:true,boxLabel:"\u93c4\u5267\u305a",name:"showDesk",inputValue:1},{boxLabel:"\u6d93\u5d86\u6a09\u7ec0\ufffd",name:"showDesk",inputValue:0}]},{fieldLabel:"\u93cd\u5fd5\u6d30\u9418\u8235\ufffd\ufffd",xtype:"radiogroup",name:"status",items:[{checked:true,boxLabel:"\u935a\ue21c\u6564",name:"status",inputValue:1},{boxLabel:"\u934b\u6ec5\u6564",name:"status",inputValue:0}]}),{fieldLabel:"\u95c4\u52ec\u655e",xtype:"textarea",name:"description"}]});return a},reloadTreeByOrgId:function(b,a){!b.disabled||b.setDisabled(false);b.reset();b.setValue(null)},reloadLeftTree:function(){if(this.tree){this.tree.getLoader().baseParams.orgId=null;this.tree.root.reload();this.tree.expandAll()}if(this.fp){var a=this.fp.form.findField("parent");if(a&&a.tree.rendered){a.tree.root.reload();a.tree.expandAll()}}},createWin:function(b,a){return this.initWin(500,250,"\u9352\u55da\ue511\u93cd\u5fd5\u6d30\u7ee0\uff04\u608a",b,a)},findDeptDirByOrgId:function(b,c){var a=b.id;if(a=="root"){a=null}this.grid.getStore().baseParams.orgId=a;this.grid.getStore().baseParams.parentId=null;this.grid.getStore().load();this.tree.getLoader().baseParams={orgId:a};this.tree.root.reload();this.tree.expandAll();this.tree.root.select()},showDeskRender:function(a){if(a==1){return"\u93c4\u5267\u305a"}else{if(a==0){return"\u6d93\u5d86\u6a09\u7ec0\ufffd"}else{return"\u93c8\ue046\u7161"}}},storeMapping:["id","code","name","intro","dirPath","tel","fax","sequence","parent","status","showDesk"],initComponent:function(){this.cm=new Ext.grid.ColumnModel([{header:"\u6434\u5fd3\u5f7f",sortable:true,width:100,dataIndex:"code"},{header:"\u935a\u5d87\u041e",sortable:true,width:160,dataIndex:"name"},{header:"\u6d93\u5a44\u9a87\u93cd\u5fd5\u6d30",sortable:true,width:100,dataIndex:"parent",renderer:this.objectRender("name")},{header:"\u68e3\u682d\u3009\u93c4\u5267\u305a",sortable:true,width:100,dataIndex:"showDesk",renderer:this.showDeskRender},{header:"\u93ba\u6391\u7c2d",sortable:true,width:100,dataIndex:"sequence"},{header:"\u7ee0\ufffd\u6d60\ufffd",sortable:true,width:300,dataIndex:"intro"},{width:80,header:"\u9418\u8235\ufffd\ufffd",sortable:true,dataIndex:"status",renderer:this.statusRender}]);BranchDirGridListPanel.superclass.initComponent.call(this);this.on("saveobject",this.reloadLeftTree,this);this.on("removeobject",this.reloadLeftTree,this)},listeners:{render:function(a){}}});BranchDirManagePanel=Ext.extendX(Disco.Ext.TreeCascadePanel,function(a){return{initComponent:function(){BranchDirManagePanel.superclass.initComponent.call(this)},treeCfg:{title:"\u9352\u55da\ue511\u93cd\u5fd5\u6d30\u6dc7\u2103\u4f05",rootText:"\u93b5\ufffd\u93c8\u590b\u722e\u9429\ufffd",autoScroll:true,expanded:true,rootIconCls:"treeroot-icon",loader:Global.branchDirLoader},onTreeClick:function(b){var c=(b.id!="root"?b.id:"");this.panel.parentDir={id:c,title:b.text};this.list.store.baseParams.parentId=c;a.onTreeClick.apply(this,arguments)},getPanel:function(){if(!this.panel){this.panel=new BranchDirGridListPanel();this.panel.tree=this.tree;this.list=this.panel.grid}return this.panel}}});
