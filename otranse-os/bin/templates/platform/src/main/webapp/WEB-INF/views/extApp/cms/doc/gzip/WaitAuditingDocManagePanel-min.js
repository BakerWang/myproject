if(typeof Global==="undefined"){Global={}}if(!Global.mySendDocOrgDirLoader){Global.mySendDocOrgDirLoader=new Disco.Ext.MemoryTreeLoader({iconCls:"disco-tree-node-icon",varName:"Global.MY_SEND_DOC_ORG_LOADER",url:"newsDir.java?cmd=getDirTreeByCurrentUserOrg&pageSize=-1&treeData=true&all=false&orgdir=true",listeners:{beforeload:function(b,a){b.baseParams.id=(a.id.indexOf("root")<0?a.id:"");if(typeof a.attributes.checked!=="undefined"){b.baseParams.checked=false}}}})}if(!Global.mySendDocBranchDirLoader){Global.mySendDocBranchDirLoader=new Disco.Ext.MemoryTreeLoader({iconCls:"disco-tree-node-icon",varName:"Global.MY_SEND_DOC_BRANCH_DIR_LOADER",url:"newsDir.java?cmd=getBranchDirTree&pageSize=-1&treeData=true&all=false&orgType=null",listeners:{beforeload:function(b,a){b.baseParams.id=(a.id.indexOf("root")<0?a.id:"");if(typeof a.attributes.checked!=="undefined"){b.baseParams.checked=false}}}})}WaitAuditingDocManagePanel=Ext.extend(Disco.Ext.CrudPanel,{gridSelModel:"checkbox",id:"waitAuditingDocManagePanel",baseUrl:"newsDoc.java",autoLoadGridData:true,autoScroll:false,totalPhoto:0,pageSize:20,showAdd:false,showRemove:false,showEdit:false,defaultsActions:{create:"save",list:"getMyWaitAuditing",view:"view",update:"update",remove:"remove"},edit:function(){},gridViewConfig:{forceFit:true,enableRowBody:true,showPreview:true},topicRender:function(b,c,a){return String.format('{1}<b><a style="color:green" href="news.java?cmd=show&id={0}" target="_blank">&nbsp\u93cc\u30e7\u6e45</a></b><br/>',a.id,b)},stateRender:function(a){if(a==2){return"\u7039\u2103\u7273\u6d93\ufffd"}else{if(a==3){return"\u5bf0\u546d\ue178\u93cd\ufffd"}else{return"\u5bf0\u546d\ue178\u93cd\ufffd"}}},toggleDetails:function(b,c){var a=this.grid.getView();a.showPreview=c;a.refresh()},view:function(){var a=this.grid.getSelectionModel().getSelected();if(!a){this.alert("\u7487\u5cf0\u539b\u95ab\u590b\u5ae8\u7455\u4f79\u6437\u6d63\u6ec5\u6b91\u93c1\u7248\u5d41\u951b\ufffd","\u93bb\u612e\u305a\u6dc7\u2103\u4f05");return false}if(!this.viewWinPanel){this.viewWinPanel=this.createViewWinPanel()}this.viewWinPanel.show();var b=this.viewWinPanel.getComponent(0).form;b.clearData();b.reset();this.onView(b,a.data);b.loadRecord(a);this.changeDocState(a.data);b.clearDirty()},getViewFormId:function(){var a=this.viewWinPanel.getComponent(0).form;return a.findField("id").getValue()},changeDocState:function(a){if(a.state==2||a.branchState==2){return}Ext.Ajax.request({method:"POST",url:"newsDoc.java?cmd=changeDocState&id="+a.id,success:function(b){var c=Ext.decode(b.responseText);if(!c.success){Disco_RIA.ajaxErrorHandler(c)}else{this.grid.store.reload()}},scope:this})},createViewWinPanel:function(){var a=new Ext.Window({width:900,height:620,closeAction:"hide",buttonAlign:"center",title:"\u93cc\u30e7\u6e45\u93c2\u56e8\u3002\u7487\ufe3d\u510f",buttons:[{text:"\u95ab\u6c33\u7e43\u7039\u2103\u7273(<u>K</u>)",handler:function(){var b=this;Ext.MessageBox.show({title:"\u7039\u2103\u7273\u93b0\u5fda\ue746",width:300,buttons:Ext.MessageBox.OKCANCEL,multiline:true,fn:function(c,d){if("ok"==c){b.executeUrl("newsDoc.java",{id:b.getViewFormId(),cmd:"submitAuditing",advice:d},function(){b.grid.store.reload();b.viewWinPanel.hide()})()}}})},iconCls:"save",scope:this},{text:"\u95ab\ufffd\u9365\ufffd(<u>X</u>)",iconCls:"clean",handler:function(){var b=this;Ext.MessageBox.show({title:"\u95ab\ufffd\u9365\u70b2\u5e2b\u9365\ufffd",width:300,buttons:Ext.MessageBox.OKCANCEL,multiline:true,fn:function(c,d){if("ok"==c){b.executeUrl("newsDoc.java",{id:b.getViewFormId(),cmd:"backUpDoc",advice:d},function(){b.grid.store.reload();b.viewWinPanel.hide()})()}}})},scope:this},{text:"\u934f\u62bd\u68f4(<u>X</u>)",iconCls:"delete",handler:function(){this.viewWinPanel.hide()},scope:this}]});a.add(this.createForm());return a},onView:function(b,f){Ext.Ajax.request({scope:this,url:this.baseUrl+"?cmd=getContent&id="+f.id,success:function(g){var h=Ext.decode(g.responseText);h!=null||(h="");this.editor.html(h);this.editor.sync()}});var e=f.dir;var d=b.findField("dir");if(e){e.title||(e.title=e.name);d.setOriginalValue(e)}var a=f.branchDir;var c=b.findField("branchDir");if(a){a.title||(a.title=a.name);c.setOriginalValue(a)}},viewSave:function(){alert("\u9410\u7470\u56ae\u6d5c\u55d5\u7e5a\u701b\ufffd")},createForm:function(){var a=new Ext.form.FormPanel({frame:true,labelWidth:70,fileUpload:true,autoScroll:true,labelAlign:"right",defaults:{xtype:"textfield"},items:[{name:"id",xtype:"hidden"},{width:780,name:"title",emptyText:"\u93c2\u56e9\u73f7\u93cd\u56ec\ue57d",fieldLabel:"\u93c2\u56e9\u73f7\u93cd\u56ec\ue57d",allowBlank:false,blankText:"\u93c2\u56e9\u73f7\u93cd\u56ec\ue57d\u6d93\u5d88\u5158\u6d93\u8679\u2516"},{width:780,name:"keywords",emptyText:"\u93c2\u56e9\u73f7\u7ee0\ufffd\u942d\ue15f\u7223\u68f0\u6a3a\u6e6a30\u6d93\ue044\u74e7\u7ed7\ufe40\u5534",fieldLabel:"\u7ee0\ufffd\u942d\ue15f\u7223\u68f0\ufffd"},{width:780,name:"iconPath",emptyText:"\u93c2\u56e9\u73f7\u7035\u7470\u7c32\u9428\u52eb\u3054\u93c9\u2033\u6d58\u9417\u5626RL\u9366\u677f\u6f43",fieldLabel:"\u6fb6\u5b58\u6f6f\u9365\u5267\u5896"},Disco.Ext.Util.columnPanelBuild({columnWidth:0.3,items:{name:"author",fieldLabel:"\u6d63\u6ec6\ufffd\ufffd"}},{columnWidth:0.3,items:{name:"source",fieldLabel:"\u93c9\u30e6\u7c2e"}},{columnWidth:0.4,items:{name:"putDate",anchor:"93.8%",editable:false,format:"Y-m-d G:i",xtype:"datefield",fieldLabel:"\u9359\u621d\u7af7\u93c3\u30e6\u6e611"}}),Disco.Ext.Util.columnPanelBuild({columnWidth:0.3,items:{name:"dir",allowBlank:false,blankText:"\u93c2\u56e9\u73f7\u93cd\u5fd5\u6d30\u6d93\u5d88\u5158\u6d93\u8679\u2516",fieldLabel:"\u93c2\u56e9\u73f7\u93cd\u5fd5\u6d30",xtype:"treecombo",valueField:"id",hiddenName:"dirId",displayField:"title",tree:new Ext.tree.TreePanel({autoScroll:true,root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u93b5\ufffd\u93c8\u590b\u722e\u9429\ufffd",expanded:true,iconCls:"treeroot-icon",loader:Global.mySendDocOrgDirLoader}),listeners:{scope:this,click:function(b){this.tempCookie.dir=b}}})}},{columnWidth:0.3,items:{name:"toBranch",xtype:"checkbox",inputValue:1,fieldLabel:"\u9359\u621d\u7af7\u9352\u677f\u578e\u741b\ufffd",listeners:{scope:this,check:function(d,c){var b=this.viewWinPanel.getComponent(0).form;var e=b.findField("branchDir");if(c){e.setDisabled(false)}else{e.setDisabled(true)}}}}},{columnWidth:0.4,items:{disabled:true,allowBlank:false,fieldLabel:"\u9352\u55da\ue511\u93cd\u5fd5\u6d30",name:"branchDir",xtype:"treecombo",hiddenName:"branchDirId",displayField:"title",valueField:"id",tree:new Ext.tree.TreePanel({autoScroll:true,root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u93b5\ufffd\u93c8\u590b\u722e\u9429\ufffd",expanded:true,iconCls:"treeroot-icon",loader:Global.mySendDocBranchDirLoader})})}}),{width:880,height:395,margins:{left:10},hideLabel:true,id:"content_waitAuditing",name:"content",xtype:"textarea"}],listeners:{scope:this,render:function(){var b=this;setTimeout(function(){var c="/plugins/editor/kindeditor/kindeditor-min.js";Disco.loadJs(c,false,function(){KindEditor.basePath="/plugins/editor/kindeditor/";b.editor=KindEditor.create("#content_waitAuditing",{uploadJson:"/fileUpload.java",fileManagerJson:"/fileUpload.java?cmd=showByKindeditor",afterBlur:function(){this.sync()}})},null,Disco.ajaxCache)},1)}}});return a},createWin:function(){return this.initWin(900,620,"\u93c2\u56e9\u73f7\u7ee0\uff04\u608a")},storeMapping:["id","title","keywords","iconPath","createDate","author","source","putDate","dir","toBranch","branchDir","state","branchState",{name:"branchDirId",mapping:"branchDir"},{name:"dirId",mapping:"dir"}],initComponent:function(){this.cm=new Ext.grid.ColumnModel([{header:"\u6d93\u5a5a\ue57d",dataIndex:"title",width:200,renderer:this.topicRender},{header:"\u93cd\u5fd5\u6d30",sortable:true,width:70,dataIndex:"dir",renderer:this.objectRender("name")},{width:70,sortable:true,header:"\u9359\u621d\u7af7\u9352\u677f\u578e\u741b\ufffd",dataIndex:"toBranch",renderer:this.booleanRender},{width:70,sortable:true,header:"\u9352\u55da\ue511\u93cd\u5fd5\u6d30",dataIndex:"branchDir",renderer:this.objectRender("name")},{header:"\u6d63\u6ec6\ufffd\ufffd",sortable:true,width:50,dataIndex:"author"},{header:"\u93be\u626e\u01f9\u93c3\u30e6\u6e61",sortable:true,width:90,dataIndex:"createDate",renderer:this.dateRender()},{width:60,sortable:true,header:"\u5a34\u4f7a\u25bc\u9418\u8235\ufffd\ufffd",dataIndex:"state",renderer:this.stateRender}]);WaitAuditingDocManagePanel.superclass.initComponent.call(this)}});
