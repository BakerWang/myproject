if(typeof Global==="undefined"){Global={}}Global.deptDirLoader=new Ext.tree.TreeLoader({iconCls:"disco-tree-node-icon",varName:"Global.DEPT_DIR_LOADER",url:"newsDir.java?cmd=getDeptDirTree&pageSize=-1&treeData=true&all=false&orgType=1",listeners:{beforeload:function(b,a){b.baseParams.id=(a.id.indexOf("root")<0?a.id:"");if(typeof a.attributes.checked!=="undefined"){b.baseParams.checked=false}}}});Global.deptTreeLoader=new Disco.Ext.MemoryTreeLoader({iconCls:"disco-tree-node-icon",varName:"Global.DEPT_TREE_LOADER",url:"organization.java?cmd=getTree&pageSize=-1&treeData=true&all=false&orgType=1",listeners:{beforeload:function(b,a){b.baseParams.id=(a.id.indexOf("root")<0?a.id:"");if(typeof a.attributes.checked!=="undefined"){b.baseParams.checked=false}}}});DpetDirGridListPanel=Ext.extend(Disco.Ext.CrudPanel,{gridSelModel:"checkbox",id:"dpetDirGridListPanel",baseUrl:"newsDir.java",baseQueryParameter:{orgType:1},viewWin:{width:400,height:310,title:"\u95ae\u3129\u68ec\u9352\u55d9\u88ab\u6dc7\u2103\u4f05"},statusRender:function(a){if(a==1){return"\u935a\ue21c\u6564"}else{if(a==0){return"\u934b\u6ec5\u6564"}else{return"\u93c8\ue046\u7161"}}},onCreate:function(){this.fp.form.findField("parent").setOriginalValue(this.parentDir||null)},edit:function(){var d=DpetDirGridListPanel.superclass.edit.call(this);if(d){var a=this.grid.getSelectionModel().getSelected();var c=a.get("parent");var b=this.fp.form.findField("parent");this.reloadTreeByOrgId(b,a.get("org").id);if(c){c.title||(c.title=c.name);b.setOriginalValue(c)}}},createForm:function(){var a=new Ext.form.FormPanel({frame:true,labelWidth:70,labelAlign:"right",defaultType:"textfield",defaults:{anchor:"-20"},items:[{xtype:"hidden",name:"id"},Disco.Ext.Util.twoColumnPanelBuild({fieldLabel:"\u93cd\u5fd5\u6d30\u6434\u5fd3\u5f7f",name:"sequence",xtype:"numberfield",allowBlank:false},{fieldLabel:"\u93cd\u5fd5\u6d30\u935a\u5d87\u041e",name:"name",allowBlank:false},{fieldLabel:"\u93b5\ufffd\u705e\u70ba\u5134\u95c2\ufffd",name:"org",xtype:"treecombo",hiddenName:"orgId",displayField:"title",valueField:"id",allowBlank:false,tree:new Ext.tree.TreePanel({rootVisible:false,autoScroll:true,root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u93b5\ufffd\u93c8\u5910\u5134\u95c2\ufffd",expanded:true,iconCls:"treeroot-icon",loader:Global.deptTreeLoader}),listeners:{scope:this,click:function(c){var b=this.fp.form.findField("parent");this.reloadTreeByOrgId(b,c.id)}}})},{disabled:true,fieldLabel:"\u6d93\u5a44\u9a87\u93cd\u5fd5\u6d30",name:"parent",xtype:"treecombo",hiddenName:"parentId",displayField:"title",valueField:"id",tree:new Ext.tree.TreePanel({autoScroll:true,root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u93b5\ufffd\u93c8\u590b\u722e\u9429\ufffd",expanded:true,iconCls:"treeroot-icon",loader:Global.deptDirLoader})})},{fieldLabel:"\u93cd\u5fd5\u6d30\u9418\u8235\ufffd\ufffd",xtype:"radiogroup",name:"status",items:[{checked:true,boxLabel:"\u935a\ue21c\u6564",name:"status",inputValue:1},{boxLabel:"\u934b\u6ec5\u6564",name:"status",inputValue:0}]},{fieldLabel:"\u7ec9\u4f79\u6e41\u93cd\u5fd5\u6d30",name:"isPrivateDir",xtype:"radiogroup",items:[{boxLabel:"\u93c4\ufffd",name:"isPrivateDir",inputValue:1},{checked:true,boxLabel:"\u935a\ufffd",name:"isPrivateDir",inputValue:0}]}),{fieldLabel:"\u95c4\u52ec\u655e",xtype:"textarea",name:"description"}]});return a},reloadTreeByOrgId:function(c,b){!c.disabled||c.setDisabled(false);c.reset();c.setValue(null);var a=c.tree;a.root.attributes.loader.baseParams={orgId:b};if(a.rendered){a.root.reload();a.expandAll()}},reloadLeftTree:function(){if(this.tree){this.tree.getLoader().baseParams.orgId=null;this.tree.root.reload();this.tree.expandAll()}if(this.fp){var a=this.fp.form.findField("parent");if(a&&a.tree.rendered){a.tree.root.reload();a.tree.expandAll()}}},createWin:function(b,a){return this.initWin(500,250,"\u95ae\u3129\u68ec\u93cd\u5fd5\u6d30\u7ee0\uff04\u608a",b,a)},findDeptDirByOrgId:function(b,c){var a=b.id;if(a=="root"){a=null}this.grid.getStore().baseParams.orgId=a;this.grid.getStore().baseParams.parentId=null;this.grid.getStore().load();this.tree.getLoader().baseParams={orgId:a};this.tree.root.reload();this.tree.expandAll();this.tree.root.select()},storeMapping:["id","code","name","org","intro","dirPath","tel","fax","sequence","parent","status","isPrivateDir"],initComponent:function(){this.cm=new Ext.grid.ColumnModel([{header:"\u6434\u5fd3\u5f7f",sortable:true,width:100,dataIndex:"code"},{header:"\u935a\u5d87\u041e",sortable:true,width:160,dataIndex:"name"},{header:"\u6d93\u5a44\u9a87\u93cd\u5fd5\u6d30",sortable:true,width:100,dataIndex:"parent",renderer:this.objectRender("name")},{header:"\u93b5\ufffd\u705e\u70ba\u5134\u95c2\ufffd",sortable:true,width:100,dataIndex:"org",renderer:this.objectRender("title")},{header:"\u9422\u4f43\u763d",sortable:true,width:100,dataIndex:"tel"},{header:"\u93ba\u6391\u7c2d",sortable:true,width:100,dataIndex:"sequence"},{width:65,sortable:true,header:"\u7ec9\u4f79\u6e41\u93cd\u5fd5\u6d30",dataIndex:"isPrivateDir",renderer:this.booleanRender},{flex:1,header:"\u7ee0\ufffd\u6d60\ufffd",sortable:true,dataIndex:"intro"},{width:80,header:"\u9418\u8235\ufffd\ufffd",sortable:true,dataIndex:"status",renderer:this.statusRender}]);this.gridButtons=["-","&nbsp;&nbsp;&nbsp;",{type:"tbtext",xtype:"tbtext",text:"\u95ae\u3129\u68ec\u7edb\u6da2\ufffd\u591b\u7d30"},{name:"org",type:"combo",xtype:"treecombo",hiddenName:"orgId",displayField:"title",text:"\u93b5\ufffd\u93c8\u5910\u5134\u95c2\ufffd",valueField:"id",tree:new Ext.tree.TreePanel({autoScroll:true,root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u93b5\ufffd\u93c8\u5910\u5134\u95c2\ufffd",expanded:true,iconCls:"treeroot-icon",loader:Global.deptTreeLoader}),listeners:{scope:this,click:this.findDeptDirByOrgId}})}];this.gridButtons=["&nbsp;&nbsp;&nbsp;","-",{type:"tbtext",xtype:"tbtext",text:"\u93b8\u5910\u5134\u95c2\u3127\u74eb\u95ab\u591b\u7d30"},{name:"org",type:"combo",width:200,xtype:"treecombo",hiddenName:"orgId",displayField:"title",text:"\u93b5\ufffd\u93c8\u5910\u5134\u95c2\ufffd",valueField:"id",tree:new Ext.tree.TreePanel({autoScroll:true,root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u93b5\ufffd\u93c8\u5910\u5134\u95c2\ufffd",expanded:true,iconCls:"treeroot-icon",loader:Global.deptTreeLoader}),listeners:{scope:this,click:this.findDeptDirByOrgId}})}];DpetDirGridListPanel.superclass.initComponent.call(this);this.on("saveobject",this.reloadLeftTree,this);this.on("removeobject",this.reloadLeftTree,this)},listeners:{render:function(a){}}});DeptDirManagePanel=Ext.extendX(Disco.Ext.TreeCascadePanel,function(a){return{initComponent:function(){DeptDirManagePanel.superclass.initComponent.call(this)},treeCfg:{title:"\u95ae\u3129\u68ec\u93cd\u5fd5\u6d30\u6dc7\u2103\u4f05",rootText:"\u93b5\ufffd\u93c8\u590b\u722e\u9429\ufffd",expanded:true,rootIconCls:"treeroot-icon",loader:Global.deptDirLoader},onTreeClick:function(b){var c=(b.id!="root"?b.id:"");this.panel.parentDir={id:c,title:b.text};this.list.store.baseParams.parentId=c;a.onTreeClick.apply(this,arguments)},getPanel:function(){if(!this.panel){this.panel=new DpetDirGridListPanel();this.panel.tree=this.tree;this.list=this.panel.grid}return this.panel}}});
