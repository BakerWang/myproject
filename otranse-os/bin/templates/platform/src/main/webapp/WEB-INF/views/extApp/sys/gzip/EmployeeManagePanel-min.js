if(typeof Global==="undefined"){Global={}}if(!Global.organizationLoader){Global.organizationLoader=new Disco.Ext.MemoryTreeLoader({iconCls:"disco-tree-node-icon",varName:"Global.DEPARTMENT_NODES",url:"organization.java?cmd=getTree&page	Size=-1&treeData=true&all=false",listeners:{beforeload:function(b,a){b.baseParams.id=(a.id.indexOf("root")<0?a.id:"");if(typeof a.attributes.checked!=="undefined"){b.baseParams.checked=false}}}})}if(!Global.platformMenuLoader){Global.platformMenuLoader=new Disco.Ext.MemoryTreeLoader({iconCls:"disco-tree-node-icon",varName:"Global.PLATFORM_MENU_NODES",url:"systemMenu.java?cmd=getTree&pageSize=-1&treeData=true&all=true",listeners:{beforeload:function(b,a){b.baseParams.id=(a.id.indexOf("root")<0?a.id:"");if(typeof a.attributes.checked!=="undefined"){b.baseParams.checked=false}}}})}if(typeof RoleList==="undefined"){RoleList=Ext.extend(BaseGridList,{url:"role.java?cmd=list",loadData:true,storeMapping:["id","name","title","description"],initComponent:function(){var a=new Ext.grid.CheckboxSelectionModel();this.gridConfig={sm:a},this.cm=new Ext.grid.ColumnModel([a,{header:"\u7f02\u682b\u721c",sortable:true,width:60,dataIndex:"name"},{header:"\u935a\u5d87\u041e",sortable:true,width:120,dataIndex:"title"},{header:"\u7ee0\ufffd\u6d60\ufffd",sortable:true,width:100,dataIndex:"description"}]);RoleList.superclass.initComponent.call(this)}})}if(typeof PermissionList==="undefined"){PermissionList=Ext.extend(BaseGridList,{pageSize:20,loadData:true,url:"permission.java?cmd=list",storeMapping:["id","name","description"],quickSearch:function(){this.grid.store.removeAll();this.grid.store.reload({params:{searchKey:this.btn_search.getValue(),start:0}})},initComponent:function(){var a=new Ext.grid.CheckboxSelectionModel();this.gridConfig={sm:a},this.cm=new Ext.grid.ColumnModel([a,{header:"\u93c9\u51ae\u6aba\u935a\ufffd",sortable:true,width:60,dataIndex:"name"},{header:"\u7ee0\ufffd\u6d60\ufffd",sortable:true,width:100,dataIndex:"description"}]);this.btn_search=new Ext.form.TextField({width:100});this.tbar=["\u934f\u62bd\u656d\u701b\ufffd",this.btn_search,{text:"\u93cc\u30e8\ue1d7",handler:this.quickSearch,scope:this,cls:"x-btn-text-icon",icon:"img/icon-png/search.png"}];PermissionList.superclass.initComponent.call(this)}})}if(typeof DeptList==="undefined"){DeptList=Ext.extend(BaseGridList,{url:"department.java?cmd=listAll",loadData:true,storeMapping:["id","title","sn","admin","parent"],initComponent:function(){var a=new Ext.grid.CheckboxSelectionModel();this.gridConfig={sm:a},this.cm=new Ext.grid.ColumnModel([a,{header:"\u935a\u5d87\u041e",sortable:true,width:60,dataIndex:"title"},{header:"\u7f02\u6827\u5f7f",sortable:true,width:120,dataIndex:"sn"},{header:"\u93b5\ufffd\u705e\u70b4\u6e80\u93cb\ufffd",sortable:true,width:60,dataIndex:"parent",renderer:Disco.Ext.Util.objectRender("title")},{header:"\u7ee0\uff04\u608a\u935b\ufffd",sortable:true,width:100,dataIndex:"admin",renderer:Disco.Ext.Util.objectRender("trueName")}]);DeptList.superclass.initComponent.call(this)}})}EmployeePanel=Ext.extend(Disco.Ext.CrudPanel,{pageSize:20,importData:true,exportData:true,baseUrl:"employee.java",gridSelModel:"checkbox",initQueryParameter:{status:1},employeeTypes:[["\u93be\u626e\u01f9\u6d5c\ufffd",1],["\u95ae\u3129\u68ec\u93c0\ue21d\ue511\u7ee0\uff04\u608a\u935b\ufffd",2],["\u95ae\u3129\u68ec\u93c0\ue21d\ue511\u7039\u2103\u7273\u6d5c\ufffd",4],["\u9352\u55da\ue511\u7ee0\uff04\u608a\u935b\ufffd",5],["\u934f\u8dfa\u7560\u7eeb\u8bf2\u7037",6]],searchWin:{width:550,height:225,title:"\u6942\u6a3c\u9a87\u93cc\u30e8\ue1d7"},viewWin:{width:800,height:465,title:"\u935b\u6a3a\u4f10\u6dc7\u2103\u4f05"},choiceSelectGridData:function(grid,winName,gridList,winTitle){return function(){var theGrid=this[grid];if(!this[winName]){var glist=eval("new "+gridList);this[winName]=new Disco.Ext.GridSelectWin({border:false,hideBorders:true,title:winTitle,width:650,grid:glist});this[winName].on("select",function(datas){var ds=[];for(var i=0;i<datas.length;i++){if(theGrid.store.find("id",datas[i].id)<0){ds[ds.length]=datas[i]}}theGrid.store.loadData(ds,true)},this)}this[winName].show()}},selectOtherDepts:function(){var a=this.grid.getSelectionModel().getSelected();if(!this.otherDepts){var c=new Disco.Ext.MemoryTreeLoader({preloadChildren:true,baseAttrs:{checked:false},iconCls:"disco-tree-node-icon",varName:"Global.DEPARTMENT_NODES2",url:"organization.java?cmd=getTree&treeData=true&all=true&checked=true",listeners:{beforeload:function(e,d){e.baseParams.id=(d.id.indexOf("root")<0?d.id:"");if(typeof d.attributes.checked!=="undefined"){e.baseParams.checked=false}}}});var b=this.deptGrid;c.remoteObject.on("load",function(e,d){if(d){b.getStore().each(function(f){d.getNodeById(f.get("id")).checked=true})}});this.otherDepts=new Ext.tree.TreePanel({rootVisible:false,autoScroll:true,listeners:{scope:this,checkchange:function(f,e){var d=function(g){if(g.getUI()&&g.getUI().checkbox){g.getUI().checkbox.checked=e;g.attributes.checked=e}};f.cascade(d)}},loader:c,root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u93cd\u7845\u59ad\u9410\ufffd",expanded:true})})}else{this.otherDepts.getRootNode().cascade(function(e){var f=e.getUI();if(f&&f.checkbox){var d=false;f.checkbox.defaultChecked=d;f.checkbox.checked=d;f.node.attributes.checked=d}},this)}Disco.Ext.Window.show({width:400,height:400,title:"\u7f01\u52ed\u7c90\u93c8\u70d8\u702f\u93cd\ufffd",border:false,items:this.otherDepts,single:false,scope:this,buttons:["yes","no"],handler:function(h,i,e){var g=e;if(h=="yes"){var d=g.getChecked("id");var f=[];Ext.each(d,function(k){var l=this.otherDepts.getNodeById(k);var j=l.attributes;f.push({id:j.id,title:j.text})},this);this.deptGrid.store.loadData(f)}i.hide()}});this.otherDepts.expandAll();this.deptGrid.getStore().each(function(d){var h=d.get("id");var f=this.otherDepts.getNodeById(h);if(f){var e=true;var g=f.getUI();g.checkbox.defaultChecked=e;g.checkbox.checked=e;g.node.attributes.checked=e}},this)},createPermissionPanel:function(h,d,b,g,c,e){var i=[new Ext.grid.RowNumberer({header:"\u6434\u5fd3\u5f7f",width:40}),{header:"ID",dataIndex:"id",hideable:true,hidden:true},{header:"\u93c9\u51ae\u6aba\u935a\u5d87\u041e",dataIndex:"name",width:100}];if(d){i.unshift(d)}var f=new Ext.grid.GridPanel(Ext.apply({region:"center",viewConfig:{forceFit:true},sm:d||new Ext.grid.RowSelectionModel(),border:false,cm:new Ext.grid.ColumnModel(i),store:new Ext.data.JsonStore({id:"id",root:"result",totalProperty:"rowCount",url:"systemMenu.java?cmd=loadPermissions",fields:["id","name","description"]})},b||{}));if(c){this[c]=f}var j=new Ext.tree.TreePanel(Ext.apply({region:"west",autoScroll:true,border:false,width:200,margins:"0 2 0 0",tools:[{id:"refresh",handler:function(){this[e].root.reload()},scope:this}],root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u93b5\ufffd\u93c8\u590e\u5f4d\u9357\ufffd",expanded:true,iconCls:"treeroot-icon",loader:h||Global.platformMenuLoader})},g||{}));if(e){this[e]=j}var a=new Ext.Panel({layout:"border",region:"center",border:false,hideBorders:true,items:[f,j]});a.grid=f;a.tree=j;return a},createRolePanel:function(){var c=new Ext.grid.CheckboxSelectionModel();this.roleGrid=new Ext.grid.GridPanel({sm:c,region:"west",width:350,bodyStyle:"border:none;border-right:2px;",viewConfig:{forceFit:true},cm:new Ext.grid.ColumnModel([c,new Ext.grid.RowNumberer({header:"\u6434\u5fd3\u5f7f",width:40}),{header:"ID",dataIndex:"id",hideable:true,hidden:true},{header:"\u7459\u6395\u58ca\u7f02\u682b\u721c",sortable:true,width:70,dataIndex:"name"},{header:"\u935a\u5d87\u041e",sortable:true,width:100,dataIndex:"title"},{header:"\u7ee0\ufffd\u6d60\ufffd",sortable:true,width:80,dataIndex:"desciption",hidden:true}]),store:new Ext.data.JsonStore({fields:["id","name","title","description"]})});this.roleGrid.on("rowclick",function(i,h){var e=i.getStore().getAt(h);var f=this.rolePanel.getComponent(1).getComponent(0);var d=this.rolePanel.getComponent(1).getComponent(1);d.getSelectionModel().select(d.getRootNode());f.getStore().removeAll();Ext.Ajax.request({url:"role.java?cmd=loadPermission&other=loadSystemMenuTree",params:{id:e.get("id")},success:function(g){var j=Ext.decode(g.responseText);if(j){f.getStore().loadData(j);d.getRootNode().reload()}},scope:this})},this);var b={listeners:{click:function(e){var d=this["rolePermissionGrid"];if(e.attributes.id=="root"){d.getStore().clearFilter();return}Ext.Ajax.request({url:"systemMenu.java?cmd=loadPermissions",params:{systemMenuId:e.attributes.id},success:function(g){var h=Ext.decode(g.responseText);if(h){var f=h.result;d.getStore().filterBy(function(j){var i=false;Ext.each(f,function(k){if(j.get("id")==k.id){i=true;return false}});if(i){return j}})}else{d.getStore().filterBy(function(){},this)}},scope:this})},scope:this}};var a=new Ext.tree.TreeLoader({iconCls:"disco-tree-node-icon",url:"role.java?cmd=getSystemMenuTree",listeners:{beforeload:function(f,d){f.baseParams={};var e=this.roleGrid.selModel.getSelected();if(e){f.baseParams.roleId=e.get("id")}else{return false}if(d.attributes.id!="root"){f.baseParams.id=d.attributes.id}},scope:this}});this.rolePanel=new Ext.Panel({layout:"border",title:"\u9422\u3126\u57db\u7459\u6395\u58ca",border:false,bbar:[{text:"\u5a23\u8bf2\u59de\u7459\u6395\u58ca",cls:"x-btn-text-icon",icon:"img/icons/application_form_add.png",handler:this.choiceSelectGridData("roleGrid","selectRoleWin","RoleList","\u95ab\u590b\u5ae8\u7459\u6395\u58ca"),scope:this},{text:"\u9352\u72bb\u6ace\u7459\u6395\u58ca",cls:"x-btn-text-icon",icon:"img/icons/application_form_delete.png",handler:function(){Disco.Ext.Util.removeGridRows(this.roleGrid)},scope:this}],items:[this.roleGrid,this.createPermissionPanel(a,null,null,b,"rolePermissionGrid","systemMenu")]});return this.rolePanel},createunEditPanel:function(){var a={listeners:{click:function(d){var c=this["disablePermissionsGrid"];if(d.attributes.id=="root"){c.getStore().removeAll();c.getStore().loadData({rowCount:this["disablePermissionsGrid"].tempCheck.getCount(),result:this["disablePermissionsGrid"].tempCheck.items})}else{c.getStore().removeAll();c.getStore().baseParams={systemMenuId:d.attributes.id};c.getStore().load()}},scope:this}};var b=new Ext.grid.CheckboxSelectionModel({listeners:{selectionchange:function(d){var c=this["disablePermissionsGrid"];c.store.each(function(e){if(d.isSelected(e)){this["disablePermissionsGrid"].tempCheck.add(e.data)}else{this["disablePermissionsGrid"].tempCheck.removeKey(e.get("id"))}},this)},scope:this}});this.disablePanel=new Ext.Panel({layout:"border",title:"\u7ec2\u4f7a\u6564\u93c9\u51ae\u6aba",border:false,items:[this.createPermissionPanel(Global.platformMenuLoader,b,null,a,"disablePermissionsGrid","disableSystemMenu")]});this["disablePermissionsGrid"].tempCheck=new Ext.util.MixedCollection();this["disablePermissionsGrid"].store.on("datachanged",function(){var c=[];var d=this["disablePermissionsGrid"];this["disablePermissionsGrid"].tempCheck.each(function(e){if(d.getStore().getById(e.id)){c.push(d.getStore().getById(e.id))}},this);(function(){d.getSelectionModel().selectRecords(c,true)}).defer(1,this)},this);return this.disablePanel},createEditPanel:function(){var a={listeners:{click:function(d){var c=this.editPanel.getComponent(0).grid;if(d.attributes.id=="root"){c.getStore().removeAll();c.getStore().loadData({rowCount:this["extraPermissionGrid"].tempCheck.getCount(),result:this["extraPermissionGrid"].tempCheck.items})}else{c.getStore().removeAll();c.getStore().baseParams={systemMenuId:d.attributes.id};c.getStore().load()}},scope:this}};var b=new Ext.grid.CheckboxSelectionModel({listeners:{selectionchange:function(d){var c=this.editPanel.getComponent(0).grid;c.store.each(function(e){if(d.isSelected(e)){this["extraPermissionGrid"].tempCheck.add(e.data)}else{this["extraPermissionGrid"].tempCheck.removeKey(e.get("id"))}},this)},scope:this}});this.editPanel=new Ext.Panel({layout:"border",title:"\u68f0\u6fc6\ue63b\u93c9\u51ae\u6aba",border:false,items:[this.createPermissionPanel(Global.platformMenuLoader,b,null,a,"extraPermissionGrid","extraSystemMenu")]});this["extraPermissionGrid"].tempCheck=new Ext.util.MixedCollection();this["extraPermissionGrid"].store.on("datachanged",function(){var c=[];var d=this["extraPermissionGrid"];this["extraPermissionGrid"].tempCheck.each(function(e){if(d.getStore().getById(e.id)){c.push(d.getStore().getById(e.id))}},this);(function(){d.getSelectionModel().selectRecords(c,true)}).defer(1,this)},this);return this.editPanel},createForm:function(){var b=new Ext.grid.CheckboxSelectionModel();this.deptGrid=new Ext.grid.GridPanel({title:"\u68f0\u6fc6\ue63b\u93c8\u70d8\u702f",sm:b,region:"west",width:250,viewConfig:{forceFit:true},cm:new Ext.grid.ColumnModel([b,new Ext.grid.RowNumberer({header:"\u6434\u5fd3\u5f7f",width:40}),{header:"ID",dataIndex:"id",hideable:true,hidden:true},{header:"\u93c8\u70d8\u702f\u935a\u5d87\u041e",sortable:true,width:70,dataIndex:"title"},{header:"\u93b5\ufffd\u705e\u70b4\u6e80\u93cb\ufffd",sortable:true,width:70,dataIndex:"parent",renderer:this.objectRender("title")},{header:"\u93c8\u70d8\u702f\u7ee0\uff04\u608a\u935b\ufffd",sortable:true,width:100,dataIndex:"admin",renderer:this.objectRender("trueName")}]),store:new Ext.data.JsonStore({fields:["id","sn","title","admin","path"]}),bbar:[{text:"\u5a23\u8bf2\u59de\u93c8\u70d8\u702f",cls:"x-btn-text-icon",icon:"img/icons/application_form_add.png",handler:this.selectOtherDepts,scope:this},{text:"\u9352\u72bb\u6ace\u93c8\u70d8\u702f",cls:"x-btn-text-icon",icon:"img/icons/application_form_delete.png",handler:function(){Disco.Ext.Util.removeGridRows(this.deptGrid)},scope:this}]});var a=new Ext.form.FormPanel({labelWidth:80,labelAlign:"right",border:false,items:[{xtype:"hidden",name:"id"},{height:327,labelWidth:80,frame:true,border:false,items:Disco.Ext.Util.buildColumnForm({fieldLabel:"\u9422\u3126\u57db\u935a\u5d87\u041e",name:"name",allowBlank:false,listeners:{scope:this,blur:function(h){var f=this;var e=h.getValue();var g=f.fp.form.findField("id").getValue();if(e||g){return}var d=function(i){var c=Ext.decode(i);if(c&&!c.success){Ext.Msg.alert("\u93bb\u6130\u554b","\u9422\u3126\u57db\u935a\u5d89\u5678\u6fb6\u5d8f\u7d1d\u7487\u70fd\u5678\u93c2\u677f\u7d8d\u934f\u30e4\u7af4\u6d93\ue045\u67ca\u9428\u52ed\u6564\u93b4\u5cf0\u6095");h.setValue(null);h.focus();f.fp.form.findField("email").setValue(null);f.fp.form.findField("password").setValue(null)}else{f.fp.form.findField("password").setValue(e);f.fp.form.findField("email").setValue(e+"@ibocomm.sh")}};this.executeQuietlyUrl(this.baseUrl,{name:e,cmd:"checkName"},d)()}}},{fieldLabel:"\u7035\ufffd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u942e\ufffd",name:"password",inputType:"password",allowBlank:false},{fieldLabel:"\u942a\u71b7\u7584\u6fee\u64b3\u6095",name:"trueName"},ConfigConst.BASE.sex,{fieldLabel:"\u6fee\u64b3\u6095\u93b7\u5978\u7176",name:"namePy"},{fieldLabel:"\u935b\u6a3a\u4f10\u9471\u5c7d\u59df",name:"duty"},{fieldLabel:"\u7ec9\u8bf2\u59e9\u9422\u4f43\u763d",name:"mobileTel"},{fieldLabel:"\u6d63\u5fd3\u7562\u9422\u4f43\u763d",name:"homeTel"},{fieldLabel:"\u9422\u4f43\u763d\u9352\u55d8\u6e80",name:"telExt"},{fieldLabel:"\u9354\u70b2\u53d5\u9422\u4f43\u763d",name:"officeTel"},{fieldLabel:"\u701b\ufe40\u5dfb\u93c2\u56e7\u569f",name:"diploma"},{fieldLabel:"\u5b80\u693e\u7d85",name:"station"},{fieldLabel:"\u9471\u5c80\u041e",name:"professional"},{fieldLabel:"\u6d93\u64b2\u7b1f",name:"specialty"},{fieldLabel:"\u6d63\u5fd3\u6f43",name:"address"},{fieldLabel:"\u935b\u6a3a\u4f10\u9422\u71b8\u68e9",name:"birthday"},{name:"email",fieldLabel:"\u935b\u6a3a\u4f10\u9422\u7538\u5056",allowBlank:false},{fieldLabel:"\u6fb6\u52ed\u9a87\u6dc7\u2103\u4f05",name:"rankInfo"},{fieldLabel:"\u7ec9\u4f77\u6c49\u6dc7\u2103\u4f05",name:"privateInfo"},{fieldLabel:"\u6fb6\u56e8\u655e",name:"description"},Disco.Ext.Util.buildCombox("types","\u935b\u6a3a\u4f10\u7eeb\u8bf2\u7037",this.employeeTypes,6),{xtype:"treecombo",fieldLabel:"\u7f01\u52ed\u7c90\u93c8\u70d8\u702f",displayField:"title",name:"org",allowBlank:false,hiddenName:"orgId",tree:new Ext.tree.TreePanel({border:false,rootVisible:true,root:new Ext.tree.AsyncTreeNode({id:"root",expanded:true,text:"\u6d93\u5a43\u6363\u9352\u55da\ue511",iconCls:"treeroot-icon",loader:Global.organizationLoader})})},{fieldLabel:"\u93c8\ufffd\u6fb6\u0442\u4fca\u6d60\u5815\u567a",name:"maxMail"},{fieldLabel:"\u93c8\ufffd\u6fb6\u0447\u6aae\u6d60\u5815\u567a",name:"maxAttachment"})},{xtype:"panel",anchor:"100%",height:236,border:false,layout:"fit",cls:"x-plain",items:{xtype:"tabpanel",deferredRender:false,hideBorders:true,activeTab:0,border:false,items:[this.createRolePanel(),this.deptGrid,this.createEditPanel(),this.createunEditPanel()]}}]});return a},searchFormPanel:function(){var a=new Ext.form.FormPanel({frame:true,labelWidth:80,labelAlign:"right",items:[{xtype:"fieldset",title:"\u93cc\u30e8\ue1d7\u93c9\u2032\u6b22",height:140,layout:"column",items:[{columnWidth:0.5,layout:"form",defaultType:"textfield",defaults:{anchor:"-20"},items:[{fieldLabel:"\u9422\u3126\u57db\u935a\u5d87\u041e",name:"name"},{fieldLabel:"\u942a\u71b7\u7584\u6fee\u64b3\u6095",name:"trueName"},{fieldLabel:"\u9471\u65c2\u90f4\u9422\u4f43\u763d",name:"tel"},{fieldLabel:"\u6748\u64b3\u53c6\u93c3\u30e6\u6e61(\u6fee\ufffd)",name:"inputStartTime",xtype:"datefield",format:"Y-m-d"}]},{columnWidth:0.5,layout:"form",defaultType:"textfield",defaults:{width:130},items:[{fieldLabel:"\u9422\u975b\u74d9\u95ad\ue1bb\u6b22",name:"email",anchor:"90%"},{fieldLabel:"\u935a\u581d\u6093\u7f02\u682b\u721c",name:"contractNo",anchor:"90%"},{xtype:"treecombo",fieldLabel:"\u95ae\ufffd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u95c2\ufffd",displayField:"title",name:"orgId",hiddenName:"orgId",anchor:"90%",tree:new Ext.tree.TreePanel({root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u95ab\u590b\u5ae8\u93c8\u70d8\u702f",expanded:true,loader:Global.organizationLoader})})},{fieldLabel:"\u6748\u64b3\u53c6\u93c3\u30e6\u6e61(\u93c8\ufffd)",name:"inputEndTime",anchor:"90%",xtype:"datefield",format:"Y-m-d"}]}]}]});return a},gridStoreRemoveAll:function(){var a=Array.prototype.slice.call(arguments,0);Ext.each(a,function(b){if(Ext.type("string")&&this[b]){this[b].store.removeAll()}else{if(Ext.type("object")){b.store.removeAll()}}},this)},onCreate:function(){this.fp.findByType("tabpanel")[0].setActiveTab(0);this["extraPermissionGrid"].tempCheck.clear();this["disablePermissionsGrid"].tempCheck.clear();this.gridStoreRemoveAll("extraPermissionGrid","disablePermissionsGrid","rolePermissionGrid",this.roleGrid,this.deptGrid);this.fp.form.findField("password").el.dom.readOnly=false},onEdit:function(b){this.fp.findByType("tabpanel")[0].setActiveTab(0);this["extraPermissionGrid"].tempCheck.clear();this["disablePermissionsGrid"].tempCheck.clear();var a=this.grid.getSelectionModel().getSelected();if(b){this.gridStoreRemoveAll("extraPermissionGrid","disablePermissionsGrid","rolePermissionGrid",this.roleGrid,this.deptGrid);if(a&&a.get("permissions")){this["extraPermissionGrid"].tempCheck.addAll(a.get("permissions"));this["extraPermissionGrid"].store.loadData({rowCount:a.get("permissions").length,result:a.get("permissions")})}if(a&&a.get("disablePermissions")){this["disablePermissionsGrid"].tempCheck.addAll(a.get("disablePermissions"));this["disablePermissionsGrid"].store.loadData({rowCount:a.get("disablePermissions").length,result:a.get("disablePermissions")})}this.roleGrid.store.loadData(this.grid.getSelectionModel().getSelected().get("roles")||{});this.deptGrid.store.loadData(this.grid.getSelectionModel().getSelected().get("otherDepts")||{});this.fp.form.findField("password").el.dom.readOnly=true}return b},getGridValue:function(b){var c="";for(var a=0;a<b.store.getCount();a++){var d=b.store.getAt(a);c+=d.get("id")+","}return c},uploadEmployeeInfo:function(){if(!this.uploadEmployeeInfoWin){this.uploadEmployeeInfoWin=new Ext.Window({title:"\u6d60\u5da6xcel\u6d93\ue15e\ue1f1\u934f\u30e5\u61b3\u5bb8\u30e6\u669f\u93b9\ue1bc\u57cc\u7eef\u8364\u7cba\u6d93\ufffd",width:500,height:230,modal:true,layout:"fit",border:false,closeAction:"hide",items:{xtype:"form",fileUpload:true,items:[{xtype:"fieldset",title:"\u95ab\u590b\u5ae8excel\u93c2\u56e6\u6b22",autoHeight:true,items:{xtype:"textfield",hideLabel:true,inputType:"file",name:"file",anchor:"100%"}},{xtype:"fieldset",title:"\u7035\u714e\u53c6\u7487\u5b58\u69d1",html:"\u6769\u612f\ue511\u7035\u714e\u53c6office 2003 2007 2010\u9417\u581f\u6e70\u9422\u71b8\u579a\u9428\u51dfxcel\u93c2\u56e6\u6b22\u951b\u5c7d\u82df\u6d93\u65c7\ue1ec\u6d93\u30e6\u7278\u7035\u572d\u53ceExcel\u6d93\ue160\u6b91\u9352\u693e\u7af4\u7039\u6c33\ue6e6\u6d93\u5ea1\u74e7\u5a08\u975b\ue1ee\u6434\ufffd",autoHeight:true}]},buttons:[{text:"\u7ead\ue1bc\u757e",handler:function(){alert(this.baseUrl);this.uploadEmployeeInfoWin.getComponent(0).form.submit({url:this.baseUrl,params:{cmd:"import"},waitMsg:"\u7487\u98ce\u25e2\u934a\u6b19\u7d1d\u59dd\uff45\u6e6a\u7035\u714e\u53c6\u93c1\u7248\u5d41",success:function(){Ext.Msg.alert("\u93bb\u612e\u305a","\u93c1\u7248\u5d41\u7035\u714e\u53c6\u93b4\u612c\u59db!",function(){this.store.reload()},this)},failure:function(){Ext.Msg.alert("\u93bb\u612e\u305a","\u93c1\u7248\u5d41\u7035\u714e\u53c6\u9351\u6d2a\u654a\u951b\u5c83\ue1ec\u59ab\ufffd\u5a34\u5b2b\u588d\u95ab\u590b\u5ae8\u9428\u52ec\u6783\u6d60\u8235\u7278\u5bee\u5fd4\u69f8\u935a\ufe3d\ue11c\u7ead\ufffd")},scope:this})},scope:this},{text:"\u9359\u6828\u79f7",handler:function(){this.uploadEmployeeInfoWin.hide()},scope:this}]})}this.uploadEmployeeInfoWin.show()},save:function(){var a=[];this.deptGrid.getStore().each(function(b){a=a.concat(b.get("path"))},this);this.fp.form.baseParams={permissions:this["extraPermissionGrid"].tempCheck.keys.join(","),disablePermissions:this["disablePermissionsGrid"].tempCheck.keys.join(","),roles:this.getGridValue(this.roleGrid),otherDepts:this.getGridValue(this.deptGrid),otherDeptPath:a.distinct(true).join(",")};EmployeePanel.superclass.save.call(this)},createWin:function(b,a){return this.initWin(800,630,"\u935b\u6a3a\u4f10\u6dc7\u2103\u4f05",b,a)},deptRender:function(a){return a?a.title:"\u6d93\u5a43\u6363\u9352\u55da\ue511"},employeeTypesRender:function(a){if(a==1){return"\u93be\u626e\u01f9\u6d5c\ufffd"}else{if(a==2){return"\u95ae\u3129\u68ec\u93c0\ue21d\ue511\u7ee0\uff04\u608a\u935b\ufffd"}else{if(a==3){return"\u9352\u55da\ue511\u7ee0\uff04\u608a\u935b\ufffd"}else{if(a==4){return"\u95ae\u3129\u68ec\u93c0\ue21d\ue511\u7039\u2103\u7273\u6d5c\ufffd"}else{if(a==5){return"\u9352\u55da\ue511\u7ee0\uff04\u608a\u935b\ufffd"}else{if(a==6){return"\u934f\u8dfa\u7560\u7eeb\u8bf2\u7037"}}}}}}},statusRender:function(a){if(a==-1){return"<font color='red'>\u7ec2\u4f7a\u6564</font>"}else{return"\u59dd\uff45\u7236"}},doLoadAll:function(){this.store.load({})},filterData:function(b,d){var a=b.parentMenu.name;var c=b.filterValue;this.store.baseParams={};this.store.baseParams[a]=c;this.refresh(false)},storeMapping:["id","name","trueName","otherDepts","email","contractNo","duty","password","tel","registerTime","sn","org","status","sex","workerOnly","roles","permissions","disablePermissions","namePy","remark","mobileTel","homeTel","telExt","officeTel","diploma","station","professional","specialty","address","birthday","maxMail","maxAttachment","rankInfo","privateInfo","description","types"],initComponent:function(){this.cm=new Ext.grid.ColumnModel([{header:"\u9422\u3126\u57db\u935a\ufffd",sortable:true,width:80,align:"center",dataIndex:"name"},{header:"\u935b\u6a3a\u4f10\u6fee\u64b3\u6095",sortable:true,width:100,align:"center",dataIndex:"trueName"},{header:"\u93b5\ufffd\u9366\u3126\u6e80\u93cb\ufffd",sortable:true,align:"center",width:100,dataIndex:"org",renderer:this.deptRender},{header:"\u7f02\u682b\u721c(\u7eef\u8364\u7cba\u9422\u71b8\u579a)",sortable:true,align:"center",hidden:true,width:100,dataIndex:"sn"},{width:80,sortable:true,header:"\u935b\u6a3a\u4f10\u7eeb\u8bf2\u57c6",dataIndex:"types",align:"center",renderer:this.employeeTypesRender},{header:"\u5a09\u3125\u553d\u93c3\u5815\u68ff",sortable:true,align:"center",width:100,dataIndex:"registerTime",renderer:this.dateRender()},{header:"\u9418\u8235\ufffd\ufffd",sortable:true,width:50,align:"center",dataIndex:"status",align:"center",renderer:this.statusRender}]);var a=Ext.id(null,"filterGroup");EmployeePanel.superclass.initComponent.call(this)}});EmployeeManagePanel=Ext.extend(Ext.Panel,{layout:"border",border:false,hideBorders:true,clickDeptNode:function(b){var c=b.attributes.id=="root"?"":b.attributes.id;var a=this.crudListPanel.grid;a.getStore().baseParams={orgId:c};this.crudListPanel.refresh(false)},createDeptTree:function(){return new Ext.tree.TreePanel({title:"\u7f01\u52ed\u7c90\u93c8\u70d8\u702f\u93cd\ufffd",region:"west",border:false,width:200,rootVisible:true,autoScroll:true,tools:[{id:"refresh",handler:function(){Global.organizationLoader.remoteObject.clearData();this.deptTree.root.reload()},scope:this}],root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u6d93\u5a43\u6363\u9352\u55da\ue511",iconCls:"treeroot-icon",expanded:true,loader:Global.organizationLoader}),listeners:{scope:this,click:this.clickDeptNode}})},initComponent:function(){this.deptTree=this.createDeptTree();this.crudListPanel=new EmployeePanel({margins:"0 0 0 5",region:"center"});this.items=[this.deptTree,this.crudListPanel];EmployeeManagePanel.superclass.initComponent.call(this)}});
