if(typeof Global==="undefined"){Global={}}Ext.apply(Global,{CLIENT:{id:"",fullName:"",title:""},setClient:function(a){this.CLIENT=a}});if(!Global.depotLoader){Ext.apply(Global,{depotLoader:new Disco.Ext.MemoryTreeLoader({varName:"Global.DEPOT_NODES",lazyLoad:true,leafOnly:true,transferNode:{text:"title"},url:"depot.java?cmd=getDepotTree&pageSize=-1&treeData=true&all=true",listeners:{beforeload:function(c,a){var b=(a.id.indexOf("root")<0&&!isNaN(parseInt(a.id,10)))?a.id:"";c.baseParams.id=b;if(typeof a.attributes.checked!=="undefined"){c.baseParams.checked=false}}}})})}if(!Global.departmentLoader){Global.departmentLoader=new Disco.Ext.MemoryTreeLoader({lazyLoad:true,leafOnly:true,varName:"Global.DEPT_NODES",iconCls:"disco-tree-node-icon",url:"department.java?cmd=getTree&pageSize=-1&treeData=true&all=true",listeners:{beforeload:function(b,a){b.baseParams.id=(a.id.indexOf("root")<0?a.id:"");if(typeof a.attributes.checked!=="undefined"){b.baseParams.checked=false}}}})}ConfigConst={buttons:{add:{id:"tb_add",text:"\u65b0\u589e",cls:"x-btn-text-icon",icon:"images/icons/page_add.png"},edit:{id:"tb_edit",text:"\u4fee\u6539",cls:"x-btn-text-icon",icon:"images/icons/page_edit.png"},search:{id:"tb_search",text:"\u67e5\u8be2",cls:"x-btn-text-icon",icon:"images/icons/page_find.png"},copy:{id:"tb_copy",text:"\u590d\u5236",cls:"x-btn-text-icon",icon:"images/icons/page_copy.png"},remove:{id:"tb_remove",text:"\u5220\u9664",cls:"x-btn-text-icon",icon:"images/icons/page_delete.png"},audit:{id:"tb_audit",text:"\u5ba1\u6838",cls:"x-btn-text-icon",icon:"images/icons/page_code.png"},addChild:{id:"tb_addChild",text:"\u6dfb\u52a0\u5b50\u9879",cls:"x-btn-text-icon",icon:"images/icons/application_form_add.png"},removeChild:{id:"tb_removeChild",text:"\u5220\u9664\u5b50\u9879",cls:"x-btn-text-icon",icon:"images/icons/application_form_delete.png"},red:{id:"tb_red",text:"\u7ea2\u5b57",cls:"x-btn-text-icon",icon:"images/icons/page_red.png",toggleGroup:"btn_red_or_blue",handler:function(){this.red=true;if(this.changeRedBlue){this.changeRedBlue()}},enableToggle:true},blue:{id:"tb_blue",text:"\u84dd\u5b57",cls:"x-btn-text-icon",icon:"images/icons/page_green.png",toggleGroup:"btn_red_or_blue",handler:function(){this.red=false;if(this.changeRedBlue){this.changeRedBlue()}},enableToggle:true,pressed:true},preview:{id:"tb_preview",text:"\u9884\u89c8",cls:"x-btn-text-icon",icon:"images/icons/magnifier.png"},print:{id:"tb_print",text:"\u6253\u5370",cls:"x-btn-text-icon",icon:"images/icons/printer.png"},excel:{id:"tb_excel",text:"\u5bfc\u51fa",cls:"x-btn-text-icon",icon:"images/icons/page_excel.png"},bnt_import:{id:"tb_excel",text:"\u5bfc\u51fa",cls:"x-btn-text-icon",iconCls:"import-icon"}},abstractStore:{id:"id",root:"result",totalProperty:"rowCount",remoteSort:true,fields:["id","name"]}};ConfigConst.BASE={yesNo:Ext.apply({},{disableChoice:true},Disco.Ext.Util.buildCombox("type","\u662f\u5426",[["\u662f",true],["\u5426",false]],false,true)),sex:Ext.apply({},{disableChoice:true},Disco.Ext.Util.buildCombox("sex","\u6027\u522b",[["\u7537","\u7537"],["\u5973","\u5973"]],null,true)),status:Ext.apply({},{disableChoice:true},Disco.Ext.Util.buildCombox("status","\u72b6\u6001",[["\u542f\u7528",0],["\u505c\u7528",-1]],0,true)),systemRegion:{xtype:"treecombo",fieldLabel:"\u6240\u5728\u5730\u533a",name:"region",hiddenName:"region",leafOnly:true,displayField:"title",valueField:"id",tree:new Ext.tree.TreePanel({autoScroll:true,root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u6240\u6709\u533a\u57df",icon:"images/system/root.gif",expanded:true,loader:new Ext.tree.TreeLoader({url:"systemRegion.java?cmd=getSystemRegion&pageSize=-1&treeData=true",listeners:{beforeload:function(b,a){b.baseParams.id=(a.id.indexOf("root")<0?a.id:"")}}})})})},dept:{xtype:"treecombo",fieldLabel:"\u90e8\u95e8",name:"dept",hiddenName:"dept",displayField:"title",leafOnly:false,valueField:"id",editable:false,tree:new Ext.tree.TreePanel({autoScroll:true,root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u6240\u6709\u90e8\u95e8",icon:"images/system/root.gif",expanded:true,loader:new Disco.Ext.MemoryTreeLoader({varName:"Global.DEPARTMENT_NODES",lazyLoad:true,url:"department.java?cmd=getTree&pageSize=-1&treeData=true&all=true",listeners:{beforeload:function(c,a){var b=(a.id.indexOf("root")<0&&!isNaN(parseInt(a.id,10)))?a.id:"";c.baseParams.id=b;if(typeof a.attributes.checked!=="undefined"){c.baseParams.checked=false}}}})})})},getDictionaryCombo:function(c,b,f,a,e,d){return{xtype:"smartcombo",name:c,hiddenName:c,displayField:"title",valueField:a?a:"id",lazyRender:true,triggerAction:"all",typeAhead:true,editable:d,allowBlank:!e,sn:f,objectCreator:{appClass:"SystemDictionaryDetailPanel",script:"/systemManage/SystemDictionaryManagePanel.js"},createWinReady:function(g){if(this.fieldLabel){g.setTitle("\u65b0\u5efa"+this.fieldLabel)}if(this.sn){g.findSomeThing("parentSn").setOriginalValue(this.sn)}},store:new Ext.data.JsonStore({id:"id",url:"systemDictionary.java?cmd=getDictionaryBySn&sn="+f,root:"result",totalProperty:"rowCount",remoteSort:true,baseParams:{pageSize:"-1"},fields:["id","title","tvalue"]}),fieldLabel:b}},companyDictionary:Disco.Ext.Util.buildRemoteCombox("item","\u6570\u636e\u5b57\u5178","/companyDictionary.java?cmd=getDictionaryItemBySn",["id","title","tvalue"],"title","id",true),getCompanyDictionaryCombo:function(c,b,f,a,e,d){return{xtype:"smartcombo",name:c,hiddenName:c,displayField:"title",valueField:a?a:"id",lazyRender:true,triggerAction:"all",typeAhead:true,editable:d,allowBlank:!e,sn:f,objectCreator:{appClass:"CompanyDictionaryItemPanel",script:"base/CompanyDictionaryManagePanel.js"},createWinReady:function(g){if(this.fieldLabel){g.setTitle("\u65b0\u5efa"+this.fieldLabel)}if(this.sn){g.findSomeThing("parentSn").setOriginalValue(this.sn)}},store:new Ext.data.JsonStore({id:"id",url:"companyDictionary.java?cmd=getDictionaryItemBySn&sn="+f,root:"result",totalProperty:"rowCount",remoteSort:true,baseParams:{pageSize:"-1"},fields:["id","title","tvalue"]}),fieldLabel:b}}};ConfigConst.STOCK={showBill:function(f,d,i){var j=f.store.getAt(d).get("billId");var b=f.store.getAt(d).get("types");if(j){var a=j.indexOf("-");if(a>0){j=j.substring(a+1)}var h="";if(b.indexOf("-in")>0){var c=parseInt(b);switch(c){case 0:h="StockIncomePurchasePanel";break;case 1:h="StockIncomeProducePanel";break;case 2:h="StockIncomeProfitPanel";break;case 3:h="StockIncomeOtherPanel";break;case 4:h="StockIncomeInitPanel";break;default:h="StockIncomeOtherPanel"}}else{var c=parseInt(b);switch(c){case 0:h="StockOutcomeOrdersPanel";break;case 1:h="StockOutcomeProducePanel";break;case 2:h="StockOutcomeLossPanel";break;case 3:h="StockOutcomeOtherPanel";break;case 4:h="StockOutcomeLossPanel";break;default:h="StockOutcomeOtherPanel"}}Disco.Ext.Util.viewObject(h,null,"stock/"+h+".js",null,j)}},depot:{xtype:"treecombo",fieldLabel:"\u4ed3\u5e93",name:"depot",hiddenName:"depot",displayField:"title",leafOnly:true,valueField:"id",width:110,listeners:{specialkey:function(){this.onTriggerClick()},scope:this},tree:new Ext.tree.TreePanel({autoScroll:true,root:new Ext.tree.AsyncTreeNode({text:"\u6240\u6709\u4ed3\u5e93",icon:"images/system/root.gif",expanded:true,loader:Global.depotLoader})})}};ConfigConst.CRM={shoppingGuide:Ext.apply({},{xtype:"guideCombo",editable:true,anchor:"-0"},Disco.Ext.Util.buildRemoteCombox("employee","\u5458\u5de5","employee.java?cmd=getShoppingGuide",["id","name","trueName","duty","tel","dept","sex","email"],"trueName","id",true)),user:Ext.apply({},{xtype:"employeecombo",disableChoice:true,editable:true,anchor:"-0"},Disco.Ext.Util.buildRemoteCombox("user","\u5458\u5de5","employee.java?cmd=getDepartmentUserBySn&deptSn",["id","name","trueName","duty","tel","dept","sex","email"],"name","id",true,"cache_user_store")),seller:Ext.apply({},{xtype:"employeecombo",editable:true,anchor:"-0"},Disco.Ext.Util.buildRemoteCombox("seller","\u4e1a\u52a1\u5458","employee.java?cmd=list",["id","name","trueName","duty","tel","dept","sex","email"],"trueName","id",true,"cache_user_store")),client:Ext.apply({},{xtype:"clientcombo",disableChoice:true,editable:true,typeAhead:false,width:160,listWidth:250,pageSize:10,enableKeyEvents:true,minChars:2,queryParam:"searchKey"},Disco.Ext.Util.buildRemoteCombox("client","\u5ba2\u6237","client.java?cmd=autocompleteList",["id","fullName","name","tel","address","fax","linkMan"],"name","id",true)),supplier:Ext.apply({},{xtype:"clientcombo",disableChoice:true,editable:true,baseUrl:"supplier.java",width:160,listWidth:250,pageSize:10,enableKeyEvents:true,minChars:2,queryParam:"searchKey"},Disco.Ext.Util.buildRemoteCombox("supplier","\u4f9b\u8d27\u5546","supplier.java?cmd=autocompleteList",["id","fullName","name","tel","address","fax","linkMan"],"name","id",true)),distributor:Ext.apply({},{xtype:"clientcombo",disableChoice:true,editable:true,baseUrl:"distributor.java",width:250,listWidth:250,pageSize:15,enableKeyEvents:true,minChars:20,queryParam:"searchKey"},Disco.Ext.Util.buildRemoteCombox("distributor","\u5206\u9500\u5546","distributor.java?cmd=autocompleteList&pageSize=15",["id","fullName","name","tel","address","fax","linkMan","accountBalance","qualityAssure","other1","company"],"name","id",true)),orders:Ext.apply({},{editable:true,enableKeyEvents:true,minChars:2,pageSize:10,queryParam:"searchKey"},Disco.Ext.Util.buildRemoteCombox("orders","\u9500\u552e\u8ba2\u5355","orders.java?cmd=autocompleteList",["id","orderInfo","sn","buyTime","clientId","clientName"],"orderInfo","id",true)),contract:Ext.apply({},{editable:true,enableKeyEvents:true,minChars:2,pageSize:10,queryParam:"searchKey"},Disco.Ext.Util.buildRemoteCombox("contract","\u5408\u540c","clientContract.java?cmd=autocompleteList",["id","title","clientId","clientName","detail"],"title","id",true)),linkMan:Ext.apply({},{editable:true,minChars:2,pageSize:10,listWidth:200,enableKeyEvents:true,queryParam:"searchKey"},Disco.Ext.Util.buildRemoteCombox("linkMan","\u8054\u7cfb\u4eba","linkMan.java?cmd=autocompleteList",["id","tel","trueName","appellation","detail","clientId","clientName"],"detail","id",true)),opporunity:Ext.apply({},{editable:true,minChars:2,pageSize:10,enableKeyEvents:true,queryParam:"searchKey"},Disco.Ext.Util.buildRemoteCombox("opporunity","\u9500\u552e\u673a\u4f1a","businessOpporunity.java?cmd=autocompleteList",["id","title","beginTime","userId","userName","clientId","clientName"],"title","id",true)),event:Ext.apply({},{editable:true,minChars:2,pageSize:10,enableKeyEvents:true,queryParam:"searchKey"},Disco.Ext.Util.buildRemoteCombox("event","\u9500\u552e\u673a\u4f1a","clientEvent.java?cmd=autocompleteList",["id","title","beginTime","userId","userName","clientId","clientName"],"title","id",true)),qa:Ext.apply({},{editable:true,minChars:2,pageSize:10,enableKeyEvents:true,queryParam:"searchKey"},Disco.Ext.Util.buildRemoteCombox("qa","\u5bf9\u5e94QA","clientQA.java?cmd=autocompleteList",["id","question"],"question","id",true)),ordersQuote:Ext.apply({},{pageSize:10},Disco.Ext.Util.buildRemoteCombox("ordersQuote","\u4e1a\u52a1\u5458","ordersQuote.java?cmd=autocompleteList",["id","quoteInfo","sn","vdate","clientId","clientName"],"quoteInfo","id",true)),trade:Disco.Ext.Util.buildRemoteCombox("trade","\u884c\u4e1a","trade.java?cmd=list",["id","title","sn"],"title","id",true),brand:Ext.apply({},{disableChoice:true},Disco.Ext.Util.buildRemoteCombox("brand","\u54c1\u724c","brand.java?cmd=list",["id","name"],"name")),deliveryType:Disco.Ext.Util.buildRemoteCombox("deliveryType","\u9001\u8d27\u65b9\u5f0f","deliveryType.java?cmd=list&pageSize=-1",["id","name","price","freePrice"],"name","id",true),payType:Disco.Ext.Util.buildRemoteCombox("payType","\u652f\u4ed8\u65b9\u5f0f","paymentType.java?cmd=list&pageSize=-1",["id","name","discount","intro"],"name","id",true),product:Ext.apply({},{xtype:"productcombo",disableChoice:true,editable:true,anchor:"-0",pageSize:15,enableKeyEvents:true,minChars:2,queryParam:"searchKey",listWidth:200,queryDelay:1000},Disco.Ext.Util.buildRemoteCombox("product","\u4e1a\u52a1\u5458","product.java?cmd=autocompleteList",["id","fullName","attributeType","title","sn","keyword","simiProducts","brand","unit","spec","model","types","buyPrice","dir",{name:"dirId",mapping:"dir"},"reCost","salePrice","ratePrice","marketPrice","tradePrice","bottomPrice","stockWarnNum","leastOrderNum","encapNum","size","updateTime","provideType","virtualStock","storeNum","intro","content","pj","star","auditing","inputTime","readTimes","status","vdate","propertys","color","colorSn","stockMinNum","stockMaxNum","encapUnit","encapSn","encaped","buyPeriod","colors","sizes","sizeGroup","stockNO"],"fullName","id",true))};ConfigConst.ACCOUNT={showCert:function(c,b,d){var a=c.store.getAt(b).get("certId");if(a){Disco.Ext.Util.viewObject("TransferCertificatePanel",null,"account/CertificatePanel.js",null,a)}},accountEntryBrief:Ext.apply({},{xtype:"combo",width:160,listWidth:250,minChars:2,pageSize:20,queryParam:"searchKey"},Disco.Ext.Util.buildRemoteCombox("brief","\u6458\u8981","accountEntryBrief.java?cmd=list&pageSize=20",["id","title"])),accountChart:Ext.apply({},{xtype:"accountchartcombo",returnObject:true,typeAhead:false,enableKeyEvents:true,width:160,listWidth:250,minChars:2,pageSize:20,queryParam:"searchKey",value:""},Disco.Ext.Util.buildRemoteCombox("accountChart","\u4f1a\u8ba1\u79d1\u76ee","accountChart.java?cmd=autocompleteList",["id","title","sn","fullName"],"fullName","id",true))};AccoutChartGridList=Ext.extend(BaseGridList,{border:false,gridForceFit:true,selectSingle:false,pageSize:15,url:"accountChart.java?cmd=list&pageSize=15",types:[["\u8d44\u4ea7",1],["\u8d1f\u503a",2],["\u6240\u6709\u8005\u6743\u76ca",3],["\u6210\u672c",4],["\u635f\u76ca",5]],refresh:function(){this.store.baseParams={searchKey:this.btn_sn.getValue(),title:this.btn_title.getValue()};this.store.removeAll();this.store.reload()},reset:function(){this.btn_sn.reset();this.btn_title.reset();this.refresh()},balanceTypeRender:function(a){if(a=="debit"){return"\u501f\u65b9"}else{if(a=="credit"){return"\u8d37\u65b9"}}},storeMapping:["id","sn","lev","title","dirPath","createTime","types","parent","sequence","intro","balanceType","status"],initComponent:function(){var b={border:false},a=null;if(this.selectSingle){b.sm=new Ext.grid.RowSelectionModel({singleSelect:true})}else{a=new Ext.grid.CheckboxSelectionModel();b.sm=a}this.gridConfig=Ext.apply({},b);this.cm=new Ext.grid.ColumnModel([a?a:new Ext.grid.RowNumberer({header:"\u5e8f\u53f7",width:35}),{header:"\u540d\u79f0",sortable:true,width:150,dataIndex:"title"},{header:"\u7f16\u53f7",sortable:true,width:60,dataIndex:"sn"},{header:"\u7c7b\u522b",sortable:true,width:60,dataIndex:"types",renderer:this.typesRender(this.types)},{header:"\u4f59\u989d\u65b9\u5411",sortable:true,width:60,dataIndex:"balanceType",renderer:this.balanceTypeRender},{header:"\u7ea7\u522b",sortable:true,width:50,dataIndex:"lev"},{header:"\u7236\u79d1\u76ee",sortable:true,width:120,dataIndex:"parent",renderer:this.objectRender("title")},{header:"\u521b\u5efa\u65f6\u95f4",sortable:true,width:100,dataIndex:"createTime",renderer:this.dateRender("Y-m-d"),hidden:true},{header:"\u6392\u5e8f",sortable:true,width:50,dataIndex:"sequence"}]);this.btn_sn=new Ext.form.TextField({xtype:"textfield",width:100,listeners:{change:this.refresh,scope:this}});this.btn_title=new Ext.form.TextField({xtype:"textfield",width:80,listeners:{change:this.refresh,scope:this}});this.tbar=["\u7f16\u53f7:",this.btn_sn,"\u540d\u79f0:",this.btn_title,{text:"\u67e5\u8be2",handler:this.refresh,scope:this,cls:"x-btn-text-icon",icon:"images/icon-png/search.png"},{text:"\u91cd\u7f6e",handler:this.reset,scope:this,cls:"x-btn-text-icon",icon:"images/icons/arrow_undo.png"}];AccoutChartGridList.superclass.initComponent.call(this);this.store.on("load",function(d,c){if(c&&c.length>0){this.grid.getSelectionModel().selectFirstRow();this.grid.getView().focusRow(0)}},this)}});AccountChartSelectWin=Ext.extend(Ext.Window,{title:"\u9009\u62e9\u4f1a\u8ba1\u79d1\u76ee",width:800,height:500,layout:"border",buttonAlign:"center",closeAction:"hide",modal:true,selectSingle:false,callback:Ext.emptyFn,maximizable:true,listeners:{maximize:function(a){a.doLayout()},restore:function(a){a.doLayout()}},choice:function(d){var b=this.list.grid.getSelectionModel().getSelections();if(!b||b.length<1){Ext.Msg.alert("$!{lang.get('Prompt')}","$!{lang.get('Select first')}");return false}var a=[];for(var c=0;c<b.length;c++){a[c]=b[c].data;a[c].fullName=a[c].title+"["+a[c].sn+"]"}this.hide();this.fireEvent("select",a,this)},initComponent:function(){this.keys=[{key:Ext.EventObject.ENTER,fn:this.choice,stopEvent:true,scope:this},{key:Ext.EventObject.ESC,fn:function(){this.hide()},scope:this}];this.buttons=[{text:"\u786e\u5b9a",handler:this.choice,scope:this},{text:"\u6e05\u7a7a"},{text:"\u53d6\u6d88",handler:function(){this.hide()},scope:this}];AccountChartSelectWin.superclass.initComponent.call(this);this.list=new AccoutChartGridList({selectSingle:this.selectSingle,region:"center"});if(!Global.accountChartLoader){Global.accountChartLoader=new Ext.tree.TreeLoader({url:"accountChart.java?cmd=getAccountChartTree&pageSize=-1&treeData=true",listeners:{beforeload:function(b,a){b.baseParams.id=(a.id.indexOf("root")<0?a.id:"");if(typeof a.attributes.checked!=="undefined"){b.baseParams.checked=false}if(a.attributes.isTypes){b.baseParams.isTypes=true}else{b.baseParams.isTypes=""}}}})}this.tree=new Ext.tree.TreePanel({region:"west",floating:false,autoScroll:true,split:true,leafOnly:true,collapsible:true,width:200,tools:[{id:"refresh",handler:function(){this.tree.root.reload()},scope:this}],root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u6240\u6709\u5206\u7c7b",icon:"images/system/root.gif",expanded:true,loader:Global.accountChartLoader})});this.list.tree=this.tree;this.on("show",function(){this.list.grid.store.reload()},this);this.tree.on("click",function(b,a){var c=(b.id!="root"?b.id:"");if(c&&!b.attributes.isTypes){this.list.parentId={id:c,title:b.text}}else{this.list.parentId=null}if(b.attributes.isTypes){this.list.theTypes=b.id}this.list.store.baseParams.parentId=b.attributes.isTypes?"":c;this.list.store.baseParams.types=b.attributes.isTypes?c:"";this.list.store.removeAll();this.list.store.load()},this);this.list.grid.on("rowdblclick",this.choice,this);this.add(this.list);this.add(this.tree);this.addEvents("select")}});AccoutChartComboBox=Ext.extend(Disco.Ext.SmartCombox,{choiceValue:Ext.emptyFn(),selectSingle:true,enableKeyEvents:true,choiceProvider:function(){if(!this.lookupWin){this.lookupWin=new AccountChartSelectWin({selectSingle:this.selectSingle});this.lookupWin.on("select",function(a){if(a&&a.length){var b=a[0][this.displayField?this.displayField:"title"];this.setValue({id:a[0].id,title:b,fullName:b});if(this.choiceValue){this.choiceValue(a[0])}}},this)}this.lookupWin.show()},selectProvider:function(d,a,b){if(this.choiceValue){this.choiceValue(a.data)}},autoSelectBySn:function(f,d){if(d.getKey()==Ext.EventObject.ENTER){var a=f.el.dom.value;var b=this.store.find("title",a);if(b>=0){this.selectProvider(this,this.store.getAt(b),b)}else{Ext.Ajax.request({url:"accountChart.java?cmd=loadBySn",params:{sn:a},success:function(c){var e=Ext.decode(c.responseText);if(e){this.selectProvider(this,{data:e},-1)}else{Ext.Msg.alert("\u63d0\u793a","\u79d1\u76ee\u7f16\u53f7\u4e0d\u6b63\u786e,\u8bf7\u91cd\u65b0\u8f93\u5165!",function(){this.focus(true,100)},this)}},scope:this})}}},onRender:function(c,a){AccoutChartComboBox.superclass.onRender.call(this,c,a);var b=this.el.findParent(".x-form-element",5,true)||this.el.findParent(".x-form-field-wrap",5,true);this.helpIcon=b.createChild({cls:"object-select-icon",style:"width:16px;height:18px; position:absolute; left:0; top:0; display:block; background:transparent no-repeat scroll 0 2px;"});this.helpIcon.on("click",this.choiceProvider,this);this.alignHelpIcon=function(){var d=this.wrap?this.wrap:this.el;this.el.setWidth(this.el.getWidth()-20);this.helpIcon.alignTo(this.el,"tl-tr",[20,0])};this.on("resize",this.alignHelpIcon,this);this.on("select",this.selectProvider,this);this.on("specialkey",this.autoSelectBySn,this)}});Ext.reg("accountchartcombo",AccoutChartComboBox);ProductGridList=Ext.extend(BaseGridList,{border:false,gridForceFit:false,selectSingle:false,url:"product.java?cmd=loadBySn",refresh:function(){this.store.baseParams={searchKey:this.btn_sn.getValue(),title:this.btn_title.getValue(),model:this.btn_model.getValue(),dirId:this.currentDir?this.currentDir.id:""};this.store.removeAll();this.store.reload()},reset:function(){this.btn_sn.reset();this.btn_title.reset();this.refresh()},createProduct:function(){Disco.Ext.Util.addObject("ProductManagePanel",this.refresh.createDelegate(this),"/stock/ProductManagePanel.js","fckeditor/fckeditor.js",function(a){if(this.currentDir){a.getComponent(0).findSomeThing("dirId").setOriginalValue(this.currentDir)}}.createDelegate(this))},storeMapping:["id","sn","title","costPrice","salePrice","marketPrice","spec","model","unit","remark","producer","flows","brand","dir","colorSn","stockNO","tradePrice"],initComponent:function(){var b={border:false},a=null;if(this.selectSingle){b.sm=new Ext.grid.RowSelectionModel({singleSelect:true})}else{a=new Ext.grid.CheckboxSelectionModel();b.sm=a}this.gridConfig=Ext.apply({},b);this.cm=new Ext.grid.ColumnModel([a?a:new Ext.grid.RowNumberer({header:"\u5e8f\u53f7",width:35}),{header:"\u540d\u79f0",sortable:true,width:150,dataIndex:"title"},{header:"\u7f16\u53f7",sortable:true,width:80,dataIndex:"sn"},{header:"\u54c1\u724c",sortable:true,width:60,dataIndex:"brand",renderer:this.objectRender("name")},{header:"\u8272\u53f7",sortable:true,width:60,dataIndex:"colorSn"},{header:"\u7c7b\u578b",sortable:true,width:60,dataIndex:"dir",renderer:Disco.Ext.Util.objectRender("title")},{header:"\u5355\u4f4d",sortable:true,width:60,dataIndex:"unit",renderer:this.objectRender("title")},{header:"\u9500\u552e\u4ef7\u683c",sortable:true,width:60,dataIndex:"salePrice"},{header:"\u5c3a\u5bf8\u89c4\u683c",sortable:true,width:60,dataIndex:"spec"},{header:"\u6750\u8d28/\u578b\u53f7",sortable:true,width:80,dataIndex:"model"},{header:"\u5907\u6ce8",sortable:true,width:100,dataIndex:"remark"}]);this.btn_brand=new Disco.Ext.SmartCombox(Ext.apply({},{width:100,listeners:{select:this.refresh,scope:this}},ConfigConst.CRM.brand));this.btn_sn=new Ext.form.TextField({xtype:"textfield",width:80});this.btn_title=new Ext.form.TextField({xtype:"textfield",width:100,listeners:{change:this.refresh,scope:this}});this.btn_model=new Ext.form.TextField({xtype:"textfield",width:80,listeners:{change:this.refresh,scope:this}});this.tbar=["\u5173\u952e\u5b57",this.btn_sn,"\u578b\u53f7:",this.btn_model,"\u540d\u79f0:",this.btn_title,{text:"\u67e5\u8be2",handler:this.refresh,scope:this,cls:"x-btn-text-icon",icon:"images/icon-png/search.png"},{text:"\u91cd\u7f6e",handler:this.reset,scope:this,cls:"x-btn-text-icon",icon:"images/icons/arrow_undo.png"},Ext.apply({},{text:"\u65b0\u5efa\u5546\u54c1",handler:this.createProduct,scope:this},ConfigConst.buttons.addChild)];ProductGridList.superclass.initComponent.call(this);this.store.on("load",function(d,c){if(c&&c.length>0){this.grid.getSelectionModel().selectFirstRow();this.grid.getView().focusRow(0)}},this);this.store.on("beforeload",function(c,d){c.baseParams=c.baseParams||{};c.baseParams.client=Global.CLIENT.id},this)}});ProductSelectWin=Ext.extend(Ext.Window,{title:"\u9009\u62e9\u4ea7\u54c1",width:850,height:500,layout:"border",buttonAlign:"center",closeAction:"hide",autoLoad:true,modal:true,selectSingle:false,callback:Ext.emptyFn,maximizable:true,listeners:{maximize:function(a){a.doLayout()},restore:function(a){a.doLayout()}},choice:function(d){var b=this.list.grid.getSelectionModel().getSelections();if(!b||b.length<1){Ext.Msg.alert("$!{lang.get('Prompt')}","$!{lang.get('Select first')}");return false}var a=[];for(var c=0;c<b.length;c++){a[c]=b[c].data}this.hide();this.fireEvent("select",a,this)},initComponent:function(){this.keys=[{key:Ext.EventObject.ENTER,fn:this.choice,stopEvent:true,scope:this},{key:Ext.EventObject.ESC,fn:function(){this.hide()},scope:this},{key:Ext.EventObject.NUM_PLUS,fn:function(){if(this.list.store.baseParams){this.list.el.mask("\u6b63\u5728\u52a0\u8f7d...","x-mask-loading");this.list.store.baseParams.all=true;Ext.Ajax.request({url:"product.java?cmd=loadBySn",scope:this,params:this.list.store.baseParams,success:function(b){var a=Ext.decode(b.responseText);if(a&&a.rowCount){this.list.grid.store.loadData(a);this.list.store.baseParams.all=null;this.list.el.unmask()}}})}},scope:this}];this.buttons=[{text:"\u786e\u5b9a",handler:this.choice,scope:this},{text:"\u6e05\u7a7a"},{text:"\u53d6\u6d88",handler:function(){this.hide()},scope:this}];ProductSelectWin.superclass.initComponent.call(this);this.list=new ProductGridList({selectSingle:this.selectSingle,region:"center"});this.list.grid.on("rowdblclick",this.choice,this);this.add(this.list);this.addEvents("select")}});ProductComboBox=Ext.extend(Disco.Ext.SmartCombox,{choiceValue:Ext.emptyFn(),selectSingle:true,choiceProvider:function(a,b){if(!this.lookupWin){this.lookupWin=new ProductSelectWin({selectSingle:this.selectSingle,autoLoad:this.autoLoad});this.lookupWin.on("select",function(c){if(c&&c.length){this.setValue({id:c[0].id,title:c[0][this.displayField?this.displayField:"title"]});if(this.choiceValue){this.choiceValue(c[0])}}},this)}if(this.getValue()&&this.getValue().text){this.lookupWin.keyword=this.getValue().text}this.lookupWin.show();if(a&&a.length){this.lookupWin.list.store.loadData({result:a,rowCount:a.length})}},selectProvider:function(d,a,b){if(this.choiceValue){this.choiceValue(a.data)}},autoSelectBySn:function(d,b){if(b.getKey()==Ext.EventObject.ENTER){var a=d.el.dom.value;if(this.store.baseParams){Ext.apply(this.store.baseParams,{sn:a})}Ext.Ajax.request({url:"product.java?cmd=loadBySn",params:this.store.baseParams,success:function(c){var e=Ext.decode(c.responseText);if(e){}else{this.choiceProvider()}},scope:this})}},onRender:function(c,a){ProductComboBox.superclass.onRender.call(this,c,a);var b=this.el.findParent(".x-form-element",5,true)||this.el.findParent(".x-form-field-wrap",5,true);this.helpIcon=b.createChild({cls:"object-select-icon",style:"width:16px;height:18px; position:absolute; left:0; top:0; display:block; background:transparent no-repeat scroll 0 2px;"});this.helpIcon.on("click",this.choiceProvider,this);this.alignHelpIcon=function(){var d=this.wrap?this.wrap:this.el;this.el.setWidth(this.el.getWidth()-20);this.helpIcon.alignTo(this.el,"tl-tr",[20,0])};this.on("resize",this.alignHelpIcon,this);this.on("select",this.selectProvider,this);this.on("keypress",this.autoSelectBySn,this);this.store.on("beforeload",function(d,e){d.baseParams=d.baseParams||{};d.baseParams.client=Global.CLIENT.id})}});Ext.reg("productcombo",ProductComboBox);ClientGridList=Ext.extend(BaseGridList,{border:false,gridForceFit:false,selectSingle:false,columnLock:true,pageSize:18,url:"client.java?cmd=list&pageSize=18",refresh:function(){this.store.baseParams={types:this.btn_types.getValue(),searchKey:this.btn_title.getValue(),sn:this.btn_sn.getValue(),region:this.region};this.store.removeAll();this.store.reload()},reset:function(){this.btn_types.reset();this.btn_title.reset();this.btn_sn.reset();this.refresh()},createClient:function(){Disco.Ext.Util.addObject("ClientPanel",this.refresh.createDelegate(this),"crm/ClientPanel.js",null,function(a){if(this.currentRegion){a.getComponent(0).findSomeThing("region").setOriginalValue(this.currentRegion)}}.createDelegate(this))},storeMapping:["id","fullName","sn","name","shortName","birthday","region","address","zip","tel","fax","layMan","linkMan","email","trade","street","businessScope","homePage","producerType","intro","elite","onTop","passed","turnover","capital","workerNum","businessLicence","taxation","bank","bankCode","qualityAssure","pic","types","status","owner","seller","inputTime","hot","hotInfo","updateTime","lastVisitTime"],initComponent:function(){if(this.baseUrl){this.url=this.baseUrl+"?cmd=list&pageSize=18"}var b={border:false},a=null;if(this.selectSingle){b.sm=new Ext.grid.RowSelectionModel({singleSelect:true})}else{this.columnLock=false;a=new Ext.grid.CheckboxSelectionModel({chkLocked:true});b.sm=a}this.gridConfig=Ext.apply({},b);this.cm=new Ext.grid.ColumnModel([a?a:new Ext.grid.RowNumberer({header:"\u5e8f\u53f7",width:35,locked:true}),{header:"\u5ba2\u6237\u540d\u79f0",sortable:true,width:150,locked:true,dataIndex:"name",renderer:this.customerRender},{header:"\u7f16\u53f7",sortable:true,width:60,dataIndex:"sn"},{header:"\u5ba2\u6237\u7c7b\u578b",sortable:true,width:60,dataIndex:"types",renderer:this.objectRender("title")},{header:"\u884c\u4e1a",sortable:true,width:150,dataIndex:"trade",renderer:this.objectRender("title")},{header:"\u5ba2\u6237\u7b80\u5199",sortable:true,width:70,dataIndex:"shortName"},{header:"\u8054\u7cfb\u4eba",sortable:true,width:60,dataIndex:"linkMan"},{header:"\u7535\u5b50\u90ae\u4ef6",sortable:true,width:100,dataIndex:"email",hidden:true},{header:"\u8054\u7cfb\u7535\u8bdd",sortable:true,width:85,dataIndex:"tel"},{header:"\u4f20\u771f\u53f7\u7801",sortable:true,width:80,dataIndex:"fax",hidden:true},{header:"\u516c\u53f8\u5730\u5740",sortable:true,width:160,dataIndex:"address"},{header:"\u90ae\u653f\u7f16\u7801",sortable:true,width:60,dataIndex:"zip",hidden:true},{header:"\u70ed\u70b9",sortable:true,width:40,dataIndex:"hot",renderer:this.hotRender},{header:"\u72b6\u6001",sortable:true,width:80,dataIndex:"status"},{header:"\u4e1a\u52a1\u5458",sortable:true,width:60,dataIndex:"seller",renderer:this.objectRender("trueName")},{header:"\u6700\u8fd1\u8ddf\u8e2a",sortable:true,width:80,dataIndex:"lastVisitTime",renderer:this.dateRender("Y-m-d")},{header:"\u66f4\u65b0\u65f6\u95f4",sortable:true,width:80,dataIndex:"updateTime",renderer:this.dateRender("Y-m-d")},{header:"\u521b\u7acb\u65e5\u671f",sortable:true,width:80,dataIndex:"birthday",renderer:this.dateRender("Y-m-d")},{header:"\u6240\u5728\u5730\u533a",sortable:true,width:80,dataIndex:"region",renderer:this.objectRender("title"),hidden:true},{header:"\u6cd5\u4eba\u59d3\u540d",sortable:true,width:60,dataIndex:"layMan",hidden:true},{header:"\u7ecf\u8425\u8303\u56f4",sortable:true,width:60,dataIndex:"businessScope",hidden:true},{header:"\u5382\u5546\u4e3b\u9875",sortable:true,width:160,dataIndex:"homePage",renderer:this.linkRenderer,hidden:true},{header:"\u5382\u5546\u5206\u7c7b",sortable:true,width:60,dataIndex:"producerType",hidden:true},{header:"\u5382\u5546\u7b80\u4ecb",sortable:true,width:60,dataIndex:"intro",hidden:true},{header:"\u662f\u5426\u63a8\u8350",sortable:true,width:60,dataIndex:"elite",renderer:this.booleanRender,hidden:true},{header:"\u662f\u5426\u7f6e\u9876",sortable:true,width:60,dataIndex:"onTop",renderer:this.booleanRender,hidden:true},{header:"\u662f\u5426\u542f\u7528",sortable:true,width:60,dataIndex:"passed",renderer:this.booleanRender,hidden:true},{header:"\u8425\u4e1a\u989d",sortable:true,width:60,dataIndex:"turnover",hidden:true},{header:"\u6ce8\u518c\u8d44\u672c",sortable:true,width:60,dataIndex:"capital",hidden:true},{header:"\u5458\u5de5\u6570\u91cf",sortable:true,width:60,dataIndex:"workerNum",hidden:true},{header:"\u5de5\u5546\u6267\u7167",sortable:true,width:60,dataIndex:"businessLicence",hidden:true},{header:"\u7a0e\u52a1\u767b\u8bb0\u53f7",sortable:true,width:60,dataIndex:"taxation",hidden:true},{header:"\u5f00\u6237\u884c",sortable:true,width:60,dataIndex:"bank",hidden:true},{header:"\u94f6\u884c\u8d26\u53f7",sortable:true,width:60,dataIndex:"bankCode",hidden:true},{header:"\u4fdd\u8d28\u91d1",sortable:true,width:60,dataIndex:"qualityAssure",hidden:true},{header:"\u5382\u5546\u56fe\u7247",sortable:true,width:60,dataIndex:"pic",renderer:this.imgRender,hidden:true},{header:"\u6240\u6709\u8005",sortable:true,width:60,dataIndex:"owner",renderer:this.objectRender("name"),hidden:true},{header:"\u6536\u5f55\u65f6\u95f4",sortable:true,width:60,dataIndex:"inputTime",renderer:this.dateRender("y-m-d"),hidden:true},{header:"\u70ed\u70b9\u8bf4\u660e",sortable:true,width:60,dataIndex:"hotInfo",hidden:true}]);this.btn_types=new Disco.Ext.SmartCombox(Ext.apply({},{width:100,listeners:{select:this.refresh,scope:this}},ConfigConst.BASE.getCompanyDictionaryCombo("types","\u5ba2\u6237\u7c7b\u578b","ClientTypes")));this.btn_title=new Ext.form.TextField({xtype:"textfield",width:100,listeners:{change:this.refresh,scope:this}});this.btn_sn=new Ext.form.TextField({xtype:"textfield",width:80,listeners:{change:this.refresh,scope:this}});this.tbar=["\u5ba2\u6237\u7c7b\u522b:",this.btn_types,"\u7f16\u53f7:",this.btn_sn,"\u540d\u79f0:",this.btn_title,{text:"\u67e5\u8be2",handler:this.refresh,scope:this,cls:"x-btn-text-icon",icon:"images/icon-png/search.png"},{text:"\u91cd\u7f6e",handler:this.reset,scope:this,cls:"x-btn-text-icon",icon:"images/icons/arrow_undo.png"},Ext.apply({},{text:"\u65b0\u5efa\u5ba2\u6237",handler:this.createClient,scope:this},ConfigConst.buttons.addChild)];this.menus=this.menus||[];this.menus[this.menus.length]=Ext.apply({},{text:"\u65b0\u5efa\u5ba2\u6237",handler:this.createClient,scope:this},ConfigConst.buttons.addChild);ClientGridList.superclass.initComponent.call(this);this.store.on("load",function(d,c){if(c&&c.length>0){this.grid.getSelectionModel().selectFirstRow();this.grid.getView().focusRow(0)}},this)}});ClientSelectWin=Ext.extend(Ext.Window,{title:"\u9009\u62e9\u5ba2\u6237",width:800,height:600,layout:"border",buttonAlign:"center",closeAction:"hide",modal:true,selectSingle:false,callback:Ext.emptyFn,maximizable:true,listeners:{maximize:function(a){a.doLayout()},restore:function(a){a.doLayout()}},choice:function(d){var b=this.list.grid.getSelectionModel().getSelections();if(!b||b.length<1){Ext.Msg.alert("$!{lang.get('Prompt')}","$!{lang.get('Select first')}");return false}var a=[];for(var c=0;c<b.length;c++){a[c]=b[c].data}this.hide();this.fireEvent("select",a,this)},initComponent:function(){this.keys=[{key:Ext.EventObject.ENTER,fn:this.choice,stopEvent:true,scope:this},{key:Ext.EventObject.ESC,fn:function(){this.hide()},scope:this}];this.buttons=[{text:"\u786e\u5b9a",handler:this.choice,scope:this},{text:"\u6e05\u7a7a"},{text:"\u53d6\u6d88",handler:function(){this.hide()},scope:this}];ClientSelectWin.superclass.initComponent.call(this);this.list=new ClientGridList({baseUrl:this.baseUrl,selectSingle:this.selectSingle,region:"center",menus:[{text:"\u9009\u5b9a\u5ba2\u6237",handler:this.choice,scope:this,cls:"x-btn-text-icon",icon:"images/icons/accept.png"}]});if(!Global.productDirLoader){Global.productDirLoader=new Ext.tree.TreeLoader({url:"productDir.java?cmd=getProductDirTree&pageSize=-1",listeners:{beforeload:function(b,a){b.baseParams.id=(a.id!="root"?a.id:"")},scope:this}})}if(!Global.systemRegionLoader){Global.systemRegionLoader=new Ext.tree.TreeLoader({url:"systemRegion.java?cmd=getSystemRegion&pageSize=-1&treeData=true",listeners:{beforeload:function(b,a){b.baseParams.id=(a.id.indexOf("root")<0?a.id:"")}}})}this.tree=new Ext.tree.TreePanel({title:"\u5ba2\u6237\u6240\u5728\u5730\u533a",region:"west",autoScroll:true,split:true,collapsible:true,width:200,tools:[{id:"refresh",handler:function(){this.tree.root.reload()},scope:this}],tools:[{id:"refresh",handler:function(){this.tree.root.reload()},scope:this}],root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u6240\u6709\u5730\u533a",icon:"images/system/root.gif",expanded:true,loader:Global.systemRegionLoader})});this.list.tree=this.tree;this.on("show",function(){this.list.grid.store.reload()},this);this.tree.on("click",function(b,a){var c=(b.id!="root"?b.id:"");this.list.region=c;this.list.store.baseParams.region=c;if(c){this.list.currentRegion={id:c,title:b.text}}else{this.list.currentDir=null}this.list.store.removeAll();this.list.store.load()},this);this.list.grid.on("rowdblclick",this.choice,this);this.add(this.list);this.add(this.tree);this.addEvents("select")}});ClientComboBox=Ext.extend(Disco.Ext.SmartCombox,{baseUrl:"client.java",choiceValue:Ext.emptyFn,selectSingle:true,disableChoice:true,mode:"local",loadBySn:"autocompleteList",doQuery:Ext.emptyFn,setValue:function(a){if(a!=""&&Ext.type(a)!="object"){if(this.store.getById(a)){a=this.store.getById(a).data}}ClientComboBox.superclass.setValue.call(this,a);if(a&&typeof a=="object"){Global.setClient(a)}else{Global.setClient({id:a,fullName:""})}},clearLastValue:function(){this.lastValue=null},choiceProvider:function(){if(!this.lookupWin){this.lookupWin=new ClientSelectWin({baseUrl:this.baseUrl,selectSingle:this.selectSingle});this.lookupWin.on("select",function(b){if(b&&b.length){var c={id:b[0].id};var a=this.displayField?this.displayField:"fullName";c[a]=b[0][a];this.setValue(c);if(this.choiceValue){this.choiceValue(b[0])}}},this)}this.lookupWin.show()},selectProvider:function(d,a,b){if(this.choiceValue&&this.choiceValue!=Ext.emptyFn){if(a.data){this.choiceValue(a.data)}else{this.choiceValue(a)}}},autoSelectBySn:function(d,b){if(d.el.dom.value&&d.getValue()){}else{if(b.getKey()==Ext.EventObject.ENTER&&!this.isExpanded()){var a=d.el.dom.value;Ext.Ajax.request({url:this.baseUrl+"?cmd="+this.loadBySn,params:{searchKey:a},success:function(c,e){this.lastValue={text:this.lastSelectionText,id:this.hiddenField.value};this.store.baseParams=Ext.apply({},e.params);var g=Ext.decode(c.responseText);this.store.removeAll();if(g&&g.result){this.store.loadData({result:g.result,rowCount:g.rowCount})}if(this.store.getCount()==1){var f=this.store.getAt(0);this.select(0,true);this.expand()}else{if(this.store.getCount()>1){this.select(0,true);this.expand()}else{if(this.store.getCount()==0){Ext.Msg.alert("\u63d0\u793a",(this.fieldLabel||"\u5ba2\u6237")+"\u7f16\u53f7\u4e0d\u6b63\u786e,\u8bf7\u91cd\u65b0\u8f93\u5165!",function(){this.focus(true,100)},this)}}}},scope:this})}else{if(b.getKey()==Ext.EventObject.PAGEDOWN){this.choiceProvider()}}}},onRender:function(c,a){ClientComboBox.superclass.onRender.call(this,c,a);var b=this.el.findParent(".x-form-element",5,true)||this.el.findParent(".x-form-field-wrap",5,true);this.helpIcon=b.createChild({cls:"object-select-icon",style:"width:16px;height:18px; position:absolute; left:0; top:0; display:block; background:transparent no-repeat scroll 0 2px;"});this.helpIcon.on("click",this.choiceProvider,this);this.alignHelpIcon=function(){var d=this.wrap?this.wrap:this.el;this.el.setWidth(this.el.getWidth()-20);this.helpIcon.alignTo(this.el,"tl-tr",[20,0])};this.on("resize",this.alignHelpIcon,this);this.on("select",this.selectProvider,this);this.on("specialkey",this.autoSelectBySn,this);this.on("keypress",function(f,d){if(!d.isSpecialKey()){f.value=null}},this)}});Ext.reg("clientcombo",ClientComboBox);EmployeeGridList=Ext.extend(BaseGridList,{border:false,selectSingle:false,pageSize:10,url:"employee.java?cmd=list&pageSize=10",storeMapping:["id","name","trueName","email","dept","contractNo","duty","password","tel","registerTime","status","sex","workerOnly"],quick_search:function(){this.store.reload({params:{start:0,searchKey:this.btn_searchKey.getValue(),deptId:this.btn_dept.getValue(),tel:this.btn_tel.getValue()}})},initComponent:function(){this.btn_dept=new Disco.Ext.TreeComboField({xtype:"treecombo",fieldLabel:"\u90e8\u95e8",name:"parentId",hiddenName:"parentId",displayField:"title",valueField:"id",width:100,listWidth:150,tree:new Ext.tree.TreePanel({autoScroll:true,root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u6240\u6709\u90e8\u95e8",icon:"images/system/root.gif",expanded:true,loader:Global.departmentLoader})})});this.btn_searchKey=new Ext.form.TextField({width:100});this.btn_tel=new Ext.form.TextField({width:100});this.tbar=["\u90e8\u95e8",this.btn_dept,"\u59d3\u540d",this.btn_searchKey,"\u7535\u8bdd",this.btn_tel,"-",{text:"\u67e5\u8be2",handler:this.quick_search,scope:this,cls:"x-btn-text-icon",icon:"images/icon-png/search.png"},{text:"\u91cd\u7f6e",iconCls:"clean",handler:function(){Ext.each(this.getTopToolbar().items.items,function(c){if(c&&c.reset){c.reset()}})},scope:this}];var b={border:false},a=null;if(this.selectSingle){b.sm=new Ext.grid.RowSelectionModel({singleSelect:true})}else{a=new Ext.grid.CheckboxSelectionModel();b.sm=a}this.cm=new Ext.grid.ColumnModel([a?a:new Ext.grid.RowNumberer({header:"\u5e8f\u53f7",width:35}),{header:"\u7528\u6237\u540d",sortable:true,width:100,dataIndex:"name"},{header:"\u59d3\u540d",sortable:true,width:100,dataIndex:"trueName"},{header:"\u90e8\u95e8",sortable:true,width:100,dataIndex:"dept",renderer:this.objectRender("title")},{header:"\u7535\u5b50\u90ae\u4ef6",sortable:true,width:100,dataIndex:"email",hidden:true},{header:"\u7535\u8bdd",sortable:true,width:100,dataIndex:"tel"},{header:"\u7d27\u6025\u7535\u8bdd",sortable:true,width:100,dataIndex:"contractNo",hidden:true},{header:"\u804c\u52a1",sortable:true,width:100,dataIndex:"duty",renderer:this.objectRender("title"),hidden:true}]);this.gridConfig=b;EmployeeGridList.superclass.initComponent.call(this);this.store.load({callback:function(){this.grid.getSelectionModel().selectFirstRow()},scope:this})}});EmployeeSelectWin=Ext.extend(Ext.Window,{title:"\u9009\u62e9\u5458\u5de5",width:540,height:400,layout:"fit",buttonAlign:"center",closeAction:"hide",modal:true,selectSingle:false,callback:Ext.emptyFn,choice:function(){var b=this.list.grid.getSelectionModel().getSelections();if(!b||b.length<1){Ext.Msg.alert("$!{lang.get('Prompt')}","$!{lang.get('Select first')}");return false}var a=[];for(var c=0;c<b.length;c++){a[c]=b[c].data}this.hide();this.fireEvent("select",a,this)},initComponent:function(){this.buttons=[{text:"OK",handler:this.choice,scope:this},{text:"Cancel",handler:function(){this.hide()},scope:this}];EmployeeSelectWin.superclass.initComponent.call(this);this.list=new EmployeeGridList({selectSingle:this.selectSingle});this.list.grid.on("rowdblclick",this.choice,this);this.add(this.list);this.addEvents("select")}});EmployeeComboBox=Ext.extend(Disco.Ext.SmartCombox,{choiceValue:Ext.emptyFn(),hideTrigger1:true,choiceProvider:function(){if(!this.lookupWin){this.lookupWin=new EmployeeSelectWin({closeAction:"hide",selectSingle:true});this.lookupWin.on("select",function(a){this.setValue({id:a[0].id,name:a[0][this.displayField?this.displayField:"trueName"]});if(this.choiceValue){this.choiceValue(a[0])}},this)}this.lookupWin.show()},selectProvider:function(d,a,b){if(this.choiceValue){this.choiceValue(a.data)}},onDestroy:function(){if(this.lookupWin){this.lookupWin.close();delete this.lookupWin}EmployeeComboBox.superclass.onDestroy.call(this)},onRender:function(c,a){EmployeeComboBox.superclass.onRender.call(this,c,a);var b=this.el.findParent(".x-form-element",5,true)||this.el.findParent(".x-form-field-wrap",5,true);this.helpIcon=b.createChild({cls:"object-select-icon",style:"width:16px;height:18px; position:absolute; left:0; top:0; display:block; background:transparent no-repeat scroll 0 2px;"});this.helpIcon.on("click",this.choiceProvider,this);this.alignHelpIcon=function(){var d=this.wrap?this.wrap:this.el;this.el.setWidth(this.el.getWidth()-20);this.helpIcon.alignTo(this.el,"tl-tr",[20,0])};this.on("resize",this.alignHelpIcon,this);this.on("select",this.selectProvider,this)}});Ext.reg("employeecombo",EmployeeComboBox);ShoppingGuideComboBox=Ext.extend(Disco.Ext.SmartCombox,{disableChoice:true,choiceValue:Ext.emptyFn(),doQuery:Ext.emptyFn,enableKeyEvents:true,choiceProvider:function(){if(!this.lookupWin){this.lookupWin=new EmployeeSelectWin({closeAction:"hide",selectSingle:true});this.lookupWin.on("select",function(a){this.setValue({id:a[0].id,trueName:a[0][this.displayField?this.displayField:"trueName"]});if(this.choiceValue){this.choiceValue(a[0])}},this)}this.lookupWin.show()},selectProvider:function(d,a,b){if(this.choiceValue){this.choiceValue(a.data)}},onDestroy:function(){if(this.lookupWin){this.lookupWin.close();delete this.lookupWin}ShoppingGuideComboBox.superclass.onDestroy.call(this)},autoSelectBySn:function(d,b){if(b.getKey()==Ext.EventObject.ENTER&&!this.isExpanded()){var a=d.el.dom.value;Ext.Ajax.request({url:"employee.java?cmd=getShoppingGuide",params:{searchKey:a},success:function(c,e){this.store.baseParams=Ext.apply({},e.params);var g=Ext.decode(c.responseText);this.store.removeAll();if(g&&g.result){this.store.loadData({result:g.result,rowCount:g.rowCount})}if(this.store.getCount()==1){var f=this.store.getAt(0);this.select(0,true);this.expand()}else{if(this.store.getCount()>1){this.select(0,true);this.expand()}else{if(this.store.getCount()==0){Ext.Msg.alert("\u63d0\u793a","\u7f16\u53f7\u4e0d\u6b63\u786e,\u8bf7\u91cd\u65b0\u8f93\u5165!",function(){this.focus(true,100)},this)}}}},scope:this})}b.stopEvent()},onRender:function(b,a){ShoppingGuideComboBox.superclass.onRender.call(this,b,a);this.on("select",this.selectProvider,this);this.on("specialkey",this.autoSelectBySn,this);this.on("keypress",function(f,d){if(d.getKey()!=13&&f.value){f.value=null}})}});Ext.reg("guideCombo",ShoppingGuideComboBox);LoginWindow=Ext.extend(Ext.Window,{title:"\u767b\u9646\u7cfb\u7edf",width:265,autoHeight:true,resizable:false,closable:false,modal:true,border:false,defaults:{border:false},buttonAlign:"center",createFormPanel:function(){return new Ext.form.FormPanel({bodyStyle:"padding-top:6px",defaultType:"textfield",labelAlign:"right",labelWidth:55,labelPad:0,frame:true,defaults:{allowBlank:false,anchor:"-25",selectOnFocus:true},items:[{cls:"user",name:"j_username",fieldLabel:"\u5e10\u53f7",blankText:"\u5e10\u53f7\u4e0d\u80fd\u4e3a\u7a7a"},{cls:"key",name:"j_password",fieldLabel:"\u5bc6\u7801",blankText:"\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a",inputType:"password"},{fieldLabel:"\u9a8c\u8bc1\u7801",xtype:"compositefield",items:[{xtype:"box",flex:1,autoEl:{tag:"img",src:"randomCode.java",alt:"\u9a8c\u8bc1\u7801"}},{xtype:"textfield",flex:1,allowBlank:false,blankText:"\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801",width:90,name:"randomCode",hideLabel:true}]}]})},login:function(){this.fp.form.submit({waitTitle:"\u8bf7\u7a0d\u5019",waitMsg:"\u6b63\u5728\u767b\u5f55......",url:"login.java?cmd=checkLogin",success:function(a,c){var b=a.findField("j_username").getValue();if(b!=Global.User.name){if(Ext.isIE){window.location.reload()}else{window.location="manage.java"}}else{this.close();Disco.Ext.isLogin=false}},failure:function(a,b){if(b.failureType==Ext.form.Action.SERVER_INVALID){Disco.Ext.Msg.error(b.result.errors.msg)}a.findField("j_password").setRawValue("");a.findField("j_username").focus(true)},scope:this})},initComponent:function(){this.keys={key:Ext.EventObject.ENTER,fn:this.login,scope:this};LoginWindow.superclass.initComponent.call(this);this.fp=this.createFormPanel();this.add(this.fp);this.addButton("\u767b\u9646",this.login,this);this.addButton("\u9000\u51fa",function(){Ext.Msg.confirm("\u63d0\u793a","\u786e\u8ba4\u8981\u9000\u51fa\u7cfb\u7edf\u5417\uff1f",function(a){if(a=="yes"){window.location.href="login.java?cmd=logout"}})},this)}});ChangePasswordWindow=Ext.extend(Ext.Window,{title:"\u4fee\u6539\u5bc6\u7801",modal:true,iconCls:"icon-password",width:265,height:170,border:false,hideBorders:true,buttonAlign:"center",bodyStyle:"padding:5px;",createFormPanel:function(){return new Ext.form.FormPanel({bodyStyle:"padding-top:6px",defaultType:"textfield",labelAlign:"right",labelWidth:70,labelPad:0,frame:true,defaults:{allowBlank:false,width:158,anchor:"-25",selectOnFocus:true},items:[{cls:"key",name:"oldPassword",fieldLabel:"\u65e7\u5bc6\u7801",inputType:"password"},{cls:"key",name:"password",fieldLabel:"\u65b0\u5bc6\u7801",inputType:"password"},{cls:"key",name:"password1",fieldLabel:"\u786e\u8ba4\u5bc6\u7801",inputType:"password"}]})},save:function(){var b=this.fp.form.findField("password").getValue();var a=this.fp.form.findField("password1").getValue();if(b!=a){this.fp.form.findField("password").markInvalid("\u4e24\u6b21\u8f93\u5165\u7684\u65b0\u5bc6\u7801\u4e0d\u540c!");this.fp.form.findField("password").focus(true);return}this.fp.form.submit({waitTitle:"\u8bf7\u7a0d\u5019",waitMsg:"\u6b63\u5728\u4fdd\u5b58...",url:"login.java?cmd=changePasssword&ext=true",success:function(c,d){Ext.Msg.alert("\u63d0\u793a","\u5bc6\u7801\u4fee\u6539\u6210\u529f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u7cfb\u7edf!",function(){this.close();login()},this)},failure:function(c,d){},scope:this})},initComponent:function(){this.keys={key:Ext.EventObject.ENTER,fn:this.save,scope:this};ChangePasswordWindow.superclass.initComponent.call(this);this.fp=this.createFormPanel();this.add(this.fp);this.addButton("\u4fdd\u5b58",this.save,this);this.addButton("\u53d6\u6d88",function(){this.close()},this)}});SystemConfigWindow=Ext.extend(Ext.Window,{title:"\u7cfb\u7edf\u8bbe\u7f6e",modal:true,width:285,autoHeight:true,iconCls:"icon-password",resizable:false,desktopTypes:[["\u9ed8\u8ba4\u4e3b\u9875(Portal)","menu"],["\u89c6\u7a97\u684c\u9762\u6a21\u5f0f","menu-desktop"],["\u8fdb\u9500\u5b58\u4e3b\u754c\u9762","menu-stock"],["\u5ba2\u6237\u5173\u7cfb\u4e3b\u754c\u9762","menu-crm"],["\u8d22\u52a1\u7ba1\u7406\u4e3b\u754c\u9762","menu-crm"],["\u4eba\u529b\u8d44\u6e90\u4e3b\u754c\u9762","menu-hr"],["\u670d\u88c5\u4e1a\u4e3b\u754c\u9762","menu-wear"]],styleDatas:[["\u9ed8\u8ba4\u98ce\u683c","ext-all"],["\u94f6\u767d\u98ce\u683c","xtheme-gray"],["\u7eff\u8272\u98ce\u683c","xtheme-green"],["\u7c89\u7ea2\u98ce\u683c","xtheme-pink"],["\u84dd\u8272\u98ce\u683c","xtheme-blue"]],appTypes:[["\u7981\u7528IFrame(OPOA\u6a21\u5f0f)",false],["\u542f\u7528IFrame(IFrame\u6a21\u5f0f)",true]],tabTypes:[["\u591a\u7a97\u4f53",false],["\u5355\u7a97\u4f53",true]],border:false,hideBorders:true,buttonAlign:"center",bodyStyle:"padding:5px",createFormPanel:function(){return new Ext.form.FormPanel({bodyStyle:"padding-top:6px",defaultType:"textfield",labelAlign:"right",labelWidth:70,labelPad:0,frame:true,defaults:{width:158,selectOnFocus:true},items:[Disco.Ext.Util.buildCombox("homePage","\u9996\u9875\u8bbe\u7f6e",this.desktopTypes,Disco_RIA.getCfg("homePage")),{xtype:"iconcombo",valueField:"id",name:"lang",hiddenName:"lang",iconClsField:"icon",displayField:"text",fieldLabel:"\u8bed\u8a00",mode:"local",editable:false,value:Disco_RIA.getCfg("lang"),triggerAction:"all",store:new Ext.data.SimpleStore({fields:["id","text","icon"],data:[["zh_CN","\u4e2d\u56fd","x-flag-zh-CN"],["en","English","x-flag-en"]]})},Disco.Ext.Util.buildCombox("tabType","\u7a97\u4f53\u652f\u6301",this.tabTypes,Disco_RIA.getCfg("singleTabMode")),Disco.Ext.Util.buildCombox("appType","IFrame\u652f\u6301",this.appTypes,Disco_RIA.getCfg("iframe")),Disco.Ext.Util.buildCombox("style","\u76ae\u80a4",this.styleDatas,(Disco_RIA.getCfg("style")||"default")),Ext.apply({},{fieldLabel:"\u5f00\u53d6\u52a8\u753b",name:"enableAnimate",hiddenName:"enableAnimate",allowBlank:false,value:main.enableAnimate},ConfigConst.BASE.yesNo),{name:"maxTab",fieldLabel:"\u6700\u5927Tab\u6570",value:Disco_RIA.getCfg("maxTabs")}]})},save:function(){var a=this.fp.form.findField("appType").getValue();var g=this.fp.form.findField("tabType").getValue();var d=this.fp.form.findField("maxTab").getValue();var f=this.fp.form.findField("lang").getValue();var e=this.fp.form.findField("homePage").getValue();var c=this.fp.form.findField("enableAnimate").getValue();var b=this.fp.form.findField("style").getValue();if(typeof main!=="undefined"&&main){Ext.apply(Disco_RIA.getCfg(),{iframe:a,homePage:e,singleTabMode:g,maxTabs:d,enableAnimate:c,style:b,lang:f});main.savePersonality(function(){if(this.fp.findField("tabType").isDirty()){Ext.Msg.confirm("\u63d0\u793a","IFrame\u652f\u6301\u6216\u7cfb\u7edf\u4e3b\u9875\u5df2\u7ecf\u4fee\u6539,\u53ea\u6709\u91cd\u65b0\u52a0\u8f7d\u9875\u9762\u65b0\u7684\u8bbe\u7f6e\u624d\u4f1a\u751f\u6548,\u662f\u5426\u8981\u91cd\u65b0\u52a0\u8f7d\u7cfb\u7edf?",function(h){if(h=="yes"){window.location.reload()}})}if(this.fp.findField("style").isDirty()){if(main.changeSkin){main.changeSkin(b)}}this.close()}.createDelegate(this))}},initComponent:function(){this.keys={key:Ext.EventObject.ENTER,fn:this.save,scope:this};SystemConfigWindow.superclass.initComponent.call(this);this.fp=this.createFormPanel();this.add(this.fp);this.addButton("\u4fdd\u5b58",this.save,this);this.addButton("\u53d6\u6d88",function(){this.close()},this)}});function changePassword(){var a=new ChangePasswordWindow();a.show()}function systemConfigWindow(){var a=new SystemConfigWindow();a.show()}function login(){if(window.OnlineMessageManager){OnlineMessageManager.stop()}if(!loginWin){loginWin=new LoginWindow()}loginWin.show()}function logout(){Ext.Msg.confirm("\u53cb\u60c5\u63d0\u793a","\u662f\u5426\u771f\u7684\u8981\u6ce8\u9500\u5f53\u524d\u7528\u6237?",function(a){if(a=="yes"){window.location.href="login.java?cmd=logout"}})}BaseProductBillPanel=Ext.extend(Disco.Ext.CrudListPanel,{printData:true,status:[['<span style="color:green;">\u521d\u59cb\u5f55\u5165<span>',0],["\u5df2\u5ba1\u6838",1],["\u4f5c\u5e9f",-1]],editEmptyObj:{id:null,product:null,productTitle:null,productSn:null,brand:null,spec:null,model:null,unit:null,price:null,num:null,remark:null,totalAmount:null,colorSn:null},editStoreMapping:["id","product",{name:"productSn",mapping:"product.sn"},{name:"productTitle",mapping:"product.title"},{name:"brand",mapping:"product.brand"},{name:"spec",mapping:"product.spec"},{name:"model",mapping:"product.model"},{name:"unit",mapping:"product.unit"},{name:"colorSn",mapping:"product.colorSn"},"price","num","remark","marketPrice","packageFee","taxRate","taxPrice","totalAmount"],gridForceFit:false,columnLock:false,maximizable:true,pageSize:20,autoCountData:function(a){var c=a.get("price");var d=a.get("num");var b=c&&d?c*d:0;a.set("totalAmount",parseFloat(b))},addRowDataHandler:function(a){var b=Ext.apply({},a,this.editEmptyObj);if(a){b.price=a.salePrice;b.product=a;b.product.toString=Disco.Ext.Util.objectToString;b.productTitle=a.title;b.productSn=a.sn;b.spec=a.spec;b.colorSn=a.colorSn;b.marketPrice=a.marketPrice;b.brand=a.brand;b.model=a.model;b.unit=a.unit}delete b.id;return b},selectRowDataHandler:function(b,a){b.toString=function(){return this.id?this.id:this};a.set("product",b);a.set("productTitle",b.title);a.set("productSn",b.sn);a.set("spec",b.spec);a.set("brand",b.brand);a.set("colorSn",b.colorSn);a.set("model",b.model);a.set("unit",b.unit);a.set("price",b.salePrice);a.set("marketPrice",b.marketPrice)},formFocus:function(){this.fp.form.findField("client").focus("",100)},getEditColumnModel:function(){this.productEditor=new ProductComboBox(Ext.apply({},{width:300,returnObject:true,name:"productInput",hiddenName:"productInput",displayField:"sn",valueField:"id",choiceValue:this.selectRowData.createDelegate(this)},ConfigConst.CRM.product));var a=function(b){b=parseFloat(b);if(Ext.isNumber(b)){return b.toFixed(2)}return 0};return new Ext.grid.ColumnModel([new Ext.grid.RowNumberer({header:"\u5e8f\u53f7",dataIndex:"sequence",width:35}),{header:"Id",dataIndex:"id",width:1,hidden:true,hideable:false},{header:"\u4ea7\u54c1",dataIndex:"product",width:0,hidden:true,hideable:false},{header:"\u4ea7\u54c1\u7f16\u53f7",dataIndex:"productSn",width:150,hideable:false,editor:this.productEditor,summaryType:"count",summaryRenderer:function(b){return"\u5408\u8ba1("+b+")"}},{header:"\u4ea7\u54c1\u540d\u79f0",dataIndex:"productTitle",width:80,renderer:this.readOnlyRender()},{header:"\u54c1\u724c",dataIndex:"brand",width:80,renderer:this.objectRender("name",Disco.Ext.Util.readOnlyGridCellColor)},{header:"\u6750\u8d28/\u578b\u53f7",dataIndex:"model",width:80,hidden:true,renderer:this.readOnlyRender()},{header:"\u5c3a\u5bf8/\u89c4\u683c",dataIndex:"spec",width:80,hidden:true,renderer:this.readOnlyRender()},{header:"\u8272\u53f7",dataIndex:"colorSn",width:80,hidden:true,renderer:this.readOnlyRender()},{header:"\u5355\u4f4d",dataIndex:"unit",width:50,renderer:this.objectRender("title",Disco.Ext.Util.readOnlyGridCellColor)},{header:"\u5355\u4ef7",dataIndex:"price",width:60,renderer:this.readOnlyRender(),summaryType:"average",summaryRenderer:a},{header:"\u6570\u91cf",dataIndex:"num",width:50,editor:new Ext.form.NumberField(),summaryType:"sum",summaryRenderer:function(b){return b}},{header:"\u7a0e\u7387",dataIndex:"taxRate",width:80,editor:new Ext.form.NumberField(),hidden:true,summaryType:"average",summaryRenderer:a},{header:"\u5305\u88c5\u8d39\u7528",dataIndex:"packageFee",width:80,editor:new Ext.form.NumberField(),hidden:true,summaryType:"sum",summaryRenderer:a},{header:"\u4ef7\u683c\u5408\u8ba1",dataIndex:"totalAmount",width:80,renderer:this.readOnlyRender(a),summaryType:"sum",summaryRenderer:a},{header:"\u5907\u6ce8",dataIndex:"remark",editor:new Ext.form.TextField()}])},createEditGrid:function(){var b=new Ext.data.JsonStore({root:"result",totalProperty:"rowCount",fields:this.editStoreMapping});var a=this.getEditColumnModel();this.editGridMenu=new Ext.menu.Menu({items:[Ext.apply({},{id:"menu_add",text:"\u6dfb\u52a0\u5546\u54c1[Ins]",handler:this.autoAddLastRow,scope:this},ConfigConst.buttons.addChild),Ext.apply({},{id:"menu_remove",text:"\u5220\u9664\u5546\u54c1[Del]",handler:this.removeRow,scope:this},ConfigConst.buttons.removeChild),{id:"barCodeImport",text:"\u6761\u7801\u5f55\u5165\u5546\u54c1",scope:this}]});this.editGrid=new Ext.grid.EditorGridPanel({cm:a,autoScroll:true,store:b,clicksToEdit:1,border:false,valPrefix:"item_",autoExpandColumn:a.getColumnCount()-1,plugins:[new Ext.ux.grid.GridSummary()],sm:new Ext.grid.CellSelectionModel({enterNavigation:true}),keys:[{key:Ext.EventObject.INSERT,fn:function(c,f){this.autoAddLastRow();var g=this.editGrid.store.getCount()-1;var d=this.editGrid.getColumnModel(g).findColumnIndex("productSn");this.editGrid.startEditing(g,d);f.stopEvent()},scope:this},{key:Ext.EventObject.DELETE,fn:function(c,d){this.removeRow(),d.stopEvent()},scope:this},{key:Ext.EventObject.S,altKey:true,fn:function(c,d){this.save();d.stopEvent()},scope:this}],listeners:Ext.apply({},{scope:this},this.baseEditGridListeners)});return this.editGrid},createFormToolBar:function(){var a=[Ext.apply({},{text:"\u65b0\u5efa[n]",handler:this.create,scope:this},ConfigConst.buttons.add),Ext.apply({},{text:"\u590d\u5236[c]",handler:this.copy,scope:this},ConfigConst.buttons.copy),Ext.apply({},{text:"\u5ba1\u6838[u]",handler:this.auditing,scope:this},ConfigConst.buttons.audit),"-",Ext.apply({},{text:"\u6dfb\u52a0\u5546\u54c1[Ins]",handler:this.autoAddLastRow,scope:this},ConfigConst.buttons.addChild),Ext.apply({},{text:"\u5220\u9664\u5546\u54c1[Del]",handler:this.removeRow,scope:this},ConfigConst.buttons.removeChild),Ext.apply({},{handler:this.showBarCodeWindow,scope:this},ConfigConst.buttons.barCode),"-"];if(this.showRedBlueButton){a=a.concat([Ext.apply({},{scope:this},ConfigConst.buttons.red),Ext.apply({},{scope:this},ConfigConst.buttons.blue),"-"])}a=a.concat([Ext.apply({},{text:"\u6253\u5370[p]",handler:this.printList,scope:this},ConfigConst.buttons.print),Ext.apply({},{hidden:true,text:"Excel[e]",disabled:true},ConfigConst.buttons.excel),{id:"btn_saveNew",xtype:"checkbox",checked:false,boxLabel:"\u4fdd\u5b58\u540e\u65b0\u5efa"}]);return a},addProduct:function(){if(!this.selectWin){this.selectWin=new ProductSelectWin();this.selectWin.on("select",this.addRow,this)}this.selectWin.show()},addRow:function(a){Disco.Ext.Util.appendGridRows(this.editGrid,this.editStoreMapping,a,this.addRowDataHandler.createDelegate(this),true)},removeRow:function(){Disco.Ext.Util.removeEditorGridRow(this.editGrid)},selectRowData:function(c){var a=this.editGrid.getSelectionModel().getSelectedCell();if(a){this.editGrid.stopEditing();var d=Ext.apply({},c);var b=this.editGrid.store.getAt(a[0]);this.selectRowDataHandler(d,b);this.autoCountData(b);this.autoAddLastRow()}},autoAddLastRow:function(){var c=this.editGrid,b=c.store;if(b.getCount()<1||Ext.getObjVal(b.getAt(b.getCount()-1).get("product"),"id")){var d=c.getSelectionModel();var a=d.getSelectedCell();b.add(new b.recordType({color:""}));if(a){d.select(a[0],a[1])}}},showBarCodeWindow:function(){BarCodeWindow=Ext.extend(Ext.Window,{title:"\u6761\u7801\u4fe1\u606f\u91c7\u96c6",width:300,height:210,layout:"fit",crudService:null,border:false,resizable:false,closeAction:"hide",buttonAlign:"center",reset:function(){this.data=null;this.findSomeThing("barCode").focus("",100)},addProductTo:function(f){if(this.data){var c=this.crudService;var d=this.data;var e={};if(d.color){e.color=d.color.title}if(d.size){e.size=d.size.title}if(d){e.stockNum=Ext.num(d.product.storeNum,0)}this.form.getForm().setValues(e);this.data.product.color=d.color;f=f||this.findSomeThing("quickScan").getValue();if(f){if(this.form.findField("fixedNum").getValue()){this.data.num=this.form.findField("num").getValue()}else{if(!this.form.findField("quickScan").getValue()){this.data.num=this.form.findField("num").getValue()}else{this.form.findField("num").setValue(1);this.data.num=1}}c.addProductByBarCode(this.data);this.form.findField("barCode").focus(true,100)}else{if(!this.form.findField("fixedNum").getValue()){this.form.findField("num").focus(true,100)}else{this.buttons[0].focus()}}}else{this.loadProductByBarCode(f)}},getloadProductByBarCodeParams:function(){var d={};var c=this.crudService.fp.getForm().findField("supplier");if(c){d.client=c.getValue()}return d},loadProductByBarCode:function(e){var c=this.findSomeThing("barCode").getValue();var d=this.getloadProductByBarCodeParams();Ext.Ajax.request({waitMsg:"\u6b63\u5728\u52a0\u8f7d\u4fe1\u606f\uff0c\u8bf7\u7a0d\u540e\u3002\u3002\u3002\u3002",url:"product.java",params:Ext.apply({cmd:"loadByBarCode",code:c},d),success:function(g){var h=Ext.decode(g.responseText);this.data=h.data;if(h.success&&h.data){this.data.code=c;var f=this.crudService;if(f.addProductByBarCode){this.addProductTo(e)}else{Ext.MessageBox.alert("\u63d0\u793a\u4fe1\u606f","\u6b64\u529f\u80fd\u8fd8\u672a\u5b8c\u5584")}}else{var i=h.errors?(h.errors.msg||"\u6761\u7801\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u5f55\u5165"):"\u6761\u7801\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u5f55\u5165";Disco.Ext.Util.msg("\u63d0\u793a\u4fe1\u606f",i);this.findSomeThing("barCode").el.dom.select()}},scope:this})},initComponent:function(){Ext.apply(this,{onEsc:this.reset,items:{xtype:"form",enterNavigationKey:true,bodyStyle:"padding:10px;",frame:false,navigationSequences:["barCode","num"],items:[{fieldLabel:"\u56fa\u5b9a\u6570\u91cf",xtype:"checkbox",checked:true,name:"fixedNum"},{fieldLabel:"\u626b\u63cf\u540e\u7acb\u5373\u6dfb\u52a0",xtype:"checkbox",checked:true,name:"quickScan"},{fieldLabel:"\u8bf7\u8f93\u5165\u6761\u7801",xtype:"textfield",enableKeyEvents:true,name:"barCode",selectOnFocus:true,listeners:{specialkey:function(c,d){if(d.keyCode==13){if(c.getValue().trim()==""){Disco.Ext.Msg.error("\u8bf7\u5f55\u5165\u6761\u7801\uff01",null,function(){c.focus()},this);return}this.data=null;this.addProductTo(false)}},scope:this}},{fieldLabel:"\u8bf7\u8f93\u5165\u6570\u91cf",xtype:"numberfield",selectOnFocus:true,allowDecimals:false,name:"num",value:1},{layout:"column",defaults:{layout:"form"},border:false,hideBorders:true,items:[{labelWidth:80,columnWidth:0.5,items:{xtype:"labelfield",name:"color",fieldLabel:"\u5546\u54c1\u989c\u8272"}},{labelWidth:80,columnWidth:0.5,items:{xtype:"labelfield",name:"size",fieldLabel:"\u5546\u54c1\u5c3a\u7801"}}]}]},buttons:[{text:"\u786e\u5b9a(Alt+o)",handler:this.addProductTo,scope:this},{text:"\u5173\u95ed(Alt+x)",handler:function(){this.hide()},scope:this}]}),BarCodeWindow.superclass.initComponent.call(this);this.form=this.getComponent(0);this.on({scope:this,show:function(c){c.findSomeThing("barCode").setValue("");c.findSomeThing("num").reset();c.findSomeThing("barCode").focus(true,100)},hide:this.reset,render:function(c){new Ext.KeyMap(this.el,[{key:"x",alt:true,fn:function(){this.hide()},scope:this},{key:"o",alt:true,fn:this.addProductTo.createDelegate(this,[false],false),scope:this}])}})}});var a=Disco.Ext.Util.barWin,b;if(!a){a=new BarCodeWindow();Disco.Ext.Util.barWin=a}a.crudService=this;if((b=this.checkSupplierIsNull())!==true){a.supplierId=b;a.show()}this.win.on("hide",function(){Disco.Ext.Util.barWin.hide()},this,{single:true})},checkSupplierIsNull:function(){if(this.fp&&this.fp.form.findField("supplier")){var a=this.fp.form.findField("supplier").getValue();if(!a){Disco.Ext.Msg.alert("\u8bf7\u4f60\u5148\u9009\u62e9\u4f9b\u8d27\u5546!");return true}return a}},onCreate:function(){this.editGrid.store.removeAll();this.autoAddLastRow();this.fp.getTopToolbar().items.get("tb_audit").disable();var a=this.fp.form.findField("vdate");if(a){a.clearDirty()}this.generatorSn()},loadItems:function(b,a){a.getGridEl().mask("\u8bf7\u7a0d\u540e...","x-mask-loading");Ext.Ajax.request({waitTitle:"\u52a0\u8f7d\u6570\u636e",waitMsg:"\u6b63\u5728\u52a0\u8f7d\u5355\u636e\u8be6\u60c5,\u8bf7\u7a0d\u5019...",url:this.baseUrl+"?cmd=view",params:{id:b,view:true},success:function(d){var c=Ext.decode(d.responseText);if(c.items&&c.items.length){if(this.beforeLoadItem){this.beforeLoadItem(c.items,a,c)}a.store.loadData({rowCount:c.items.length,result:c.items});this.afterLoadItem(c.items,a,c)}a.getGridEl().unmask()},scope:this})},onEdit:function(b){if(b){var a=this.grid.getSelectionModel().getSelected();this.editGrid.store.removeAll();var d=a.get("items");if(d&&d.length){var c={rowCount:d.length,result:d};this.editGrid.store.loadData(c);this.afterLoadItem(d,this.editGrid)}else{this.loadItems(a.get("id"),this.editGrid)}}},afterLoadItem:function(a,c,b){},onView:function(d,c){if(d){d.setWidth(Ext.getBody().dom.offsetWidth-20);d.setHeight(Ext.getBody().dom.offsetHeight-20);d.center();d.doLayout();var b=c.items;this.viewGrid.store.removeAll();if(b&&b.length){var a={rowCount:b.length,result:b};this.viewGrid.store.loadData(a)}else{this.loadItems(c.id,this.viewGrid)}}},onSave:function(b,c){var a=this.fp.getTopToolbar().items.get("btn_saveNew");if(a&&a.getValue()){this.create.defer(100,this);return false}},save:function(){var a=Disco.Ext.Util.getEditGridData(this.editGrid,"item_","product");a.red=(this.red==true);this.fp.form.baseParams=a;BaseProductBillPanel.superclass.save.call(this)},preview:function(){var a=Disco.Ext.Util.getEditGridData(this.editGrid,"item_","product");this.fp.form.baseParams=a;BaseProductBillPanel.superclass.preview.call(this)},generatorSn:function(a){Ext.Ajax.request({url:this.baseUrl+"?cmd=generatorSn",waitMsg:a,success:function(b){var c=Ext.decode(b.responseText);this.fp.form.findField("sn").setOriginalValue(c)},scope:this})},copy:function(){this.fp.form.findField("id").setValue();this.beingCreate=true;this.generatorSn("\u52a0\u8f7d\u7f16\u53f7...");for(var b=0,a=this.editGrid.store.getCount();b<a;b++){this.editGrid.store.getAt(b).set("id","")}},auditing:function(){if(this.fp.form.findField("id")){this.executeUrl(this.baseUrl+"?cmd=auditing",{id:this.fp.form.findField("id").getValue()}).call(this)}},addQuickKeyMap:function(){new Ext.KeyMap(this.fp.el,[{key:"n",alt:true,stopEvent:true,fn:this.create,scope:this},{key:"u",alt:true,stopEvent:true,fn:this.auditing,scope:this},{key:"a",alt:true,stopEvent:true,fn:this.addProduct,scope:this},{key:"d",alt:true,stopEvent:true,fn:this.removeRow,scope:this},{key:"c",alt:true,stopEvent:true,fn:this.copy,scope:this},{key:"v",alt:true,stopEvent:true,fn:this.preview,scope:this},{key:"p",alt:true,stopEvent:true,fn:this.preview,scope:this}])},operateRender:function(a,d,c){var b=new Ext.Template("<a href='{2}' theid='{2}' op='{1}' onclick='return false'><font color='blue'>{0}</font></a>");if(a!=1){return b.applyTemplate(["\u5ba1\u6838\u786e\u8ba4","auditing",c.get("id")])}},statusRender:function(a){return function(b){if(b===null){return a[0][0]}if(b<0){return a[2][0]}else{if(b<a.length){return a[b][0]}else{return b}}}},onRowSelection:function(d,c,b,f){this.enableOperaterItem("btn_edit","btn_view","btn_print");var a=d.get("status");if(!a||a==-1){this.enableOperaterItem("btn_remove")}else{if(a>=1){this.disableOperaterItem("btn_remove")}}}});BasePurchaseBillPanel=Ext.extend(BaseProductBillPanel,{editEmptyObj:{id:null,product:null,productTitle:null,productSn:null,brand:null,spec:null,model:null,unit:null,price:null,num:null,remark:null,totalAmount:null,vdate:null,approveNum:null,blockSn:null,closed:false,purpose:null,colorSn:null},editStoreMapping:["id","product",{name:"productSn",mapping:"product.sn"},{name:"productTitle",mapping:"product.title"},"brand",{name:"spec",mapping:"product.spec"},{name:"model",mapping:"product.model"},{name:"colorSn",mapping:"product.colorSn"},"unit","price","num","remark","marketPrice","packageFee","taxRate","taxPrice","totalAmount","vdate","approveNum","blockSn","closed","purpose"],formFocus:function(){this.fp.form.findField("supplier").focus("",1000)},getEditColumnModel:function(){this.productEditor=new ProductComboBox(Ext.apply({},{returnObject:true,name:"productInput",hiddenName:"productInput",displayField:"fullName",valueField:"id",width:300,choiceValue:this.selectRowData.createDelegate(this)},ConfigConst.CRM.product));return new Ext.grid.ColumnModel([new Ext.grid.RowNumberer({header:"\u5e8f\u53f7",dataIndex:"sequence",width:35}),{header:"Id",dataIndex:"id",width:1,hidden:true,hideable:false},{header:"\u4ea7\u54c1",dataIndex:"product",width:0,hidden:true,hideable:false},{header:"\u4ea7\u54c1\u7f16\u53f7",dataIndex:"productSn",width:150,editor:this.productEditor,summaryType:"count",summaryRenderer:function(a){return"\u5408\u8ba1("+a+")"}},{header:"\u4ea7\u54c1\u540d\u79f0",dataIndex:"productTitle",width:80,renderer:this.readOnlyRender()},{header:"\u54c1\u724c",dataIndex:"brand",width:80,renderer:this.objectRender("name",Disco.Ext.Util.readOnlyGridCellColor)},{header:"\u6750\u8d28/\u578b\u53f7",dataIndex:"model",width:80,hidden:true,renderer:this.readOnlyRender()},{header:"\u5c3a\u5bf8/\u89c4\u683c",dataIndex:"spec",width:80,hidden:true,renderer:this.readOnlyRender()},{header:"\u5355\u4f4d",dataIndex:"unit",width:50,renderer:this.objectRender("title",Disco.Ext.Util.readOnlyGridCellColor)},{header:"\u5355\u4ef7",dataIndex:"price",width:60,editor:new Ext.form.NumberField()},{header:"\u542b\u7a0e\u4ef7\u683c",dataIndex:"taxPrice",hidden:true,width:60,editor:new Ext.form.NumberField()},{header:"\u7a0e\u7387",dataIndex:"taxRate",hidden:true,width:60,editor:new Ext.form.NumberField(),summaryType:"average",summaryRenderer:function(a){return a.toFixed(2)}},{header:"\u542b\u7a0e\u91d1\u989d",dataIndex:"taxPriceAmount",hidden:true,width:60,editor:new Ext.form.NumberField(),summaryType:"average",summaryRenderer:function(a){return a.toFixed(2)}},{header:"\u6570\u91cf",dataIndex:"num",width:50,editor:new Ext.form.NumberField(),summaryType:"sum",summaryRenderer:function(a){return a.toFixed(2)}},{header:"\u4ef7\u683c\u5408\u8ba1",dataIndex:"totalAmount",width:80,renderer:this.readOnlyRender(function(a){return a&&a.toFixed?a.toFixed(2):a}),summaryType:"sum",summaryRenderer:function(a,c,b){return a.toFixed(2)}},{header:"\u6279\u6b21",dataIndex:"blockSn",width:40,editor:new Ext.form.NumberField()},{header:"\u4ea4\u8d27\u65e5\u671f",dataIndex:"vdate",width:100,editor:new Ext.form.DateField({format:"Y-m-d"}),renderer:this.dateRender("Y-m-d")},{header:"\u5165\u5e93\u6570",dataIndex:"stockNum",width:80,hidden:true,summaryType:"sum",summaryRenderer:function(a){return a.toFixed(2)}},{header:"\u5f00\u7968\u6570	",dataIndex:"invoiceNum",width:80,editor:new Ext.form.NumberField(),hidden:true,summaryType:"sum",summaryRenderer:function(a){return a.toFixed(2)}},{header:"\u5907\u6ce8",dataIndex:"remark",editor:new Ext.form.TextField()}])}});BaseStockBillPanel=Ext.extend(BaseProductBillPanel,{baseUrl:"stockIncome.java",storeMapping:["id","sn","vdate","supplier","purchaseOrder","transfer","types","sender","deliver","depot","red","inputTime","inputUser","auditing","auditor","recipient","keeper","manager","totalAmount","closed","status","remark","items","fee1","fee2","fee3","fee4","other1","other2","other3","other4","other5"],editEmptyObj:{id:null,product:null,productTitle:null,productSn:null,brand:null,spec:null,model:null,unit:null,price:null,num:null,remark:null,location:null,depot:null,blockSn:null,totalAmount:null,vdate:null,salePrice:null,saleAmount:null,colorSn:"",other1:null,other2:null,other3:null},editStoreMapping:["id","product",{name:"productSn",mapping:"product.sn"},{name:"productTitle",mapping:"product.title"},{name:"brand",mapping:"product.brand"},{name:"spec",mapping:"product.spec"},{name:"model",mapping:"product.model"},{name:"unit",mapping:"product.unit"},{name:"colorSn",mapping:"product.colorSn"},"price","num","remark","location","depot","blockSn","totalAmount","vdate","totalAmount","salePrice","saleAmount","other1","other2","other3"],addRowDataHandler:function(a){var b=Ext.apply({},a,this.editEmptyObj);if(a){b.price=a.buyPrice;b.salePrice=a.salePrice;b.product=a;b.product.toString=Disco.Ext.Util.objectToString;b.productTitle=a.title;b.productSn=a.sn;b.spec=a.spec;b.colorSn=a.colorSn;b.marketPrice=a.marketPrice;b.brand=a.brand;b.model=a.model;b.unit=a.unit}delete b.id;return b},selectRowDataHandler:function(b,a){b.toString=Disco.Ext.Util.objectToString;a.set("product",b);a.set("productTitle",b.title);a.set("productSn",b.sn);a.set("spec",b.spec);a.set("brand",b.brand);a.set("colorSn",b.colorSn);a.set("model",b.model);a.set("unit",b.unit);a.set("price",b.buyPrice);a.set("salePrice",b.salePrice);a.set("marketPrice",b.marketPrice)},formFocus:function(){var a=this.fp.form.findField("supplier");if(!a){a=this.fp.form.findField("depot")}if(a){a.focus("",1000)}},generatorSn:function(a){Ext.Ajax.request({url:this.baseUrl,params:{cmd:"generatorSn",types:this.types,snType:this.snType},waitMsg:a,success:function(b){var c=Ext.decode(b.responseText);this.fp.form.findField("sn").setOriginalValue(c)},scope:this})},save:function(){var a=this.fp.form.findField("types");if(a){a.setValue(this.types)}BaseStockBillPanel.superclass.save.call(this)},preview:function(){var a=this.fp.form.findField("types");if(a){a.setValue(this.types)}BaseStockBillPanel.superclass.preview.call(this)},onEdit:function(b){BaseStockBillPanel.superclass.onEdit.call(this,b);if(b){var a=this.grid.getSelectionModel().getSelected();var c=a.get("depot");if(c&&c.id){Ext.Ajax.request({url:"depot.java?cmd=view",params:{id:c.id},callback:function(f,g,d){var e=Ext.decode(d.responseText);if(e&&e.locations&&e.locations.length){this.depotLocationEditor.store.loadData(e.locations)}},scope:this})}}},getEditColumnModel:function(){this.productEditor=new ProductComboBox(Ext.apply({},{returnObject:true,name:"productInput",hiddenName:"productInput",displayField:"fullName",valueField:"id",width:300,listWidth:180,choiceValue:this.selectRowData.createDelegate(this)},ConfigConst.CRM.product));this.depotLocationEditor=new Disco.Ext.SmartCombox({returnObject:true,name:"depotLocationInput",hiddenName:"depotLocationInput",fieldLabel:"depotLocationInput",displayField:"title",valueField:"id",store:new Ext.data.JsonStore({fields:["id","title"]}),editable:false,mode:"local",triggerAction:"all",emptyText:"\u8bf7\u9009\u62e9..."});return new Ext.grid.ColumnModel([new Ext.grid.RowNumberer({header:"\u5e8f\u53f7",dataIndex:"sequence",width:35}),{header:"Id",dataIndex:"id",width:1,hidden:true,hideable:false},{header:"\u4ea7\u54c1",dataIndex:"product",width:0,hidden:true,hideable:false},{header:"\u4ea7\u54c1\u7f16\u53f7",dataIndex:"productSn",width:150,editor:this.productEditor,summaryType:"count",summaryRenderer:function(a){return"\u5408\u8ba1("+a+")"}},{header:"\u4ea7\u54c1\u540d\u79f0",dataIndex:"productTitle",width:80,renderer:this.readOnlyRender()},{header:"\u54c1\u724c",dataIndex:"brand",width:80,renderer:this.objectRender("name",Disco.Ext.Util.readOnlyGridCellColor)},{header:"\u6750\u8d28/\u578b\u53f7",dataIndex:"model",width:80,hidden:true,renderer:this.readOnlyRender()},{header:"\u5c3a\u5bf8/\u89c4\u683c",dataIndex:"spec",width:80,hidden:true,renderer:this.readOnlyRender()},{header:"\u8272\u53f7",dataIndex:"colorSn",width:80,renderer:this.readOnlyRender()},{header:"\u5355\u4f4d",dataIndex:"unit",width:50,renderer:this.objectRender("title",Disco.Ext.Util.readOnlyGridCellColor)},{header:"\u5355\u4ef7",dataIndex:"price",width:60,editor:new Ext.form.NumberField()},{header:"\u5b9e\u6536\u6570\u91cf",dataIndex:"num",width:60,editor:new Ext.form.NumberField(),summaryType:"sum",summaryRenderer:function(a){return a.toFixed(2)}},{header:"\u91d1\u989d",dataIndex:"totalAmount",width:80,renderer:this.readOnlyRender(function(a){return a&&a.toFixed?a.toFixed(2):a}),summaryType:"sum",summaryRenderer:function(a,c,b){return a.toFixed(2)}},{header:"\u9500\u552e\u5355\u4ef7",dataIndex:"salePrice",hidden:true,width:80,editor:new Ext.form.NumberField()},{header:"\u9500\u552e\u91d1\u989d",dataIndex:"saleAmount",hidden:true,width:80,renderer:this.readOnlyRender(function(a){return a&&a.toFixed?a.toFixed(2):a}),summaryType:"sum",summaryRenderer:function(a,c,b){return a.toFixed(2)}},{header:"\u6279\u6b21",dataIndex:"blockSn",width:50,editor:new Ext.form.NumberField()},{header:"\u5e93\u4f4d",dataIndex:"location",width:80,editor:this.depotLocationEditor,renderer:function(a){return a?(a.title||a.text||a):a}},{header:"\u5165\u5e93\u65e5\u671f",dataIndex:"vdate",width:100,editor:new Ext.form.DateField({format:"Y-m-d"}),renderer:this.dateRender("Y-m-d"),hidden:true},{header:"\u5165\u5e93\u6570",dataIndex:"stockNum",width:80,hidden:true,summaryType:"sum",summaryRenderer:function(a){return a.toFixed(2)}},{header:"\u5f00\u7968\u6570	",dataIndex:"invoiceNum",width:80,editor:new Ext.form.NumberField(),hidden:true,summaryType:"sum",summaryRenderer:function(a){return a.toFixed(2)}},{header:"\u5907\u6ce8",dataIndex:"remark",width:150,editor:new Ext.form.TextField()}])},quickSearch:function(){var b=this.search_vdate1.getValue()?this.search_vdate1.getValue().format("Y-m-d"):"";var a=this.search_vdate2.getValue()?this.search_vdate2.getValue().format("Y-m-d"):"";this.store.baseParams=Ext.apply({},{vdate1:b,vdate2:a,supplier:this.search_supplier.getValue()},this.baseQueryParameter);this.refresh()},afterList:function(){this.btn_refresh.hide();this.searchField.hide();this.search_vdate1=new Ext.form.DateField({fieldLabel:"\u5f00\u59cb\u65f6\u95f4",emptyText:"\u5f00\u59cb\u65f6\u95f4",width:90,format:"Y-m-d"});this.search_vdate2=new Ext.form.DateField({fieldLabel:"\u7ed3\u675f\u65f6\u95f4",emptyText:"\u7ed3\u675f\u65f6\u95f4",width:90,format:"Y-m-d"});this.search_supplier=new ClientComboBox(ConfigConst.CRM.supplier);this.grid.on("render",function(){this.grid.getTopToolbar().insert(10,[{text:"\u6279\u91cf\u5ba1\u6838",cls:"x-btn-text-icon",icon:"images/icon-png/save.png",handler:this.executeMulitCmd("batchAuditing"),scope:this},"-","\u65f6\u95f4:\u4ece",this.search_vdate1,"\u5230",this.search_vdate2,"\u4f9b\u5e94\u5546",this.search_supplier,{text:"\u67e5\u8be2",handler:this.quickSearch,scope:this}])},this)}});BaseStockOutcomeBillPanel=Ext.extend(BaseStockBillPanel,{printData:false,storeMapping:["id","sn","vdate","client","distributor","orders","sendInform","transfer","types","sender","deliver","depot","red","inputTime","inputUser","auditing","auditor","recipient","keeper","manager","seller","sender","totalAmount","closed","status","remark","items","fee1","fee2","fee3","fee4","other1","other2","other3","other4","other5","other6"],baseUrl:"stockOutcome.java",formFocus:function(){var a=this.fp.form.findField("client");if(!a){a=this.fp.form.findField("depot")}if(a){a.focus("",1000)}},autoCountData:function(a){var c=a.get("salePrice");var d=a.get("num");var b=c&&d?c*d:0;a.set("saleAmount",parseFloat(b))},getEditColumnModel:function(){this.productEditor=new ProductComboBox(Ext.apply({},{returnObject:true,name:"productInput",hiddenName:"productInput",displayField:"fullName",valueField:"id",width:300,choiceValue:this.selectRowData.createDelegate(this)},ConfigConst.CRM.product));this.depotLocationEditor=new Disco.Ext.SmartCombox({returnObject:true,name:"depotLocationInput",hiddenName:"depotLocationInput",fieldLabel:"depotLocationInput",displayField:"title",valueField:"id",store:new Ext.data.JsonStore({fields:["id","title"]}),editable:false,mode:"local",triggerAction:"all",emptyText:"\u8bf7\u9009\u62e9..."});var b=ConfigConst.BASE.getCompanyDictionaryCombo("propertyOther1","\u5c5e\u60271","StockItemOther1","title",false,true);delete b.hiddenName;delete b.valueField;var a=new Disco.Ext.SmartCombox(Ext.apply({},{typeAhead:false,editable:true,hiddenName:null},b));return new Ext.grid.ColumnModel([new Ext.grid.RowNumberer({header:"\u5e8f\u53f7",dataIndex:"sequence",width:35}),{header:"Id",dataIndex:"id",width:1,hidden:true,hideable:false},{header:"\u623f\u95f4\u4f4d\u7f6e",dataIndex:"other1",width:100,editor:a},{header:"\u4ea7\u54c1",dataIndex:"product",width:0,hidden:true,hideable:false},{header:"\u4ea7\u54c1\u7f16\u53f7",dataIndex:"productSn",width:150,editor:this.productEditor,summaryType:"count",summaryRenderer:function(c){return"\u5408\u8ba1("+c+")"}},{header:"\u4ea7\u54c1\u540d\u79f0",dataIndex:"productTitle",width:80,renderer:this.readOnlyRender()},{header:"\u54c1\u724c",dataIndex:"brand",width:80,renderer:this.objectRender("name",Disco.Ext.Util.readOnlyGridCellColor)},{header:"\u6750\u8d28/\u578b\u53f7",dataIndex:"model",width:80,hidden:true,renderer:this.readOnlyRender()},{header:"\u5c3a\u5bf8/\u89c4\u683c",dataIndex:"spec",width:80,hidden:true,renderer:this.readOnlyRender()},{header:"\u5355\u4f4d",dataIndex:"unit",width:50,renderer:this.objectRender("title",Disco.Ext.Util.readOnlyGridCellColor)},{header:"\u8272\u53f7",dataIndex:"colorSn",width:80,renderer:this.readOnlyRender()},{header:"\u5355\u4ef7",dataIndex:"price",width:60,hidden:true,renderer:this.readOnlyRender(function(c){return c&&c.toFixed?c.toFixed(2):c})},{header:"\u5b9e\u6536\u6570\u91cf",dataIndex:"num",width:60,editor:new Ext.form.NumberField(),summaryType:"sum",summaryRenderer:function(c){return c.toFixed(2)}},{header:"\u91d1\u989d",dataIndex:"totalAmount",hidden:true,width:80,renderer:this.readOnlyRender(function(c){return c&&c.toFixed?c.toFixed(2):c}),summaryType:"sum",summaryRenderer:function(c,e,d){return c.toFixed(2)}},{header:"\u9500\u552e\u5355\u4ef7",dataIndex:"salePrice",width:80,editor:new Ext.form.NumberField()},{header:"\u9500\u552e\u91d1\u989d",dataIndex:"saleAmount",width:80,renderer:this.readOnlyRender(function(c){return c&&c.toFixed?c.toFixed(2):c}),summaryType:"sum",summaryRenderer:function(c,e,d){return c.toFixed(2)}},{header:"\u6279\u6b21",dataIndex:"blockSn",hidden:true,width:50,editor:new Ext.form.NumberField()},{header:"\u5e93\u4f4d",dataIndex:"location",hidden:true,width:80,editor:this.depotLocationEditor,renderer:function(c){return c?(c.title||c.text||c):c}},{header:"\u51fa\u5e93\u65e5\u671f",dataIndex:"vdate",width:100,editor:new Ext.form.DateField({format:"Y-m-d"}),renderer:this.dateRender("Y-m-d"),hidden:true},{header:"\u51fa\u5e93\u6570",dataIndex:"stockNum",width:80,hidden:true,summaryType:"sum",summaryRenderer:function(c){return c.toFixed(2)}},{header:"\u5f00\u7968\u6570	",dataIndex:"invoiceNum",width:80,editor:new Ext.form.NumberField(),hidden:true,summaryType:"sum",summaryRenderer:function(c){return c.toFixed(2)}},{header:"\u5907\u6ce8",dataIndex:"remark",editor:new Ext.form.TextField()}])},printRecord:function(a){return function(){var b=this.grid.getSelectionModel().getSelected();if(!b){Ext.Msg.alert("\u63d0\u793a","\u8bf7\u5148\u9009\u62e9\u8981\u64cd\u4f5c\u7684\u6570\u636e\uff01");return false}window.open(this.baseUrl+"?cmd=print&type="+a+"&id="+b.get("id"))}},quickSearch:function(){var b=this.search_vdate1.getValue()?this.search_vdate1.getValue().format("Y-m-d"):"";var a=this.search_vdate2.getValue()?this.search_vdate2.getValue().format("Y-m-d"):"";this.store.baseParams=Ext.apply({},{vdate1:b,vdate2:a,client:this.search_client.getValue(),distributor:this.search_distributor.getValue()},this.baseQueryParameter);this.refresh()},afterList:function(){this.btn_refresh.hide();this.searchField.hide();this.search_vdate1=new Ext.form.DateField({fieldLabel:"\u5f00\u59cb\u65f6\u95f4",emptyText:"\u5f00\u59cb\u65f6\u95f4",width:90,format:"Y-m-d"});this.search_vdate2=new Ext.form.DateField({fieldLabel:"\u7ed3\u675f\u65f6\u95f4",emptyText:"\u7ed3\u675f\u65f6\u95f4",width:90,format:"Y-m-d"});this.search_client=new ClientComboBox(Ext.apply({},{emptyText:"\u5ba2\u6237",width:100},ConfigConst.CRM.client));this.search_distributor=new ClientComboBox(Ext.apply({},{emptyText:"\u5206\u9500\u5546",width:100},ConfigConst.CRM.distributor));this.grid.on("render",function(){this.grid.getTopToolbar().insert(10,["-",{text:"\u6279\u91cf\u5ba1\u6838",cls:"x-btn-text-icon",icon:"images/icon-png/save.png",handler:this.executeMulitCmd("batchAuditing"),scope:this},"-","\u65f6\u95f4:\u4ece",this.search_vdate1,"\u5230",this.search_vdate2,this.search_distributor,this.search_client,"-",{text:"\u67e5\u8be2",handler:this.quickSearch,scope:this}]);this.grid.getTopToolbar().insertButton(11,{text:"\u6253\u5370",iconCls:"print-icon",menu:new Ext.menu.Menu({items:[{text:"\u53d1\u8d27/\u51fa\u5e93\u5355",handler:this.printRecord(0),scope:this},{text:"\u56de\u6267\u5355",handler:this.printRecord(1),scope:this},{text:"\u5229\u6da6\u5206\u6790\u5355",handler:this.printRecord(3),scope:this,hidden:true}]})})},this)}});BaseStockTakeBillPanel=Ext.extend(BaseStockBillPanel,{baseUrl:"stockIncome.java",editEmptyObj:{id:null,product:null,productTitle:null,productSn:null,brand:null,spec:null,model:null,unit:null,price:null,num:null,remark:null,location:null,depot:null,blockSn:null,totalAmount:null,vdate:null,salePrice:null,saleAmount:null,factNum:null,accountNum:null},editStoreMapping:["id","product",{name:"productSn",mapping:"product.sn"},{name:"productTitle",mapping:"product.title"},{name:"brand",mapping:"product.brand"},{name:"spec",mapping:"product.spec"},{name:"model",mapping:"product.model"},{name:"unit",mapping:"product.unit"},"price","num","remark","location","depot","blockSn","totalAmount","vdate","totalAmount","salePrice","saleAmount","factNum","accountNum"],formFocus:function(){var a=this.fp.form.findField("depot");if(a){a.focus("",1000)}},getEditColumnModel:function(){this.productEditor=new ProductComboBox(Ext.apply({},{returnObject:true,name:"productInput",hiddenName:"productInput",displayField:"fullName",valueField:"id",width:300,choiceValue:this.selectRowData.createDelegate(this)},ConfigConst.CRM.product));this.depotLocationEditor=new Disco.Ext.SmartCombox({returnObject:true,name:"depotLocationInput",hiddenName:"depotLocationInput",fieldLabel:"depotLocationInput",displayField:"title",valueField:"id",store:new Ext.data.JsonStore({fields:["id","title"]}),editable:false,mode:"local",triggerAction:"all",emptyText:"\u8bf7\u9009\u62e9..."});return new Ext.grid.ColumnModel([new Ext.grid.RowNumberer({header:"\u5e8f\u53f7",dataIndex:"sequence",width:35}),{header:"Id",dataIndex:"id",width:1,hidden:true,hideable:false},{header:"\u4ea7\u54c1",dataIndex:"product",width:0,hidden:true,hideable:false},{header:"\u4ea7\u54c1\u7f16\u53f7",dataIndex:"productSn",width:150,editor:this.productEditor,summaryType:"count",summaryRenderer:function(a){return"\u5408\u8ba1("+a+")"}},{header:"\u4ea7\u54c1\u540d\u79f0",dataIndex:"productTitle",width:80,renderer:this.readOnlyRender()},{header:"\u54c1\u724c",dataIndex:"brand",width:80,renderer:this.objectRender("name",Disco.Ext.Util.readOnlyGridCellColor)},{header:"\u6750\u8d28/\u578b\u53f7",dataIndex:"model",width:80,hidden:true,renderer:this.readOnlyRender()},{header:"\u5c3a\u5bf8/\u89c4\u683c",dataIndex:"spec",width:80,hidden:true,renderer:this.readOnlyRender()},{header:"\u5355\u4f4d",dataIndex:"unit",width:50,renderer:this.objectRender("title",Disco.Ext.Util.readOnlyGridCellColor)},{header:"\u8d26\u5b58\u6570",dataIndex:"accountNum",width:60,renderer:this.readOnlyRender(),editor:new Ext.form.NumberField(),summaryType:"sum",summaryRenderer:function(a){return a.toFixed(2)}},{header:"\u5b9e\u5b58\u6570",dataIndex:"factNum",width:60,editor:new Ext.form.NumberField(),summaryType:"sum",summaryRenderer:function(a){return a.toFixed(2)}},{header:"\u6570\u91cf",dataIndex:"num",width:60,renderer:this.readOnlyRender(),summaryType:"sum",summaryRenderer:function(a){return a.toFixed(2)}},{header:"\u5355\u4ef7",dataIndex:"price",width:60,hidden:true,renderer:this.readOnlyRender(function(a){return a&&a.toFixed?a.toFixed(2):a})},{header:"\u91d1\u989d",dataIndex:"totalAmount",hidden:true,width:80,renderer:this.readOnlyRender(function(a){return a&&a.toFixed?a.toFixed(2):a}),summaryType:"sum",summaryRenderer:function(a,c,b){return a.toFixed(2)}},{header:"\u9500\u552e\u5355\u4ef7",dataIndex:"salePrice",width:80,editor:new Ext.form.NumberField()},{header:"\u9500\u552e\u91d1\u989d",dataIndex:"saleAmount",width:80,renderer:this.readOnlyRender(function(a){return a&&a.toFixed?a.toFixed(2):a}),summaryType:"sum",summaryRenderer:function(a,c,b){return a.toFixed(2)}},{header:"\u6279\u6b21",dataIndex:"blockSn",width:50,editor:new Ext.form.NumberField()},{header:"\u5e93\u4f4d",dataIndex:"location",width:80,editor:this.depotLocationEditor,renderer:function(a){return a?(a.title||a.text||a):a}},{header:"\u51fa\u5e93\u65e5\u671f",dataIndex:"vdate",width:100,editor:new Ext.form.DateField({format:"Y-m-d"}),renderer:this.dateRender("Y-m-d"),hidden:true},{header:"\u51fa\u5e93\u6570",dataIndex:"stockNum",width:80,hidden:true,summaryType:"sum",summaryRenderer:function(a){return a.toFixed(2)}},{header:"\u5f00\u7968\u6570	",dataIndex:"invoiceNum",width:80,editor:new Ext.form.NumberField(),hidden:true,summaryType:"sum",summaryRenderer:function(a){return a.toFixed(2)}},{header:"\u5907\u6ce8",dataIndex:"remark",editor:new Ext.form.TextField()}])}});Ext.apply(Ext.Window.prototype,{constrain:true});Disco.Ext.AdvanceSearch=Ext.extend(Ext.Button,{iconCls:"search-icon",text:"\u9ad8\u7ea7\u641c\u7d22",store:undefined,formConfig:{},handler:function(){if(this.isExpanded()){this.collapse()}else{this.expand()}},isExpanded:function(){return this.layer&&this.layer.isVisible()},isCreate:function(){return this.layer},expand:function(){if(!this.isCreate()){this.create();var a=this;this.formPanel.getForm().items.each(function(b){if(b.expand){b.on("expand",a.onFieldExpand,a);b.on("collapse",a.onFieldCollapse,a)}if(b.getXType()=="datefield"||b.getXType()=="datesearchfield"){b.beforeShowMenu=function(){if(this.menuEventBound){return}this.menuEventBound=true;b.menu.on("hide",a.onFieldCollapse,a);b.menu.on("show",a.onFieldExpand,a)}}})}this.layer.alignTo(this.el,"bl");this.layer.show();Ext.getDoc().on("mousewheel",this.collapseIf,this);Ext.getDoc().on("mousedown",this.collapseIf,this);this.fireEvent("expand",this)},onFieldExpand:function(){Ext.getDoc().un("mousewheel",this.collapseIf,this);Ext.getDoc().un("mousedown",this.collapseIf,this)},onFieldCollapse:function(){Ext.getDoc().on("mousewheel",this.collapseIf,this);Ext.getDoc().on("mousedown",this.collapseIf,this)},collapse:function(){if(!this.isExpanded()){return}this.layer.hide();Ext.getDoc().un("mousewheel",this.collapseIf,this);Ext.getDoc().un("mousedown",this.collapseIf,this);this.fireEvent("collapse",this)},collapseIf:function(a){if(!a.within(this.el)&&!a.within(this.layer)){this.collapse()}},destroy:function(){if(this.destroyed){return}this.destroyed=true;Ext.AdvanceSearch.superclass.destroy.call(this);if(this.formPanel){this.formPanel.destroy()}if(this.layer){this.layer.destroy()}Ext.getDoc().un("mousewheel",this.collapseIf,this);Ext.getDoc().un("mousedown",this.collapseIf,this)},create:function(){this.layer=new Ext.Layer({shadow:true,constrain:false});var b=new Ext.KeyNav(this.layer,{enter:function(c){this.search()},scope:this});var a={width:300,frame:true,bodyStyle:"padding:10px",baseParams:this.baseParams||{},defaultType:"textfield",labelWidth:60,labelAlign:"right",defaults:{width:180},items:this.createFormItems(),buttons:[{text:"\u91cd\u7f6e",scope:this,handler:this.reset},{text:"\u641c\u7d22",scope:this,handler:this.search},{text:"\u53d6\u6d88",scope:this,handler:this.collapse}]};Ext.apply(this.formConfig,a);this.formPanel=new Ext.FormPanel(a);this.formPanel.render(this.layer)},reset:function(){var a=this.formPanel.getForm();a.reset()},search:function(){this.store.removeAll();this.store.load({params:this.formPanel.getForm().getValues()});this.collapse()},findField:function(a){return this.formPanel.getForm().findField(a)},createFormItems:function(){}});Ext.reg("advanceSearch",Disco.Ext.AdvanceSearch);if(Ext.isIE){window.onhelp=function(){return false}}else{Ext.get(document.documentElement).addKeyMap([{key:Ext.EventObject.F1,fn:function(a,c){var b={text:"\u5e2e\u52a9\u4e2d\u5fc3",attributes:{appClass:"SystemHelpDocPanel",script:"base/SystemHelpDocPanel.js",inWin:true}};Global.openExtAppNode(b,null);c.preventDefault()}}])};
