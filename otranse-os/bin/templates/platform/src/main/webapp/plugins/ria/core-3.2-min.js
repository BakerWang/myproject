Disco_RIA={version:"2.0",title:"EasyFuse RIA Framework",devMode:false,permissionCheck:true,permissionCheckAction:"/permissionCheck.java",extVersion:"ext-3.2",script:"/extApp.java?cmd=loadScript&script=",PersonalityUrl:"manage.java",sysSkinPath:null,getCfg:function(a){return Ext.getObjVal(window.Global.Config,a)},setCfg:function(b,c){var a=Disco_RIA.getCfg();if(a){a[b]=c}return this},formatUrl:function(a,b){return Ext.urlAppend(a,Ext.urlEncode({cmd:b}))},ajaxErrorHandler:function(a,b){Disco.Ext.Msg.error("\u64cd\u4f5c\u5931\u8d25\uff0c\u5931\u8d25\u539f\u56e0\uff1a<br/>"+(a.error||(a.errors?(a.errors.msg||a.errors.msg):null)||b||"\u9519\u8bef\u672a\u77e5"))}};Ext.form.Field.prototype.msgTarget="side";Ext.BLANK_IMAGE_URL=String.format("plugins/extjs/{0}/resources/images/default/s.gif",Disco_RIA.extVersion);Ext.chart.Chart.CHART_URL=String.format("plugins/extjs/{0}/resources/charts.swf",Disco_RIA.extVersion);Ext.QuickTips.init();Ext.namespace("Disco.Ext","Disco.Ext.Msg");Disco.Ext=Disco.Ext;Disco.Ext.Msg=Disco.Ext.Msg;Ext.apply(Disco.Ext.Msg,{alert:function(f,e,c,b,a){if(Ext.isFunction(e)){a=b;b=c;c=e;e=null}var d={title:e||"\u64cd\u4f5c\u63d0\u793a",msg:f,scope:b||window,fn:c,width:220,icon:a||Ext.Msg.INFO,buttons:Ext.Msg.OK};if(typeof f=="object"){Ext.apply(d,f)}Ext.Msg.show(d)},error:function(g,f,d,c){var e=Disco.Ext.Msg.error.length;var a=Array.prototype.slice.call(arguments,0,e);if(e!=a.length){if(a.length<e){var b=a.length;for(b;b<e;b++){a.push(null)}a.push(Ext.Msg.ERROR)}}else{a.push(Ext.Msg.ERROR)}Disco.Ext.Msg.alert.apply(this,a)}});Disco.Ext.Window=function(){var c=new Ext.util.MixedCollection();c.on("add",function(f,g,e){if(f>50){c.removeAt(0)}},this);var a=new Ext.util.MixedCollection();var b={ok:"\u786e\u5b9a",cancel:"\u91cd\u7f6e",yes:"\u786e\u5b9a",no:"\u53d6\u6d88"};var d=function(f,e){var g=f.ownerCt.ownerCt;Ext.callback(g.handler,g.scope||g,[e,g,g.getComponent(0)]);if(g.autoHide){g.hide()}};return{defaultConfig:{maxWin:5,width:500,height:300,modal:true,layout:"fit",single:true,constrain:true,resizable:false,buttonAlign:"center",closeAction:"hide"},components:c,autoDestroyWin:function(e){if(this.all.getCount()>this.defaultConfig.maxWin){e.destroy();this.autoRemoveProperty.call(e);this.all.remove(e)}},autoRemoveProperty:function(){delete this.handler;delete this.scope;delete this.autoHide},destroyComp:function(){var e=Array.prototype.slice.call(arguments,0);Ext.each(e,function(f){if(Ext.type(f.destroy)=="function"){f.destroy()}c.remove(f)},this)},show:function(g){var e=Ext.apply({},g,this.defaultConfig);var f=this.getFreeWin(e);f.on("beforehide",this.autoDestroyWin,this,{single:true});f.on("hide",function(i){if(e.single){i.remove(0,true);c.remove(i.getComponent(0));this.autoRemoveProperty.call(i)}else{var h=i.remove(0,false);h.hide();h.getEl().appendTo(Ext.getBody())}},this,{single:true});f.show();f.setTitle(e.title);f.setWidth(e.width);if(e.height=="auto"){f.autoHeight=true;f.syncSize.defer(1000,f)}else{f.autoHeight=false;f.setHeight(e.height)}f.center()},buildComponent:function(g,f){if(c.get(f)){return c.get(f)}else{if(Ext.type(g)=="object"){var e=null;if(g.constructor.prototype.ctype=="Ext.Component"){e=g}else{if(g.constructor==Object){e=Ext.ComponentMgr.create(g,"panel")}else{e=g}}if(f){c.add(f,e)}return e}}},updateButtons:function(f,e){if(Ext.isArray(e)&&e.length){Ext.each(f.buttons,function(g){if(e.indexOf(g.id)>=0){g.show()}else{g.hide()}},f)}else{Ext.each(f.buttons,function(g){g.hide()},f)}},getFreeWin:function(f){var k=null;a.each(function(l){if(l.hidden){k=l;return false}},this);var j=f.items;var i=f.buttons;var h=f.handler;var g=f.scope;var e=f.autoHide;Ext.del(f,"buttons","items","handler","autoHide","scope");j=this.buildComponent(j,f.compId);var k=k||this.getWin(Ext.apply(f,{buttons:this.getButtons.call(this)}));k.autoHide=e;k.handler=h;k.scope=g;this.updateButtons(k,i);if(k.items&&k.items.getCount()>0){k.remove(0,false)}if(j.hidden){j.show()}k.add(j);return k},all:a,getWin:function(e){var f=new Ext.Window(Ext.apply(e,{manager:this.group}));a.add(f);return f},YESNO:["yes","no"],YESNOCANCEL:["yes","cancel","no"],YES:["yes"],getButtons:(function(){return[{text:b.yes,id:"yes",handler:d.createDelegate(this,["yes"],1),scope:this},{text:b.cancel,id:"cancel",handler:d.createDelegate(this,["cancel"],1),scope:this},{text:b.no,id:"no",handler:d.createDelegate(this,["no"],1),scope:this}]})}}();Ext.form.LabelField=Ext.extend(Ext.form.Field,{defaultAutoCreate:{tag:"div"},fieldClass:"x-form-item-label",style:"padding-top:3px",onRender:function(b,a){Ext.form.LabelField.superclass.onRender.call(this,b,a);this.el.dom.name=this.initialConfig.name;this.el.dom.value=""},setValue:function(a){Ext.form.LabelField.superclass.setValue.call(this,a);var b=a;if(this.renderer){b=this.renderer(a)}if(typeof b==window.undefined){b=""}if(this.el){this.el.update(b)}},markInvalid:Ext.emptyFn,clearInvalid:Ext.emptyFn});Ext.reg("labelfield",Ext.form.LabelField);Ext.form.LabelFieldReadonly=Ext.extend(Ext.form.LabelField,{getValue:Ext.emptyFn});Ext.reg("labelfieldreadonly",Ext.form.LabelField);Ext.form.SearchField=Ext.extend(Ext.form.TwinTriggerField,{onSearch:function(){this.hasSearch=true},onClear:function(){if(this.hasSearch){this.hasSearch=false;this.el.dom.value="";this.triggers[0].hide();this.focus()}},initComponent:function(){Ext.form.SearchField.superclass.initComponent.call(this);this.addEvents("search","clear");this.on("specialkey",function(a,b){if(b.getKey()==b.ENTER&&!(b.shiftKey||b.ctrlKey||b.altKey)){this.onSearch(this,this.getValue(),b)}},this);this.on({scope:this,clear:this.onClear,search:this.onSearch})},validationEvent:false,validateOnBlur:false,hideTrigger1:true,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",width:180,hasSearch:false,paramName:"query",onTrigger1Click:function(a){this.fireEvent("clear",this,this.getValue(),a)},onTrigger2Click:function(a){this.fireEvent("search",this,this.getValue(),a)}});Disco.Ext.SearchField=Ext.extend(Ext.form.SearchField,{validationEvent:false,validateOnBlur:false,emptyText:"\u5185\u5bb9\u5173\u952e\u5b57......",onClear:function(){if(this.hasSearch){Disco.Ext.SearchField.superclass.onClear.call(this);var a=this.store;delete a.baseParams[this.paramName];a.load()}},onSearch:function(){var a=this.getRawValue();if(a.length<1){return this.onTrigger1Click()}this.store.baseParams={};this.store.baseParams[this.paramName]=a;var b={start:0,searchType:"simple"};this.store.reload({params:b,callback:function(c){if(!c||c.length<1){Disco.Ext.Msg.alert("\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u8bb0\u5f55\uff01")}}});this.hasSearch=true;this.triggers[0].show();this.focus()},initComponent:function(){if(!this.store.baseParams){this.store.baseParams={}}Disco.Ext.SearchField.superclass.initComponent.call(this)}});Ext.reg("searchfield",Disco.Ext.SearchField);Disco.Ext.CkEditor=Ext.extend(Ext.form.TextArea,{editorCfg:{},onResize:function(c,a,d){var b;if(b=this.getEditor()){b.resize("99%",d-5)}},editDataReadyHanlder:function(){this.fireEvent("editdataready",this,this.getEditor(),this.getEditor().getData())},setValue:function(b,d){Disco.Ext.CkEditor.superclass.setValue.call(this,b);var a;if(a=this.getEditor()){var c=this.editDataReadyHanlder;if(Ext.isFunction(d)){d.createSequence(c,this)}else{d=c.createDelegate(this)}a.setData.defer(1,a,[b,d])}},getValue:function(){var a;if(a=this.getEditor()){return a.getData()}else{return Disco.Ext.CkEditor.superclass.getValue.call(this)}},getEditor:function(){if(this.el){var b=this.el.id,a=null;if(window.CKEDITOR&&CKEDITOR.instances&&(a=CKEDITOR.instances[b])){return a}}},createEditor:function(){var e=this.el.id;var b=this.el.getSize();var d=Math.max(b.height,this.height);if(this.getEditor()){CKEDITOR.remove(this.getEditor())}var c=CKEDITOR.replace(e,Ext.apply({height:d},this.editorCfg));var a=this;c.on("instanceReady",function(){a.fireEvent.call(a,"instanceReady");c.resize("99%",d-5)})},beforeDestroy:function(){Disco.Ext.CkEditor.superclass.beforeDestroy.call(this);if(this.getEditor()){CKEDITOR.remove(this.getEditor())}},afterRender:function(){this.addEvents("editdataready","instanceReady");Disco.Ext.CkEditor.superclass.afterRender.call(this);this.on("resize",this.onResize,this);this.createEditor.defer(1,this)}});Ext.reg("ckeditor",Disco.Ext.CkEditor);Disco.Ext.FormWindow=Ext.extend(Ext.Window,{confirmSave:false,checkFormDirty:function(){var a=this.getComponent(0);if(a&&a.form){return a.form.isDirty()}else{return false}},hide:function(c,a,b){if(this.hidden||this.fireEvent("beforehide",this)===false){return}if(this.confirmSave&&this.checkFormDirty()){Ext.MessageBox.show({title:"\u662f\u5426\u8981\u4fdd\u5b58\u5f55\u5165\u7684\u6570\u636e?",msg:"\u60a8\u6240\u7f16\u8f91\u7684\u8868\u5355\u4e2d\u542b\u6709\u672b\u4fdd\u5b58\u7684\u6570\u636e,\u662f\u5426\u8981\u4fdd\u5b58\u4fee\u6539\u540e\u7684\u5185\u5bb9?",buttons:Ext.Msg.YESNOCANCEL,fn:function(d){if(d=="no"){Disco.Ext.FormWindow.superclass.hide.call(this,c,a,b)}else{if(d=="yes"){if(this.crudService){this.crudService.save(Disco.Ext.FormWindow.superclass.hide.createDelegate(this,[c,a,b]),this.autoClose)}else{if(Ext.isFunction(this.saveFunction)){this.saveFunction(this.getComponent(0))}}}else{if(d=="cancel"){}}}},icon:Ext.MessageBox.QUESTION,scope:this})}else{Disco.Ext.FormWindow.superclass.hide.call(this,c,a,b)}}});Disco.Ext.CascadeForm=Ext.extend(Ext.FormPanel,{layout:"border",formElements:["west","north","east","south"],buildWestForm:function(){},buildNorthForm:function(){},buildEastForm:function(){},buildSouthForm:function(){},buildContentForm:function(){},getEditCmps:function(){return this.editCmps=this.editCmps||[]},addEditCmps:function(a){Ext.each(arguments,function(b){if(Ext.isArray(b)){this.addEditCmps(b);return true}if(!this.containsEditCmp(b)){this.getEditCmps().push(b)}},this)},containsEditCmp:function(a){return this.getEditCmps().indexOf(a)>=0},getEditorCmpValues:function(){var a={};Ext.each(this.getEditCmps(),function(c){var b=c.getRowsValues();if(b){Ext.apply(a,b)}},this);return a},getValues:function(){var a=this.getForm().getValues();var b=this.getEditorCmpValues();Ext.apply(a,b);return a},setValues:function(a){this.getForm().setValues(a)},onBeforeSubmit:function(){var a=this.getEditorCmpValues();this.getForm().baseParams=a},submit:function(a){if(this.onBeforeSubmit()!==false){this.getForm().submit(a)}},beforeDestroy:function(){this.editCmps=null;Disco.Ext.CascadeForm.superclass.beforeDestroy.call(this)},createContent:function(){var a=this.buildContentForm();this.addEditCmps(a);return a},initComponent:function(){this.items=[{layout:"fit",region:"center",border:false,items:this.createContent()}];for(var c=0;c<this.formElements.length;c++){var b=this.formElements[c],d;var a=b.substring(0,1).toUpperCase()+b.substring(1);if(d=this[String.format("build{0}Form",a)]()){d.region=b;this.items.push(d)}}Disco.Ext.CascadeForm.superclass.initComponent.call(this)}});Disco.Ext.TreeCascadePanel=Ext.extend(Ext.Panel,{treeCfg:{},layout:"hbox",border:false,layoutConfig:{align:"stretch"},queryParam:"type",defaultstreeCfg:{width:200,dataUrl:"",rootText:"root",rootId:"root",loader:null,rootVisible:true},getPanel:function(){return this.panel},getTree:function(){return this.tree},getGrid:function(){if(this.panel instanceof Ext.grid.GridPanel){return this.panel}else{if(this.panel instanceof Disco.Ext.CrudPanel){return this.panel.grid}else{if(this.panel&&this.panel.grid){return this.panel.grid}}}},createTree:function(){var c=Ext.apply({},this.treeCfg,this.defaultstreeCfg);var b=c.rootId;var f=c.rootText;var g=c.dataUrl;var h=c.loader;var e=c.rootIconCls;var d=c.expanded;delete c.rootId,delete c.rootText,delete c.dataUrl,delete c.loader,c.rootIconCls;var a=new Ext.tree.TreePanel(Ext.apply({tools:[{id:"refresh",handler:function(){this.tree.root.reload()},scope:this}],style:"padding-right:1px;padding-top:1px;",root:new Ext.tree.AsyncTreeNode({expanded:d,id:b,iconCls:e,text:f}),loader:h||new Ext.tree.TreeLoader({dataUrl:g})},c));a.on({scope:this,click:this.onTreeClick});return a},reloadGrid:function(c,b){var a=this.getGrid();if(a){a.getStore().baseParams[this.queryParam]=(c=="root")?null:c;a.getStore().load()}},onTreeClick:function(b,a){this.reloadGrid(b.id,b)},beforeDestroy:function(){Ext.destroy(this.panel,this.tree);delete this.panel;delete this.tree;Disco.Ext.TreeCascadePanel.superclass.beforeDestroy.call(this)},initComponent:function(){this.tree=this.createTree();this.items=[this.tree,Ext.apply(this.getPanel(),{flex:1})];Disco.Ext.TreeCascadePanel.superclass.initComponent.call(this)}});Disco.Ext.CrudFunction={exportData:false,importData:false,printData:false,clearData:false,allowSearch:true,showMenu:true,showTbar:true,showAdd:true,showEdit:true,showRemove:true,showView:true,showRefresh:true,showSearchField:true,defaultsActions:{create:"save",list:"list",view:"view",update:"update",remove:"remove"},batchRemoveMode:false,autoLoadGridData:true,columnLock:false,summaryGrid:false,dirtyFormCheck:true,operatorButtonStyle:1,customizeQueryObject:false,queryObjectName:null,winWidth:500,winHeight:400,winTitle:"\u6570\u636e\u7ba1\u7406",pageSize:10,pagingToolbar:true,defaultCmd:true,viewSave:Ext.emptyFn,initComponent:Ext.emptyFn,linkRender:Disco.Ext.Util.linkRenderer,imgRender:Disco.Ext.Util.imgRender,booleanRender:Disco.Ext.Util.booleanRender,dateRender:Disco.Ext.Util.dateRender,objectRender:Disco.Ext.Util.objectRender,typesRender:Disco.Ext.Util.typesRender,readOnlyRender:Disco.Ext.Util.readOnlyRender,operaterRender:Disco.Ext.Util.operaterRender,buildRemoteCombox:Disco.Ext.Util.buildRemoteCombox,singleWindowMode:false,gridSelModel:"row",gridRowNumberer:false,booleans:[["\u662f",true],["\u5426",false]],storage:null,crud_operators:[{name:"btn_add",text:"\u6dfb\u52a0(<u>A</u>)",iconCls:"add",method:"create",cmd:"save",noneSelectRow:true,hidden:true},{name:"btn_edit",text:"\u7f16\u8f91(<u>E</u>)",iconCls:"edit",disabled:true,method:"edit",cmd:"update",hidden:true},{name:"btn_view",text:"\u67e5\u770b(<u>V</u>)",iconCls:"view",method:"view",disabled:true,hidden:true},{name:"btn_remove",text:"\u5220\u9664(<u>D</u>)",iconCls:"delete",disabled:false,method:"removeData",cmd:"remove",hidden:true},{name:"btn_refresh",itemId:"btn_refresh",text:"\u5237\u65b0",iconCls:"refresh",method:"refresh",noneSelectRow:true},{name:"btn_advancedSearch",text:"\u9ad8\u7ea7\u67e5\u8be2(<u>S</u>)",iconCls:"srsearch",method:"advancedSearch",cmd:"list",hidden:true,noneSelectRow:true,clientOperator:true},{name:"btn_clearSearch",text:"\u663e\u793a\u5168\u90e8",cls:"x-btn-text-icon",iconCls:"search",noneSelectRow:true,method:"clearSearch",hidden:true},{name:"btn_print",text:"\u6253\u5370(<u>P</u>)",iconCls:"print-icon",disabled:true,method:"printRecord",hidden:true},{name:"btn_export",text:"\u5bfc\u51faExcel(<u>O</u>)",iconCls:"export-icon",method:"exportExcel",noneSelectRow:true,hidden:true},{name:"btn_import",text:"\u5bfc\u5165\u6570\u636e(<u>I</u>)",iconCls:"import-icon",method:"importExcel",noneSelectRow:true,hidden:true},"->",{type:"searchfield",name:"searchField",width:100,noneSelectRow:true,paramName:"searchKey",clientOperator:true}],objectAutoRender:function(a){if(a&&a.id){for(var b in a){if(b!="id"&&a[b]){return a[b]}}return a.id}else{return a}},search:function(){Ext.apply(this.store.baseParams,{searchKey:this.searchField?this.searchField.getValue():""});if(this.store.lastOptions&&this.store.lastOptions.params){this.store.lastOptions.params.start=0;this.store.lastOptions.params.pageSize=this.store.baseParams.pageSize||this.pageSize}this.refresh(false)},formatUrl:function(a){return Disco_RIA.formatUrl(this.baseUrl,a)},importExcel:function(){if(!Disco.Ext.ImportPanel){Disco.Ext.ImportPanel=new Ext.form.FormPanel({id:"crudExportPanel",fileUpload:true,items:[{xtype:"fieldset",title:"\u9009\u62e9\u6570\u636e\u6587\u4ef6",autoHeight:true,items:{xtype:"textfield",hideLabel:true,inputType:"file",name:"file",anchor:"100%"}},{xtype:"fieldset",title:"\u5bfc\u5165\u8bf4\u660e",html:this.importExplain||"",height:120}]})}var a=this.createGlobalWin("CrudExportWindow",500,310,"\u5bfc\u5165\u6570\u636e",Disco.Ext.ImportPanel,function(){var b=Disco.Ext.ImportPanel.form;if(b.findField("file").getValue().length<2){Ext.Msg.alert("\u63d0\u793a","\u4f60\u6ca1\u6709\u9009\u62e9\u8981\u5bfc\u5165\u7684\u6587\u4ef6\uff01");return}Disco.Ext.ImportPanel.form.submit({url:this.baseUrl,params:{cmd:"import"},waitMsg:"\u8bf7\u7a0d\u5019\uff0c\u6b63\u5728\u5bfc\u5165\u6570\u636e",success:function(){Ext.Msg.alert("\u63d0\u793a","\u6570\u636e\u5bfc\u5165\u6210\u529f!",function(){b.findField("file").reset();a.hide();this.store.reload()},this)},failure:function(c,d){Disco_RIA.ajaxErrorHandler(d.result,"\u6570\u636e\u5bfc\u5165\u51fa\u9519\uff0c\u8bf7\u68c0\u6d4b\u6240\u9009\u62e9\u7684\u6587\u4ef6\u683c\u5f0f\u662f\u5426\u6b63\u786e?")},scope:this})})},getExportForm:Disco.Ext.Util.getExportForm,exportExcel:function(){var b=this.store.baseParams;Ext.apply(b,{searchKey:this.searchField?this.searchField.getValue():""});var a=this.getExportForm();a.form.submit({url:this.baseUrl,params:Ext.apply({cmd:"export"},this.store.baseParams)})},printList:function(a){return function(){var c=Ext.apply(this.store.baseParams,{cmd:(a?a:"printList")});var b=Ext.urlEncode(c);window.open(this.baseUrl+"?"+b)}},printRecord:function(){var a=this.grid.getSelectionModel().getSelected();if(!a){this.alert("\u8bf7\u5148\u9009\u62e9\u8981\u64cd\u4f5c\u7684\u6570\u636e\uff01","\u63d0\u793a\u4fe1\u606f");return false}window.open(this.baseUrl+"?cmd=print&id="+a.get("id"))},clearSearch:function(){this.store.baseParams={};this.store.removeAll();this.store.load({params:{start:0,pageSize:this.pageSize}})},refresh:function(b){this.store.removeAll();var c=function(d){if(d&&d.length<1){this.alert("\u6ca1\u6709\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\uff01","\u63d0\u793a\u4fe1\u606f");Disco.Ext.Util.autoCloseMsg.defer(2000)}};var a={callback:c,scope:this};this.store[b!==false?"reload":"load"](a);this.disableOperaterItem("btn_remove","btn_edit","btn_view","btn_print");this.focus()},initWin:function(c,i,g,h,e,a,b){this.winWidth=c;this.winHeight=i;this.winTitle=g;var f=e?"CrudEditNewWindow":"CrudEditWindow";if(this.singleWindowMode){f=f+this.id}var d=this.createGlobalWin(f,c,i,g,this.fp,null,"fp",[{itemId:"btnSave",text:"\u4fdd\u5b58(<u>K</u>)",handler:function(){Disco.Ext[f].crudService.save(h,e)},iconCls:"save",scope:this},{itemId:"btnReset",text:"\u91cd\u7f6e(<u>R</u>)",iconCls:"clean",handler:function(){Disco.Ext[f].crudService.reset()},scope:this},{itemId:"btnClose",text:"\u53d6\u6d88(<u>X</u>)",iconCls:"delete",handler:function(){Disco.Ext[f].crudService.closeWin(e)},scope:this}],e,a?true:false,b?true:false);d.confirmSave=this.dirtyFormCheck;return d},getViewWin:function(c){var b=Ext.isFunction(this.viewWin)?this.viewWin():this.viewWin;var d=b.width;var a=b.height;var e=b.title;return this.createGlobalWin("CrudViewWindow",d,a,e,this.viewPanel,function(){var f=Disco.Ext.CrudViewWindow;if(f.crudService){f.crudService.viewSave(this.viewPanel)}f.hide()},"viewPanel",null,c)},doSomeWork:function(c,k,h,a,j,d,i,b,g){var e=this.grid.getSelectionModel().getSelected();if(!e){this.alert("\u8bf7\u5148\u9009\u62e9\u8981\u64cd\u4f5c\u7684\u6570\u636e\uff01","\u63d0\u793a\u4fe1\u606f");return false}if(!this[a]){this[a]=this[j]()}var f=this.getWorkWin(c,k,h,this[a],function(){if(!this[a].form.isValid()){return false}this[a].form.submit({url:b?b:this.baseUrl,waitMsg:"\u6b63\u5728\u6267\u884c\u64cd\u4f5c\uff0c\u8bf7\u7a0d\u5019",params:{cmd:d},success:function(){f.hide();this.refresh()},failure:function(l,m){var o="";if(m.failureType==Ext.form.Action.SERVER_INVALID){for(var n in m.result.errors){o+=m.result.errors[n]+"&nbsp;"}}else{o="\u6570\u636e\u5f55\u5165\u4e0d\u5408\u6cd5\u6216\u4e0d\u5b8c\u6574\uff01"}Disco.Ext.Msg.alert(o,"\u4fdd\u5b58\u5931\u8d25!")},scope:this})},a,i,g);return f},getWorkWin:function(d,q,m,a,k,f,i,j){var g=this.grid.getSelectionModel().getSelected();if(!g){this.alert("\u8bf7\u5148\u9009\u62e9\u8981\u64cd\u4f5c\u7684\u6570\u636e\uff01","\u63d0\u793a\u4fe1\u606f");return false}var b=g.get("id");var h=this.createGlobalWin(i?i:"CrudWorkWindow",d,q,m,a,k,f,null,j);for(var e in g.data){var l=h.getComponent(0).findSomeThing(e);if(l){var o=g.get(e);if(l.isFormField){l.setValue(o);l.clearDirty()}else{if(l.renderer){o=l.renderer(o)}if(l.setText){l.setText(o)}else{if(l.getXType&&l.getXType()=="panel"){l.body.update(o)}}}}}return h},alert:function(b,a){Disco.Ext.Msg.alert(b,a||"\u63d0\u793a",function(){this.focus()},this)},confirm:function(b,a,c){Ext.Msg.confirm(b,a,function(d){if(d=="yes"){c()}else{this.focus()}},this)},focusFirstField:function(a,b){a=a||this.fp;b=b||this.win;a=b.findBy(function(c){if(c instanceof Ext.FormPanel){return true}},this);b.currentFocus=false;if(a&&a[0].form.items){a[0].form.items.each(function(c){if(c.canFocus()){c.focus("",10);b.currentFocus=c;return false}})}if(!b.currentFocus){if(b.buttons&&b.buttons.length){b.buttons[0].focus("",10);b.currentFocus=b.buttons[0]}}},createGlobalWin:function(j,e,n,m,a,k,f,l,i,b,d){var h=Disco.Ext[j];if(!h){this[f?f:a.id]=a;var g=[];g.push({id:"help",handler:this.help});if(this.storage){this.storage.scope=this;l.push(this.storage)}Disco.Ext[j]=new Disco.Ext.FormWindow({width:e,layout:"fit",border:false,resizable:b,height:n,buttonAlign:"center",title:m,modal:true,defaultButton:0,shadow:true,maximized:false,maximizable:d,tools:g,closeAction:i||this.singleWindowMode?"close":"hide",autoClose:i||this.singleWindowMode,listeners:{close:function(o){if(o.crudService.store&&o.crudService.closeSaveWin===false&&j!="CrudSearchWindow"){o.crudService.store.reload()}o.crudService.focusCrudGrid();delete Disco.Ext[j]},maximize:function(o){if(o.maximizable){o.doLayout();o.maximized=true}},restore:function(o){if(o.maximizable){o.doLayout();o.maximized=false}},show:function(q){if(q.maximizable){q.tools[q.maximized?"maximize":"restore"].setVisible(q.crudService.maximizable===true)}q.tools.help.setVisible(q.crudService.showHelp!=undefined);var o=q.findByType(Ext.FormPanel);q.crudService.focusFirstField(o,q)},hide:function(o){if(o.crudService.store&&o.crudService.closeSaveWin===false&&j!="CrudSearchWindow"){o.crudService.store.reload()}o.crudService.focus()}},items:[a],buttons:l?l:[{itemId:"btnSave",text:"\u786e\u5b9a(<u>K</u>)",handler:function(){var o=Disco.Ext[j];var q=true;if(k){q=k.call(o.crudService,i)}if(q){if(i){o.close()}else{o.hide()}}},iconCls:"save",scope:this},{itemId:"btnClose",text:"\u9000\u51fa(<u>X</u>)",iconCls:"delete",handler:function(){if(i||this.singleWindowMode){Disco.Ext[j].close()}else{Disco.Ext[j].hide()}},scope:this}],keys:[{key:"k",alt:true,stopEvent:true,fn:function(){Disco.Ext.Util.executePanelButtons(h,"btnSave")}},{key:"x",stopEvent:true,alt:true,fn:function(){Disco.Ext.Util.executePanelButtons(h,"btnClose")}},{key:"r",stopEvent:true,alt:true,fn:function(){Disco.Ext.Util.executePanelButtons(h,"btnReset")}}]});h=Disco.Ext[j]}else{if(a){if(h.crudService!=this){}h.setTitle(m);h.setWidth(e);h.setHeight(n);if(h.getComponent(0)!=a){var c=h.remove(0);delete h.crudService[f?f:c.id];h.add(a);this[f?f:a.id]=a;h.doLayout()}}}h.crudService=this;this[j]=h;h.show((typeof main!="undefined")&&Disco_RIA.getCfg("enableAnimate")?Ext.getBody():false,function(){h.center()},this);if(n=="auto"){h.autoHeight=true;h.syncSize.defer(1000,h)}else{h.autoHeight=false}return h},showWin:function(){if(!this.fp){if(!this.createViewPanel&&this.viewPanel){this.fp=this.viewPanel}else{this.fp=this.createForm()}}this.win=this.createWin();this.win.on("close",function(){delete this.win;delete this.fp},this);this.win.show((typeof main!="undefined")&&window.Global.Config.enableAnimate?Ext.getBody():false,function(){this.win.center()},this)},onCreate:function(){},create:function(){this.showWin();this.fp.form.clearData();this.reset();this.fp.form.isValid();this.onCreate();this.beingCreate=true;this.formFocus.defer(500,this)},createObject:function(b,a){this.fp=this.createForm();this.win=this.createWin(b,true);this.win.on("close",function(){delete this.win;delete this.fp},this);this.win.show((typeof main!="undefined")&&Disco_RIA.getCfg("enableAnimate")?Ext.getBody():false,function(){this.win.center()},this);this.reset();if(a){a(this.win,this)}this.fp.form.isValid();this.onCreate();this.beingCreate=true;this.formFocus.defer(500,this)},onEdit:function(a,b){},editObject:function(d,c,a){this.fp=this.createForm();this.beingCreate=true;this.win=this.createWin(c,true);this.win.on("close",function(){delete this.win;delete this.fp},this);this.win.show((typeof main!="undefined")&&Disco_RIA.getCfg("enableAnimate")?Ext.getBody():false,function(){this.win.center()},this);var b=this.viewCmd||"view";Ext.Ajax.request({url:this.baseUrl+"?cmd="+b,params:{id:d},waitMsg:"\u6b63\u5728\u52a0\u8f7d\u6570\u636e,\u8bf7\u7a0d\u4faf...",callback:function(f,h,e){var g=Ext.decode(e.responseText);this.fp.form.setValues(g);if(a){a(this.win,g,this)}this.onEdit(true,g);this.fp.form.isValid();this.formFocus.defer(500,this);this.fp.form.clearDirty()},scope:this})},edit:function(b){if(b&&b.getTarget&&b.getTarget("div.x-grid3-row-checker")){return false}if(this.btn_edit&&this.btn_edit.disabled){this.view();return false}var a=this.grid.getSelectionModel().getSelected();if(!a){this.alert("\u8bf7\u5148\u9009\u62e9\u8981\u64cd\u4f5c\u7684\u6570\u636e\uff01","\u63d0\u793a\u4fe1\u606f");return false}var c=a.get("id");this.beingCreate=false;this.showWin();this.fp.form.reset();this.fp.form.loadRecord(a);this.onEdit(c,a.data);this.fp.form.clearDirty();this.formFocus.defer(500,this);return true},removeObject:function(b,a){this.confirm("\u5220\u9664\u786e\u8ba4","\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f",function(c){Ext.Ajax.request({url:this.baseUrl+"?cmd=remove",params:{id:b},method:"POST",success:function(d){var e=Ext.decode(d.responseText);if(!e.success){Disco_RIA.ajaxErrorHandler(e)}else{this.alert("\u5220\u9664\u6210\u529f","\u63d0\u793a\u4fe1\u606f");if(a){a()}}},scope:this})}.createDelegate(this),this)},formFocus:function(){var a=this.fp.form.items.get(1);if(!a||a.disabled){this.items.each(function(b){if(!b.disabled){a=b;return false}})}if(a&&!a.disabled){a.focus("",100)}},validateForm:function(a){if(!a.isValid()){this.alert("\u8868\u5355\u6570\u636e\u4e0d\u5408\u6cd5,\u8bf7\u6ce8\u610f\u5fc5\u586b\u9879\u53ca\u5f55\u5165\u7684\u6570\u636e\u683c\u5f0f!","\u63d0\u793a",function(){this.formFocus()},this);return false}return true},beforeSave:function(){return true},onSave:function(a,b){},save:function(f,a,c){if(!this.validateForm(this.fp.form)){return false}if(c!==true){if(this.beforeSave&&this.beforeSave()===false){return false}}var e=this.fp.form.findField("id").getValue();var b=this.baseUrl;if(this.fp.form.fileUpload){var d=this.fp.form.findField("cmd");if(d==null){d=new Ext.form.Hidden({name:"cmd"});this.fp.add(d);this.fp.doLayout()}d.setValue((this.beingCreate?"save":(e?"update":"save")))}else{b=this.formatUrl((this.beingCreate?"save":(e?"update":"save")))}Disco.Ext.Util.submitForm(this.fp.form,b,function(g,h){this.fp.form.clearDirty();if(this.closeSaveWin!==false){this.closeWin(a)}if(this.store&&this.closeSaveWin!==false){this.store.reload()}if(f){f()}this.fireEvent("saveobject",this,g,h);this.onSave(g,h)},this)},preview:function(n,m){if(!this.validateForm(this.fp.form)){return false}var c=this.fp.form.findField("id").getValue();var b=this.baseUrl;if(this.fp.form.fileUpload){var e=this.fp.form.findField("cmd");if(e==null){e=new Ext.form.Hidden({name:"cmd"});this.fp.add(e);this.fp.doLayout()}e.setValue("preview")}else{b+="?cmd=preview"}var j=[];var a=this.fp.form.baseParams;if(a&&typeof a=="string"){a=Ext.urlDecode(bp)}var d=this.fp.form.el.dom;function h(i,k){var o=document.createElement("input");o.type="hidden";o.name=i;o.value=k;d.appendChild(o);j.push(o)}for(var f in a){if(Ext.isArray(a[f])){for(var g=0;g<a[f].length;g++){h(f,a[f][g]?a[f][g]:"")}}else{if(a.hasOwnProperty(f)){h(f,a[f]?a[f]:"")}}}this.fp.form.el.dom.action=b;this.fp.form.el.dom.target="_blank";this.fp.form.el.dom.submit();if(j){for(var g=0,l=j.length;g<l;g++){Ext.removeNode(j[g])}}},reset:function(){if(this.win&&this.fp){this.fp.form.reset()}},closeWin:function(a){if(this.beforeClose){this.beforeClose(function(){if(this.win){if(a){this.win.close()}else{this.win.hide()}}if(this.store&&this.closeSaveWin===false){}})}else{if(this.win){if(a){this.win.close()}else{this.win.hide()}}if(this.store&&this.closeSaveWin===false){}}},removeData:function(){if(this.btn_remove.disabled){return false}var b=this.grid.getSelectionModel().getSelected();if(!b){this.alert("\u8bf7\u5148\u9009\u62e9\u8981\u64cd\u4f5c\u7684\u6570\u636e\uff01","\u63d0\u793a\u4fe1\u606f");return false}var e="";if(this.batchRemoveMode){var c=this.grid.getSelectionModel().getSelections();for(var d=0;d<c.length;d++){e+=c[d].get("id")+","}}var a=this.confirm("\u5220\u9664\u786e\u8ba4","\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f",function(f){Ext.Ajax.request({url:this.formatUrl("remove"),params:{id:b.get("id"),mulitId:e},method:"POST",success:function(g,h){var i=Ext.decode(g.responseText);if(i&&!i.success){Disco_RIA.ajaxErrorHandler(i)}else{Ext.Msg.alert("\u63d0\u793a","\u5220\u9664\u6210\u529f",function(){this.store.removeAll();this.store.reload();this.focus()},this)}this.fireEvent("removeobject",this,i,h)},scope:this})}.createDelegate(this),this);return true},executeUrl:Disco.Ext.Util.executeUrl,executeQuietlyUrl:Disco.Ext.Util.executeQuietlyUrl,executeCmd:function(b,a){return function(k){var g=this.grid.getSelectionModel();var d=g.getSelectedCell?(g.getSelectedCell()?this.grid.store.getAt(g.getSelectedCell()[0]):null):g.getSelected();if(!k.noneSelectRow){if(!d&&!a){this.alert("\u8bf7\u5148\u9009\u62e9\u8981\u64cd\u4f5c\u7684\u6570\u636e\uff01");return}}var h="",j=d?d.get("id"):"";if(this.batchRemoveMode){var e=this.grid.getSelectionModel().getSelections();for(var f=0;f<e.length;f++){h+=e[f].get("id")+","}}Ext.Ajax.request({waitMsg:"\u6b63\u5728\u6267\u884c\u64cd\u4f5c\uff0c\u8bf7\u7a0d\u5019...",url:this.formatUrl(b),params:{id:j,mulitId:h},method:"POST",success:function(c){var i=Ext.decode(c.responseText);if(!i.success){Disco_RIA.ajaxErrorHandler(i)}else{Ext.Msg.alert("\u63d0\u793a",i.data?i.data:"\u64cd\u4f5c\u6210\u529f",function(){this.store.reload();this.focus()},this)}},scope:this})}},executeMulitCmd:function(a){return function(){var b=this.grid.getSelectionModel().getSelections();if(!b||b.length<1){this.alert("\u8bf7\u5148\u9009\u62e9\u8981\u64cd\u4f5c\u7684\u6570\u636e\uff01");return}var d=[];for(var c=0;c<b.length;c++){if(b[c].get("id")){d.push(b[c].get("id"))}}Ext.Ajax.request({waitMsg:"\u6b63\u5728\u6267\u884c\u64cd\u4f5c\uff0c\u8bf7\u7a0d\u5019...",url:this.formatUrl(a),params:{mulitId:d.join(",")},method:"POST",success:function(e){var f=Ext.decode(e.responseText);if(!f.success){Disco_RIA.ajaxErrorHandler(f)}else{Ext.Msg.alert("\u63d0\u793a",f.data?f.data:"\u64cd\u4f5c\u6210\u529f",function(){this.store.reload();this.focus()},this)}},scope:this})}},onView:function(){},view:function(){if(this.readInfo){return this.readInfo()}var a=this.grid.getSelectionModel().getSelected();if(!a){this.alert("\u8bf7\u5148\u9009\u62e9\u8981\u64cd\u4f5c\u7684\u6570\u636e\uff01");return false}var g=a.get("id");var d=this.showViewWin();for(var f in a.data){var e=d.getComponent(0).findSomeThing(f);if(e){var b=a.get(f);if(e.isFormField){e.setValue(b);e.clearDirty()}else{if(e.renderer){b=e.renderer(b)}if(e.setText){e.setText(b)}else{if(e.getXType&&e.getXType()=="panel"){e.body.update(b)}}}}}this.onView(d,a.data);return d},viewObject:function(d,c){var a=this.showViewWin(true);var b=this.viewCmd||"view";Ext.Ajax.request({url:this.formatUrl(b),params:{id:d},waitMsg:"\u6b63\u5728\u52a0\u8f7d\u6570\u636e,\u8bf7\u7a0d\u4faf...",callback:function(g,i,f){var h=Ext.decode(f.responseText);for(var k in h){var j=a.getComponent(0).findSomeThing(k);if(j){var e=h[k];if(j.isFormField){j.setValue(e);j.clearDirty()}else{if(j.renderer){e=j.renderer(e)}if(j.setText){j.setText(e)}else{if(j.getXType&&j.getXType()=="panel"){j.body.update(e)}}}}}if(c){c(a,h)}this.onView(a,h)},scope:this})},showViewWin:function(a){if(!this.viewPanel){if(this.createViewPanel){this.viewPanel=this.createViewPanel()}else{if(this.fp){this.viewPanel=this.fp}else{this.viewPanel=this.createForm()}}}var b=this.getViewWin(a);return b},doSearch:function(){var b=Disco.Ext.CrudSearchWindow;var c=b.getComponent(0).form.getValues(false);var a=b.crudService;a.store.baseParams=Ext.apply(c,{searchType:"advancedSearch",pageSize:a.store.baseParams.pageSize||a.pageSize});b.hide();if(a.searchField&&a.cleanQuickSearch){a.searchField.reset()}a.search()},advancedSearch:function(){return this.superSearchWin(this.searchWin.width,this.searchWin.height,this.searchWin.title)},superSearchWin:function(c,b,e){var a=!Disco.Ext.CrudSearchWindow;if(!this.searchPanel){if(this.searchFP||this.searchFormPanel){this.searchPanel=this.searchFP?this.searchFP():this.searchFormPanel()}}if(!this.searchPanel){return null}var d=this.createGlobalWin("CrudSearchWindow",c,b,e,this.searchPanel,null,"searchPanel",[{id:"tb_search",text:"\u67e5\u8be2",handler:this.doSearch,iconCls:"search",scope:this},{text:"\u91cd\u7f6e",iconCls:"clean",handler:function(){Disco.Ext.CrudSearchWindow.getComponent(0).form.reset()}},{text:"\u5173\u95ed",iconCls:"delete",handler:function(){Disco.Ext.CrudSearchWindow.hide()}}]);if(a){}return d},toggleDetails:function(b){var a=this.grid.getView();if(a.showPreview){a.showPreview=false}else{a.showPreview=true}a.refresh()},swapSequence:function(b,a){return function(){var c=this.grid.getSelectionModel().getSelected();if(!c){this.alert("\u8bf7\u5148\u9009\u62e9\u8981\u64cd\u4f5c\u7684\u6570\u636e\uff01","\u63d0\u793a");return}var d=c.get("id");Ext.Ajax.request({url:this.formatUrl("swapSequence"),params:{id:c.get("id"),down:b?b:"",parentId:this.parentId,sq:this.grid.store.find("id",d)+1},method:"POST",success:function(e){var f=Ext.decode(e.responseText);if(!f.success){Disco_RIA.ajaxErrorHandler(f)}else{if(a){Ext.Msg.alert("\u63d0\u793a","\u64cd\u4f5c\u6210\u529f",function(){this.store.reload();this.focus()},this)}else{this.store.reload()}}},scope:this})}},insertGridButton:function(){this.gridButtons.splice(10,0,arguments)},showContextMenu:function(b,a,d){if(this.menu){var c=d?d:b;c.preventDefault();if(a>=0){this.grid.getSelectionModel().selectRow(a,false)}this.menu.showAt(c.getPoint())}},doOperate:function(b,i,c,g){var a=g.getTarget("A",3);if(a){var h=a.getAttribute("theid");var f=a.getAttribute("op");var d=a.getAttribute("cf");if(h&&f){this.operate(f,h,d,b,i,c,g)}}},operate:function(d,h,c,a,g,b,f){if(d=="edit"){this.edit()}else{if(d=="view"){this.view()}else{if(d=="remove"){this.removeData()}else{if(!c){this.executeUrl(this.baseUrl,{cmd:d,id:h},this.refresh.createDelegate(this))()}else{Ext.Msg.confirm("\u63d0\u793a","\u786e\u8ba4\u8981\u6267\u884c\u8be5\u64cd\u4f5c\u5417?",function(e){if(e=="yes"){this.executeUrl(this.baseUrl,{cmd:d,id:h},this.refresh.createDelegate(this))()}else{this.focus()}},this)}}}}},findOperatorBy:function(b){var a=[];this.operators.each(function(c){if(typeof c!="string"){if(b&&b(c)){a.push(c)}}});return a},findOperatorByProperty:function(a,b){return this.findOperatorBy(function(c){if(c[a]==b){return true}})},toggleSingleRowOperator:function(b){var d=this.findOperatorByProperty("singleRow",true);var a=[];if(d&&d.length){for(var c=0;c<d.length;c++){a.push(d[c].name||d[c].id)}}if(b){this.enableOperaterItem(a)}else{this.disableOperaterItem(a)}},toggleAllOperator:function(b){var a=[];this.operators.each(function(c){if(typeof c!="string"){a.push(c.name||c.id)}});if(b){this.enableOperaterItem(a)}else{this.disableOperaterItem(a)}},onRowSelection:function(a,c,f){var f=this.grid.getSelections();var e=this.findOperatorByProperty("batch",true);var d=true;if(f.length==1){this.toggleSingleRowOperator(true)}else{if(f.length>1){this.toggleSingleRowOperator(false)}else{d=false;this.toggleSingleRowOperator(false)}}var b=[];if(e&&e.length){Ext.each(e,function(g){b.push(g.name||g.id)})}this[(d?"enable":"disable")+"OperaterItem"](b)},changeOperaterItem:function(a,d){if(a.length==1&&Ext.isArray(a[0])){a=a[0]}if(this.grid.getTopToolbar()&&this.grid.getTopToolbar().items){for(var b=0;b<a.length;b++){if(this.menu&&this.menu.items){var c=this.menu.items.find(function(f){var e=f.name||f.id;if(e==a[b]){return true}});if(c){d(c)}}c=this.grid.getTopToolbar().items.find(function(f){var e=f.name||f.id;if(e==a[b]){return true}});if(c){d(c)}}}else{this.grid.on("render",function(){for(var e=0;e<a.length;e++){var f=this.grid.getTopToolbar().items.find(function(h){var g=h.name||h.id;if(g==a[e]){return true}});if(f){d(f)}}},this)}},enableOperaterItem:function(){var a=arguments;this.changeOperaterItem(a,function(b){if(b.enable){b.enable()}})},disableOperaterItem:function(){var a=arguments;this.changeOperaterItem(a,function(b){if(b.disable){b.disable()}})},showOperaterItem:function(){var a=arguments;this.changeOperaterItem(a,function(b){if(b.show){b.show()}})},hideOperaterItem:function(){var a=arguments;this.changeOperaterItem(a,function(b){if(b.hide){b.hide()}})},operatorConfig2Component:function(c,d){var b=Ext.apply({},c);if(!b.handler){if(b.method&&this[b.method]){b.handler=this[b.method]}else{if(b.cmd){b.handler=b.batch?this.executeMulitCmd(b.cmd):this.executeCmd(b.cmd)}}}if(b.handler&&!b.scope){b.scope=this}if(!d){if(this.operatorButtonStyle==2){if(b.icon){b.cls="x-btn-icon";b.text=""}}else{if(this.operatorButtonStyle==3){b.icon="";b.cls=""}}}var a=b.name||b.id;if(a=="searchField"){b.store=this.store}else{if(a=="btn_advancedSearch"){b.hidden=!((this.searchFormPanel||this.searchFP)&&this.allowSearch)}else{if(a=="btn_remove"){c.batch=this.batchRemoveMode}}}return b},buildCrudOperator:function(){if(!this.operators){this.initOperator()}var b=[];this.operators.each(function(h){if(typeof h=="string"){b.push(h)}else{if(!h.showInMenuOnly){var g=this.operatorConfig2Component(h);var d=g.name||g.id;try{if(Ext.isString(g.type)){this[d]=Ext.create(g,g.type)}else{this[d]=new Ext.Toolbar.Button(g)}b.push(this[d])}catch(f){alert(d+":"+f)}}}},this);if(!this.menu){var a=[];this.operators.each(function(e){if(typeof e=="string"){if(e=="-"){a.push(e)}}else{if(!e.showInToolbarOnly){var d=this.operatorConfig2Component(e,true);if(!d.type){a.push(d)}}}},this);a.push({name:"btn_help",text:"\u5e2e\u52a9",handler:this.help,scope:this});this.menu=new Ext.menu.Menu({items:a})}return b},initOperator:function(){this.initDisableOperators();this.operators=new Ext.util.MixedCollection(false);this.operators.getKey=function(e){return e.id||e.name};for(var c=0;c<this.crud_operators.length;c++){var d=this.crud_operators[c];if(typeof d=="object"){d=Ext.apply({},d);if(!d.batch&&!d.noneSelectRow){d.singleRow=true}}var b=d.name||d.id;if(b&&this.disable_operators.indexOf(b)>=0){continue}this.operators.add(d)}if(this.customizeQueryObject){this.operators.add({showInToolbarOnly:true,name:"btn_customizeQuery",cls:"x-btn-icon",icon:"images/icon-png/srsearch.gif",tooltip:"\u81ea\u5b9a\u4e49\u67e5\u8be2",text:"",menu:["-",{text:"\u4fdd\u5b58\u5f53\u524d\u67e5\u8be2\u6761\u4ef6",handler:this.createQueryObject,scope:this},{text:"\u7ba1\u7406\u81ea\u5b9a\u4e49\u67e5\u8be2",handler:this.manageQueryObject,scope:this}]})}if(this.gridButtons){var a=(this.disable_operators.indexOf("searchField")>=0?this.operators.getCount()-1:this.operators.getCount()-2);this.insertOperator(a,this.gridButtons)}},insertOperator:function(b,a){if(!this.operators){this.initOperator()}if(!Ext.isArray(a)){a=[a]}if(this.operators.getCount()<b){b=this.operators.getCount()}var g=this.grid&&this.grid.getTopToolbar&&this.grid.getTopToolbar()&&this.grid.getTopToolbar().items;for(var c=0;c<a.length;c++){var f=a[c];if(typeof f=="object"){f=Ext.apply({},f);if(!f.batch&&!f.noneSelectRow){f.singleRow=true}}this.operators.insert(b+c,f);if(g){if(!f.showInMenuOnly){var e=this.operatorConfig2Component(Ext.apply({},f));this.grid.getTopToolbar().insert(b+c,e)}if(!f.showInToolbarOnly){var d=this.operatorConfig2Component(f,true);if(this.menu){this.menu.insert(b+c,new Ext.menu.Item(d))}}}}},initDisableOperators:function(){if(!this.disable_operators){this.disable_operators=[]}if(!this.exportData){this.disable_operators.push("btn_export")}if(!this.importData){this.disable_operators.push("btn_import")}if(!this.printData){this.disable_operators.push("btn_print")}if(!this.clearData){this.disable_operators.push("btn_clearSearch")}if(!this.allowSearch){this.disable_operators.push("btn_advancedSearch")}if(!this.showAdd){this.disable_operators.push("btn_add")}if(!this.showEdit){this.disable_operators.push("btn_edit")}if(!this.showRemove){this.disable_operators.push("btn_remove")}if(!this.showView){this.disable_operators.push("btn_view")}if(!this.showRefresh){this.disable_operators.push("btn_refresh")}if(!this.showSearchField){this.disable_operators.push("searchField")}},manageQueryObject:function(){var a=new UserQueryObjectWin({crudService:this,objName:this.queryObjectName});a.show()},createQueryObject:function(){if(!this.searchQueryObjectPanel){if(this.searchFP||this.searchFormPanel){this.searchQueryObjectPanel=this.searchFP?this.searchFP():this.searchFormPanel();this.searchQueryObjectPanel.insert(0,{fieldLabel:"\u67e5\u8be2\u5668\u540d\u79f0",xtype:"textfield",name:"queryObjectName",anchor:"-20",allowBlank:false});this.searchQueryObjectPanel.insert(1,{fieldLabel:"\u5173\u952e\u5b57",xtype:"textfield",name:"searchKey",anchor:"-20"})}}if(!this.searchQueryObjectPanel){return null}var a=this.createGlobalWin("CrudQueryObjectWindow",this.searchWin.width,this.searchWin.height+60,"\u4fdd\u5b58\u67e5\u8be2\u6761\u4ef6",this.searchQueryObjectPanel,null,"searchQueryObjectPanel",[{id:"tb_search",text:"\u4fdd\u5b58",handler:this.saveQueryObject,iconCls:"search"},{text:"\u53d6\u6d88",iconCls:"delete",handler:function(){Disco.Ext.CrudQueryObjectWindow.hide()}}]);a.getComponent(0).form.setValues(this.store.baseParams||{});a.getComponent(0).form.findField("queryObjectName").setValue("")},saveQueryObject:function(){var b=Disco.Ext.CrudQueryObjectWindow;if(!b.getComponent(0).form.isValid()){Ext.Msg.alert("\u63d0\u793a","\u5fc5\u586b\u9879\u5fc5\u987b\u586b\u5199!");return}var e=b.getComponent(0).form.getValues(false);var d=e.queryObjectName;delete e.queryObjectName;var a=b.crudService;var c={title:d,content:Ext.urlEncode(e),objName:a.queryObjectName};Ext.Ajax.request({url:"userQueryObject.java?cmd=save",params:c,success:function(f){var g=Ext.decode(f.responseText);if(g.success){this.addQueryObjectOperator([c]);Ext.Msg.alert("\u63d0\u793a","\u64cd\u4f5c\u6210\u529f!",this.focus,this);b.hide()}else{Ext.Msg.alert("\u65e0\u6cd5\u4fdd\u5b58",g.errors.msg,function(){b.getComponent(0).form.findField("searchKey").focus()})}},scope:a})},searchByQueryObject:function(b){if(b.content){var a=Ext.urlDecode(b.content);if(this.searchField){this.searchField.setValue(a.searchField||"")}this.store.baseParams=a;if(this.store.lastOptions&&this.store.lastOptions.params){this.store.lastOptions.params.start=0}}this.refresh()},addQueryObjectOperator:function(e){if(e&&e.length){var d=this.operators.find(function(h){var g=h.name||h.id;if(g=="btn_customizeQuery"){return true}});if(!d){return}var f=this.grid&&this.grid.getTopToolbar&&this.grid.getTopToolbar()&&this.grid.getTopToolbar().items;var a=this["btn_customizeQuery"];for(var b=0;b<e.length;b++){var c=e[b];c.scope=this;c.text=c.title;c.name="query_menu"+c.title;c.handler=this.searchByQueryObject;d.menu.splice(0,0,c);if(a){a.menu.insert(0,new Ext.menu.Item(c))}}}},removeQueryObjectOperator:function(b){var a=this["btn_customizeQuery"];if(a){var c=a.menu.items.find(function(e){var d=e.name||e.id;if(d=="query_menu"+b){return true}});if(c){a.menu.remove(c)}}},useOperatorsPermission:function(b){var a=b||this.permissions;var b=[];for(var c=0;c<a.length;c++){b.push(a[c]);var d=this.operators.find(function(f){var e=f.name||f.id;if(e==b[c]){return true}});if(d){d.hidden=false}}this.showOperaterItem(b);this.fireEvent("usepermission",this)},loadOperatorsPermission:function(){var b={},d=[],f=[],a=[];var c=this.baseUrl;this.operators.each(function(g){if(typeof g!="string"){if(!g.clientOperator&&(g.cmd||g.method)){f.push(g.action||c);a.push(g.cmd||g.method||"");d.push(g.name||g.id||"")}}});if(!this.permissions){var e={names:d,actions:f,cmds:a};if(this.customizeQueryObject&&this.queryObjectName){e.queryObjectName=this.queryObjectName}if(Disco_RIA.permissionCheck){Ext.Ajax.request({url:(Disco_RIA.permissionCheckAction||"/permissionCheck.java"),params:e,callback:function(i,j,g){var h=Ext.decode(g.responseText);if(h&&h.permissions&&h.permissions.length){this.permissions=h.permissions;this.useOperatorsPermission()}if(h&&h.queryObjects){this.addQueryObjectOperator(h.queryObjects)}},scope:this})}else{this.permissions=["btn_add","btn_edit","btn_view","btn_remove","btn_refresh"];this.useOperatorsPermission()}}else{this.useOperatorsPermission()}},checkAdnLoadColumnField:function(){if(!this.storeMapping){var f=this.baseUrl+"?cmd=loadColumnField";if(this.entityClzName){f="/extApp.java?cmd=loadColumnField&entityClzName="+this.entityClzName}var g=Ext.lib.Ajax.syncRequest("POST",f,"");var b=Ext.decode(g.conn.responseText);if(b&&b.fields){this.storeMapping=b.fields;if(b.columnMap&&!this.columns&&!this.cm){this.columns=[];for(var a in b.columnMap){var j=b.columnMap[a];j.dataIndex=j.name;if(!j.header){j.header=j.name}var i=[];if(this.autoDisplayFields&&this.autoDisplayFields.indexOf(j.name)<0){j.hidden=true}if(this.autoHideFields&&this.autoHideFields.indexOf(j.name)>=0){j.hidden=true}if(this.disableHideableFields&&this.disableHideableFields.indexOf(j.name)>=0){j.hideable=false}if(j.sortable===undefined){if(j.type!="object"){j.sortable=true}}if(!j.renderer){if(j.type=="date"){j.renderer=this.dateRender("Y-m-d")}else{if(j.type=="object"||j.type=="map"){j.renderer=this.objectAutoRender}}}else{try{j.renderer=Ext.decode(j.renderer)}catch(h){}}this.columns.push(j)}}}}},haveOperatorRights:function(a){return this[a]&&(!(this[a].disabled||this[a].hidden))},handleCrudKey:function(a){if(!(a.isSpecialKey()||a.altKey||a.getKey()==a.DELETE)){return}if(a.getKey()==Ext.EventObject.ENTER&&!a.ctrlKey){a.stopEvent();this.edit()}else{if(a.altKey&&a.getKey()=="c".charCodeAt(0)&&this.haveOperatorRights("btn_edit")&&this.copy){a.stopEvent();this.copy()}else{if(a.altKey&&a.getKey()=="a".charCodeAt(0)&&this.haveOperatorRights("btn_add")){a.stopEvent();this.create()}else{if(a.altKey&&a.getKey()=="e".charCodeAt(0)&&this.haveOperatorRights("btn_edit")){a.stopEvent();this.edit()}else{if(a.altKey&&a.getKey()=="v".charCodeAt(0)&&this.haveOperatorRights("btn_view")){a.stopEvent();this.view()}else{if((a.getKey()==a.DELETE||(a.altKey&&a.getKey()=="d".charCodeAt(0)))&&this.haveOperatorRights("btn_remove")){a.stopEvent();this.removeData()}else{if(a.altKey&&a.getKey()=="s".charCodeAt(0)){a.stopEvent();this.advancedSearch()}else{if((a.getKey()==a.PRINT_SCREEN||(a.altKey&&a.getKey()=="p".charCodeAt(0)))&&this.haveOperatorRights("btn_print")){a.stopEvent();this.printRecord()}else{if(a.altKey&&a.getKey()=="o".charCodeAt(0)&&this.haveOperatorRights("btn_export")){a.stopEvent();this.exportExcel()}else{if(a.altKey&&a.getKey()=="i".charCodeAt(0)&&this.haveOperatorRights("btn_import")){a.stopEvent();this.importExcel()}}}}}}}}}}},initCrudEventHandler:function(){this.grid.on("celldblclick",this.edit,this);this.grid.on("cellclick",this.doOperate,this);this.grid.on("keypress",this.handleCrudKey,this);var a=function(d,b,c){this.onRowSelection(c,b,d)};this.grid.getSelectionModel().on({scope:this,rowselect:a,rowdeselect:a});if(this.showMenu){this.grid.on("rowcontextmenu",this.showContextMenu,this)}Disco.Ext.Util.autoFocusFirstRow(this.grid)},focus:function(){this.focusCrudGrid()},focusCrudGrid:function(a){var b=a||this.grid;if(b&&b.rendered){var c=b.getSelectionModel();if(c&&c.hasSelection()){b.getView().focusRow(b.store.indexOf(b.getSelectionModel().getSelected()))}else{if(b.store.getCount()){b.getView().focusRow(0)}else{b.focus()}}}},help:function(){Ext.Msg.show({title:"\u7cfb\u7edf\u5e2e\u52a9",buttons:Ext.Msg.OK,icon:Ext.Msg.INFO,msg:"\u6b22\u8fce\u4f7f\u7528\u672c\u7cfb\u7edf!"})}};Disco.Ext.CrudPanel=Ext.extend(Ext.Panel,{border:false,layout:"fit",closable:true,autoScroll:false,gridForceFit:true,importExplain:"",viewWin:{width:650,height:410,title:"\u8be6\u60c5\u67e5\u770b"},searchWin:{width:630,height:300,title:"\u9ad8\u7ea7\u67e5\u8be2"},gridViewConfig:{},gridConfig:{},baseQueryParameter:{},localStoreVar:window.undefined,bulidGridStore:function(){var b=this.defaultsActions?this.defaultsActions.list:"list";var a={id:this.storeId?this.storeId:"id",url:this.defaultCmd?(this.formatUrl(b)):this.baseUrl,root:"result",autoDestroy:true,totalProperty:"rowCount",pageSize:this.pageSize,remoteSort:true,fields:this.storeMapping};if(Ext.isEmpty(this.localStoreVar,false)){this.store=new Ext.data.JsonStore(a)}else{this.store=new Disco.Ext.CachedRemoteStore(Ext.apply({varName:this.localStoreVar,pageSize:Ext.num(this.pageSize,20)},a))}this.store.baseParams=Ext.apply({},{limit:this.pageSize||""},this.initQueryParameter||{});if(Ext.objPcount(this.baseQueryParameter)){this.store.on("beforeload",function(c,d){Ext.apply(c.baseParams,this.baseQueryParameter)},this)}this.store.paramNames.sort="orderBy";this.store.paramNames.dir="orderType";return this.store},initComponent:function(){this.checkAdnLoadColumnField();this.store=this.bulidGridStore();this.addEvents("saveobject","removeobject");Disco.Ext.CrudPanel.superclass.initComponent.call(this);var d=this.buildCrudOperator();var c=Ext.apply({forceFit:this.gridForceFit},this.gridViewConfig);var e=Ext.apply(this.gridConfig,{store:this.store,stripeRows:true,trackMouseOver:false,loadMask:true,viewConfig:c,border:false,bbar:this.gridBbar||(this.pagingToolbar?new Ext.ux.PagingComBo({rowComboSelect:true,pageSize:this.pageSize,store:this.store,displayInfo:true}):null)});if(this.showTbar){e.tbar=d}if(this.summaryGrid){if(e.plugins){if(typeof e.plugins=="object"){e.plugins=[e.plugins]}}else{e.plugins=[]}e.plugins[e.plugins.length]=new Ext.ux.grid.GridSummary()}var b=this.columns,a={};b=b||this.cm.config;delete e.cm;b=[].concat(b);if(this.gridRowNumberer){b.unshift(new Ext.grid.RowNumberer({header:"\u5e8f\u53f7",width:36}))}if((!e.sm&&!e.selModel)&&this.gridSelModel=="checkbox"){a.sm=new Ext.grid.CheckboxSelectionModel();if(b[0] instanceof Ext.grid.RowNumberer){b.splice(1,0,a.sm)}else{b.unshift(a.sm)}}a.columns=b;e=Ext.applyIf(a,e);if(this.columnLock&&Ext.grid.LockingGridPanel){this.grid=new Ext.grid.LockingGridPanel(e)}else{this.grid=new Ext.grid.GridPanel(e)}this.loadOperatorsPermission();this.initCrudEventHandler();this.add(this.grid);if(this.autoLoadGridData){this.store.load()}}});Ext.applyIf(Disco.Ext.CrudPanel.prototype,Disco.Ext.CrudFunction);ExtAppBasePanel=Ext.extend(Ext.Panel,{appClass:"",script:"",otherScripts:"",border:false,layout:"fit",closable:true,initComponent:function(){ExtAppBasePanel.superclass.initComponent.call(this);this.on("resize",function(b){if(!b.framePanel){var a="<iframe width='100%' height='"+b.body.getHeight(true)+"px' frameborder='0' scrolling='auto' src='/extApp.java?appClass="+this.appClass+"&script="+this.script+"&otherScripts="+this.otherScripts+"&params="+this.params+"'></iframe>";b.body.update(a);b.framePanel=b.body.dom.firstChild}else{b.framePanel.height=b.body.getHeight(true)}},this)}});Disco.Ext.TreeComboField=Ext.extend(Ext.form.TriggerField,{valueField:"id",displayField:"name",minListWidth:70,haveShow:false,editable:false,returnObject:false,leafOnly:false,clicksFinishEdit:1,readOnly:false,hiddenNodes:[],initEvents:function(){Disco.Ext.TreeComboField.superclass.initEvents.call(this);this.keyNav=new Ext.KeyNav(this.el,{up:function(a){this.inKeyMode=true;this.selectPrevious()},down:function(a){if(!this.isExpanded()){this.onTriggerClick()}else{this.inKeyMode=true;this.selectNext()}},enter:function(b){var c=this.tree.getSelectionModel();if(c.getSelectedNode()){var a=c.getSelectedNode();this.choice(a);c.clearSelections();return}},esc:function(a){this.collapse()},scope:this});this.queryDelay=Math.max(this.queryDelay||10,this.mode=="local"?10:250);this.dqTask=new Ext.util.DelayedTask(this.initQuery,this);if(this.typeAhead){this.taTask=new Ext.util.DelayedTask(this.onTypeAhead,this)}if(this.editable!==false){this.el.on("keyup",this.onKeyUp,this)}if(this.forceSelection){this.on("blur",this.doForce,this)}},selectPrevious:function(){var b=this.tree.getSelectionModel();if(!b.selectPrevious()){var a=this.tree.getRootNode();b.select(a);this.el.focus()}else{this.el.focus()}},selectNext:function(){var b=this.tree.getSelectionModel();if(!b.selectNext()){var a=this.tree.getRootNode();b.select(a);this.el.focus()}else{this.el.focus()}},onTriggerClick:function(){if(this.readOnly||this.disabled){return false}else{if(!this.tree.rendered||!this.list){this.treeId=Ext.id();this.list=new Ext.Layer({id:this.treeId,cls:"x-combo-list",constrain:false});if(!this.innerDom){this.innerDom=Ext.getBody().dom}if(this.tree.rendered){this.list.appendChild(this.tree.el)}else{this.tree.render(this.treeId);var a=this.listWidth||Math.max(this.wrap.getWidth(),this.minListWidth);this.tree.setWidth(a);this.tree.on("expandnode",this.restrictHeight,this);this.tree.on("collapsenode",this.restrictHeight,this)}}else{this.restrictHeight()}}this.expand()},restrictHeight:function(){if(!this.list){return}var a=this.innerDom;var b=a.clientHeight-this.wrap.getBottom();if(this.tree.el.dom.offsetHeight>=b){this.tree.setHeight(b)}else{this.tree.setHeight("auto")}},filterTree:function(a){if(!this.isExpanded()){this.expand()}var b=a.target.value;Ext.each(this.hiddenNodes,function(c){c.ui.show()});if(!b){this.filter.clear();return}this.tree.expandAll();this.restrictHeight();this.filter.filterBy(function(c){return(!c.attributes.leaf||c.text.indexOf(b)>=0)});this.hiddenNodes=[];this.tree.root.cascade(function(c){if(!c.attributes.leaf&&c.ui.ctNode.offsetHeight<3){c.ui.hide();this.hiddenNodes.push(c)}},this)},expand:function(){if(this.list){Ext.getDoc().on("mousedown",this.hideIf,this);this.list.show();this.list.alignTo(this.getEl(),"tl-bl?")}else{this.onTriggerClick()}},collapse:function(){if(this.list){this.list.hide();Ext.getDoc().un("mousedown",this.hideIf,this)}},onEnable:function(){Disco.Ext.TreeComboField.superclass.onEnable.apply(this,arguments);if(this.hiddenField){this.hiddenField.disabled=false}},onDisable:function(){Disco.Ext.TreeComboField.superclass.onDisable.apply(this,arguments);if(this.hiddenField){this.hiddenField.disabled=true}Ext.getDoc().un("mousedown",this.hideIf,this)},hideIf:function(a){if(!a.within(this.wrap)&&!a.within(this.list)){this.collapse()}},initComponent:function(){Disco.Ext.TreeComboField.superclass.initComponent.call(this);this.addEvents("beforeSetValue");this.filter=new Ext.tree.TreeFilter(this.tree,{clearBlank:true,autoClear:true})},onRender:function(b,a){Disco.Ext.TreeComboField.superclass.onRender.call(this,b,a);if(this.clicksFinishEdit>1){this.tree.on("dblclick",this.choice,this)}else{this.tree.on("click",this.choice,this)}if(this.hiddenName){this.hiddenField=this.el.insertSibling({tag:"input",type:"hidden",name:this.hiddenName,id:(this.hiddenId||this.hiddenName)},"before",true);this.hiddenField.value=this.hiddenValue!==undefined?this.hiddenValue:this.value!==undefined?this.value:"";this.el.dom.removeAttribute("name")}if(!this.editable){this.editable=true;this.setEditable(false)}else{this.el.on("keydown",this.filterTree,this,{buffer:350})}},getValue:function(a){if((a===true)||this.returnObject){return typeof this.value!="undefined"?{value:this.value,text:this.text,toString:function(){return this.text}}:""}return typeof this.value!="undefined"?this.value:""},clearValue:function(){if(this.hiddenField){this.hiddenField.value=""}this.setRawValue("");this.lastSelectionText="";this.applyEmptyText();this.value=""},validate:function(){if(this.disabled||this.validateValue(this.processValue(this.getValue()))){this.clearInvalid();return true}return false},isValid:function(a){if(this.disabled){return true}var c=this.preventMark;this.preventMark=a===true;var b=this.validateValue(this.processValue(this.getValue()));this.preventMark=c;return b},validateValue:function(a){if(a.length<1||a===null){if(this.allowBlank){this.clearInvalid();return true}else{this.markInvalid(this.blankText);return false}}if(a.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));return false}if(a.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));return false}if(this.vtype){var c=Ext.form.VTypes;if(!c[this.vtype](a,this)){this.markInvalid(this.vtypeText||c[this.vtype+"Text"]);return false}}if(typeof this.validator=="function"){var b=this.validator(a);if(b!==true){this.markInvalid(b);return false}}if(this.regex&&!this.regex.test(a)){this.markInvalid(this.regexText);return false}return true},readPropertyValue:function(c,b){var a=null;for(var d in c){if(d==b){return true}}return a},setValue:function(d){if(!d){this.clearValue();return}if(this.fireEvent("beforeSetValue",this,d)===false){return}var a=d;var e=a;var c=this.valueField||this.displayField;if(typeof a=="object"&&this.readPropertyValue(d,c)){e=d[this.displayField||this.valueField];a=d[c]}var b=this.tree.getNodeById(a);if(b){e=b.text}else{if(this.valueNotFoundText!==undefined){e=this.valueNotFoundText}}this.lastSelectionText=e;if(this.hiddenField){this.hiddenField.value=a}Disco.Ext.TreeComboField.superclass.setValue.call(this,e);this.value=a;this.text=e},setEditable:function(a){if(a==this.editable){return}this.editable=a;if(!a){this.el.dom.setAttribute("readOnly",true);this.el.on("mousedown",this.onTriggerClick,this);this.el.addClass("x-combo-noedit")}else{this.el.dom.setAttribute("readOnly",false);this.el.un("mousedown",this.onTriggerClick,this);this.el.removeClass("x-combo-noedit")}},choice:function(b,a){if((!this.leafOnly||b.isLeaf())){if(b.id!="root"){this.setValue(b.id)}else{this.clearValue();this.el.dom.value=b.text}this.fireEvent("select",this,b);this.collapse();this.fireEvent("collapse",this)}else{if(b.id=="root"){this.clearValue();this.el.dom.value=b.text;this.fireEvent("select",this,b);this.collapse();this.fireEvent("collapse",this)}}},validateBlur:function(){return !this.list||!this.list.isVisible()},isExpanded:function(){return this.list&&this.list.isVisible()},canFocus:function(){return !this.disabled},onDestroy:function(){if(this.tree.rendered&&this.list){this.list.hide();this.list.destroy();delete this.list}Disco.Ext.TreeComboField.superclass.onDestroy.call(this)}});Ext.reg("treecombo",Disco.Ext.TreeComboField);Disco.Ext.CheckTreeComboField=Ext.extend(Disco.Ext.TreeComboField,{leafOnly:false,editable:true,onTriggerClick:function(){if(this.disabled){return}if(!this.listPanel.rendered||!this.list){this.treeId=Ext.id();this.list=new Ext.Layer({id:this.treeId,cls:"x-combo-list",constrain:false});if(!this.innerDom){this.innerDom=Ext.getBody().dom}if(this.listPanel.rendered){this.list.appendChild(this.listPanel.el)}else{this.listPanel.render(this.treeId);var a=this.listWidth||Math.max(this.wrap.getWidth(),this.minListWidth);this.listPanel.setWidth(a);this.tree.on("expandnode",this.restrictHeight,this);this.tree.on("collapsenode",this.restrictHeight,this)}if(this.value){this.setCheckdNode(this.value)}}else{this.restrictHeight()}this.expand()},restrictHeight:function(){if(!this.list){return}var a=this.innerDom;var b=a.clientHeight-this.wrap.getBottom();if(this.listPanel.el.dom.offsetHeight>=b){this.listPanel.setHeight(b)}else{this.listPanel.setHeight("auto");this.tree.setHeight("auto")}},initComponent:function(){Disco.Ext.CheckTreeComboField.superclass.initComponent.call(this);this.listPanel=new Ext.Panel({border:false,bodyBorder:false,buttonAlign:"center",layout:"fit",items:this.tree,bbar:[{text:"\u786e\u5b9a\u9009\u62e9",handler:this.choice,scope:this},{text:"\u6e05\u7a7a",handler:this.cleanChoice,scope:this},{text:"\u53d6\u6d88",handler:this.cancelChoice,scope:this}]})},onRender:function(b,a){Disco.Ext.CheckTreeComboField.superclass.onRender.call(this,b,a);this.tree.on("checkchange",this.checkNode,this)},setCheckdNode:function(a){this.cleanCheckNode(this.tree.root);var e=a.split(",");for(var c=0;c<e.length;c++){var d=null;var b=this.valueField;this.tree.root.cascade(function(f){if(f.attributes[b]==e[c]){d=f;return false}});if(d){this.checkNode(d,true)}}},cleanCheckNode:function(b){var a=false;b.cascade(function(c){if(c.ui.checkbox){c.attributes.checked=c.ui.checkbox.checked=a;c.attributes.selectAll=a;if(a){c.ui.addClass("x-tree-selected")}else{c.ui.removeClass("x-tree-selected")}}},this)},checkNode:function(b,a){b.cascade(function(c){if(c.ui.checkbox){c.attributes.checked=c.ui.checkbox.checked=a;c.attributes.selectAll=a;if(a){c.ui.addClass("x-tree-selected")}else{c.ui.removeClass("x-tree-selected")}}},this);b.bubble(function(c){if(c!=b){if(!a){c.attributes.selectAll=a;if(c.attributes.checked){c.ui.removeClass("x-tree-selected")}}else{if(!c.attributes.checked){c.attributes.checked=c.ui.checkbox.checked=a}}}})},getValue:function(){return typeof this.value!="undefined"?this.value:""},clearValue:function(){if(this.hiddenField){this.hiddenField.value=""}this.setRawValue("");this.lastSelectionText="";this.applyEmptyText();if(this.list){this.cleanCheckNode(this.tree.root)}},getNodeValue:function(a){if(a.attributes.selectAll&&(!this.leafOnly||a.attributes.leaf)){if(this.t!=""){this.t+=","}if(this.v!=""){this.v+=","}var c=a.attributes[this.displayField||this.valueField];if(c===undefined){c=a.text}var b=a.attributes[this.valueField];if(b===undefined){b=a.id}this.t+=c;this.v+=b}else{if(a.attributes.checked){a.eachChild(this.getNodeValue,this)}}},setValue:function(d){if(!d){this.clearValue();return}var b=d;var e=b;var c=this.valueField||this.displayField;if(typeof b=="object"&&this.readPropertyValue(d,c)){e=d[this.displayField||this.valueField];b=d[c];if(this.list){this.setCheckdNode(b)}}else{var a=this.tree.root;this.t="";this.v="";if(a.attributes.selectAll){this.t=a.text}else{a.eachChild(this.getNodeValue,this)}e=this.t;b=this.v}this.lastSelectionText=e;if(this.hiddenField){this.hiddenField.value=b}Disco.Ext.TreeComboField.superclass.setValue.call(this,e);this.value=b;this.text=e},choice:function(a){if(a){this.setValue(true)}else{this.clearValue()}this.list.hide()},cleanChoice:function(){this.clearValue();this.list.hide()},cancelChoice:function(){this.list.hide()},onDestroy:function(){if(this.listPanel.rendered&&this.list){this.list.hide();this.list.remove()}Disco.Ext.CheckTreeComboField.superclass.onDestroy.call(this)}});Ext.reg("checktreecombo",Disco.Ext.CheckTreeComboField);Disco.Ext.SmartCombox=Ext.extend(Ext.form.ComboBox,{returnObject:false,objectCreator:null,createWinReady:function(a){if(this.fieldLabel){a.setTitle("\u65b0\u5efa"+this.fieldLabel)}},newObject:function(){this.collapse();var a=this.fieldLabel;Disco.Ext.Util.addObject(this.objectCreator.appClass,this.reload.createDelegate(this),this.objectCreator.script,this.objectCreator.otherScripts,this.createWinReady.createDelegate(this))},synchObject:function(){this.store.reload()},initComponent:function(){if(this.objectCreator&&!this.disableCreateObject){this.operatorButtons=[{text:"\u65b0\u5efa",iconCls:"add",handler:this.newObject,scope:this},{text:"\u540c\u6b65",iconCls:"f5",handler:this.synchObject,scope:this}]}Disco.Ext.SmartCombox.superclass.initComponent.call(this)},initList:function(){if(!this.list){Disco.Ext.SmartCombox.superclass.initList.call(this);if(this.operatorButtons){if(this.pageTb){this.pageTb.insert(0,this.operatorButtons)}else{this.bottomBar=this.list.createChild({cls:"x-combo-list-ft"});this.bottomToolbar=new Ext.Toolbar(this.operatorButtons);this.bottomToolbar.render(this.bottomBar);this.assetHeight+=this.bottomBar.getHeight()}}}},getValueObject:function(c){var d="";if(this.returnObject){d=this.getValue().value}else{d=this.getValue()}if(d){var b=this.store.find(c||"id",d);if(b>=0){var a=this.store.getAt(b);return a}return null}return null},getValue:function(){if(this.returnObject){var c=this.value;if(this.el.dom.value==this.PleaseSelectedValue||this.el.dom.value==this.nullText){return null}if(this.selectedIndex>=0){var a=this.store.getAt(this.selectedIndex);if(a&&a.data){var b=a.data[this.displayField||this.valueField];if(b!=this.el.dom.value){c=null}}}return{value:c,text:this.el.dom.value,toString:function(){return this.text}}}else{return Disco.Ext.SmartCombox.superclass.getValue.call(this)}},setValue:function(v){if(v&&typeof v=="object"&&eval("v."+this.valueField)){var value=eval("v."+this.valueField);var text=eval("v."+this.displayField)?eval("v."+this.displayField):this.valueNotFoundText;this.lastSelectionText=text;if(this.hiddenField){this.hiddenField.value=value}Ext.form.ComboBox.superclass.setValue.call(this,text);this.value=value;if(this.store.find(this.valueField,value)<0){var o={};o[this.valueField]=value;o[this.displayField]=text;if(this.store&&this.store.insert){this.store.insert(0,new Ext.data.Record(o))}}}else{if(v===null){Disco.Ext.SmartCombox.superclass.setValue.call(this,"")}else{Disco.Ext.SmartCombox.superclass.setValue.call(this,v)}}},onSelect:function(a,b){if(this.fireEvent("beforeselect",this,a,b)!==false){this.setValue(a.data[this.valueField||this.displayField]);this.collapse();this.fireEvent("select",this,a,b)}}});Ext.reg("smartcombo",Disco.Ext.SmartCombox);Disco.Ext.PopupWindowField=Ext.extend(Ext.form.TriggerField,{win:null,valueField:"id",displayField:"name",haveShow:false,editable:false,callback:Ext.emptyFn,returnObject:false,choiceOnly:false,getValue:function(){if(this.choiceOnly){return this.value}if(this.returnObject){return typeof this.value!="undefined"?{value:this.value,text:this.text,toString:function(){return this.text?this.text:this.value}}:""}return typeof this.value!="undefined"?this.value:""},setValue:function(v){if(this.choiceOnly){return this.value=v}if(v&&typeof v=="object"&&eval("v."+this.valueField)){var value=eval("v."+this.valueField);var text=eval("v."+this.displayField)?eval("v."+this.displayField):this.valueNotFoundText;this.lastSelectionText=text;if(this.hiddenField){this.hiddenField.value=value}Disco.Ext.PopupWindowField.superclass.setValue.call(this,text);this.value=value;this.text=text}else{if(v===null){Disco.Ext.PopupWindowField.superclass.setValue.call(this,"")}else{Disco.Ext.PopupWindowField.superclass.setValue.call(this,v)}}},onTriggerClick:function(){if(this.win){this.win.show()}},onRender:function(b,a){Disco.Ext.PopupWindowField.superclass.onRender.call(this,b,a);if(this.win){this.win.on("select",this.choice,this)}if(this.hiddenName){this.hiddenField=this.el.insertSibling({tag:"input",type:"hidden",name:this.hiddenName,id:(this.hiddenId||this.hiddenName)},"before",true);this.hiddenField.value=this.hiddenValue!==undefined?this.hiddenValue:this.value!==undefined?this.value:"";this.el.dom.removeAttribute("name")}if(!this.editable){this.editable=true;this.setEditable(false)}if(this.choiceOnly){this.el.hide()}},choice:function(a,b){this.setValue(a);this.fireEvent("select",a,b)},initComponent:function(){Disco.Ext.PopupWindowField.superclass.initComponent.call(this);this.addEvents("select")},validateBlur:function(){return !this.win||!this.win.isVisible()},onDestroy:function(){if(this.win&&this.win.isVisible()){this.win.hide()}Disco.Ext.PopupWindowField.superclass.onDestroy.call(this)},setEditable:function(a){if(a==this.editable){return}this.editable=a;if(!a){this.el.dom.setAttribute("readOnly",true);this.el.on("dblclick",this.onTriggerClick,this);this.el.on("click",this.onTriggerClick,this);this.el.addClass("x-combo-noedit")}else{this.el.dom.setAttribute("readOnly",false);this.el.un("mousedown",this.onTriggerClick,this);this.el.removeClass("x-combo-noedit")}}});Ext.reg("popupwinfield",Disco.Ext.PopupWindowField);Disco.Ext.GridSelectWin=Ext.extend(Ext.Window,{title:"\u9009\u62e9\u6570\u636e",width:540,height:400,layout:"fit",buttonAlign:"center",closeAction:"hide",grid:null,modal:true,callback:Ext.emptyFn,choice:function(){var d=this.grid.grid||this.grid;var b=d.getSelectionModel().getSelections();if(!b||b.length<1){Ext.Msg.alert("\u63d0\u793a","\u8bf7\u9009\u62e9\u4e00\u6761\u6570\u636e\u8bb0\u5f55");return false}var a=[];for(var c=0;c<b.length;c++){a[c]=b[c].data}this.hide();this.fireEvent("select",a,this)},initComponent:function(){this.buttons=[{text:"\u786e\u5b9a",handler:this.choice,scope:this},{text:"\u53d6\u6d88",handler:function(){this.hide()},scope:this}];Disco.Ext.GridSelectWin.superclass.initComponent.call(this);if(this.grid){var a=this.grid.grid||this.grid;a.on("rowdblclick",this.choice,this);this.add(this.grid)}this.addEvents("select")}});Disco.Ext.TreeNodeUtil={};Ext.apply(Disco.Ext.TreeNodeUtil,{cloneTreeNode:function(a){var c=[];for(var b=0;b<a.length;b++){var d=Ext.apply({},a[b]);if(a[b].children&&a[b].children.length){d.children=this.cloneTreeNode(a[b].children)}else{d.children=[]}c.push(d)}return c},cascadeNode:function(f,e,d,a){if(e.apply(d||this,a||[f])!==false){if(f.children&&f.children.length){for(var b=0,c=f.children;b<c.length;b++){c[b].parentNode=f;this.cascadeNode(c[b],e,d,a)}}}},deepFindNode:function(c,b){var a=null;this.cascadeNode(b,function(d){if(d.id==c){a=d;return false}});return a},getNodeById:function(c,b){var a=this.deepFindNode(c,{id:"root",children:b});return a||null},findNode:function(c,b){if(c=="root"){return b}else{var a=this.deepFindNode(c,{id:"root",children:b});return a&&a.children?a.children:null}},localRemove:function(e,a){var c=Ext.type(a)=="string"?Disco.Cache.get(a):a;if(c){var d=c.items;var b=this.getNodeById(e,d);if(b){if(b.parentNode&&b.parentNode.children){b.parentNode.children.remove(b)}else{d.remove(b)}if(c.fireEvent){c.fireEvent("removenode",b,c)}}}},localAdd:function(c,f,b){var d=Ext.type(b)=="string"?Disco.Cache.get(b):b;if(d){var e=d.items;if(f){var a=this.getNodeById(f,e);if(a){a.children=a.children||[];if(a.children&&a.children.length==0){a.leaf=false;a.children=[c]}else{if(a.children){a.children.push(c)}}if(d.fireEvent){d.fireEvent("addnode",c,a,d)}}}else{e.push(c);if(d.fireEvent){d.fireEvent("addnode",c,null,d)}}}},localChange:function(b,a){var c=Ext.type(a)=="string"?Disco.Cache.get(a):a;if(c){var e=c.items;var d=this.getNodeById(b.id,e);if(d){Ext.copyToIf(d,b,["children","cls","loader","parentNode"]);if(c.fireEvent){c.fireEvent("updatenode",d,c)}}}},localMove:function(b,c,a){this.localRemove(b.id,a);this.localAdd(b,c,a)}});Disco.Ext.TreeCollection=Ext.extend(Ext.util.MixedCollection,{removeNode:function(a){Disco.Ext.TreeNodeUtil.localRemove(a,this);this.unregisterNode(a)},addNode:function(a,c){var b=null;if(b=this.getNodeById(a.id)){Disco.Ext.TreeNodeUtil.localChange(a,this);return}Disco.Ext.TreeNodeUtil.localAdd(a,c,this);this.registerNode(a)},changeNode:function(b,a){Disco.Ext.TreeNodeUtil.localChange(b,this)},moveNode:function(b,c,a){Disco.Ext.TreeNodeUtil.localMove(b,c,this)},unregisterNode:function(a){delete this.nodeHash[a]},registerNode:function(b){if(b.id){this.nodeHash[b.id]=b}var a=b.children||(b.attributes&&b.attributes.children);if(a&&a.length){Ext.each(a,this.registerNode,this)}},getAllNode:function(){return this.nodeHash||{}},getNodeById:function(a){return this.nodeHash[a]},addAll:function(b){Disco.Ext.TreeCollection.superclass.addAll.call(this,b);this.nodeHash={};if(b){var a={id:"root",children:b};this.registerNode(a)}},clear:function(){this.nodeHash={};Disco.Ext.TreeCollection.superclass.clear.call(this)}});Disco.Ext.CachedRemoteProxy=function(b,a){this.enableCache=(b.enableCache==window.undefined?true:b.enableCache);this.store=a;Disco.Ext.CachedRemoteProxy.superclass.constructor.call(this,{url:b.url});Ext.apply(this,b)};Disco.Ext.CachedRemoteProxy.DATAS={};Disco.Ext.CacheFilter=new Ext.util.MixedCollection();Disco.Ext.CacheFilter.firstSearch=function(b,a){if(typeof a!="regexp"){a=new RegExp("^"+a)}return a.test(b)};Ext.extend(Disco.Ext.CachedRemoteProxy,Ext.data.HttpProxy,{quickSearch:function(d,a){if(!a.getCount()){return a}var c=a;var b=a.items[0];if(!this.disableClientFilter){for(var e in d){if(e&&b[e]!==undefined){c=c.filter(e,d[e])}}}c=this.cacheFilter(d,c);return c},cacheFilter:function(c,b){var a=Disco.Ext.CacheFilter.key(this.varName);if(a&&c){if(typeof a=="function"){return a.call(this,b,c)}}return b},getData:function(){return Disco.Ext.CachedRemoteProxy.DATAS[this.varName]},loadFromCache:function(d,g,j,k,l){var f=this.quickSearch(d,this.getData());var b={rowCount:f.getCount(),result:[]};var a=0,c=-1;if(d.start){a=Ext.num(parseInt(d.start),0)}if(d.limit){c=Ext.num(parseInt(d.limit),-1)}var i=f.getCount();if(c>0){i=a+c}if(i>f.getCount()){i=f.getCount()}if(i<0){i=this.pageSize}b.result=f.getRange(a,i-1);var m;try{m=g.readRecords(b)}catch(h){this.fireEvent("loadexception",this,b,response,h);j.call(k,null,d,false);return}this.fireEvent("load",this,b,l);j.call(k,m,l,true)},request:function(e,b,f,a,g,d,c){f=f||{};if(this.fireEvent("beforeload",this,f)!==false){if(this.getData().getCount()){this.loadFromCache(f,a,g,d,c)}else{Disco.Ext.CachedRemoteProxy.superclass.request.apply(this,arguments)}}},onRead:function(action,o,response){if(this.enableCache){try{var json=response.responseText;var obj=eval("("+json+")");if(obj&&(obj.enableCache===false||obj.enableCache===true)){this.enableCache=obj.enableCache}if(this.enableCache){this.getData().clear();this.getData().addAll(Ext.isArray(obj)?obj:obj.result);o.params.limit=this.pageSize?this.pageSize:10;this.loadFromCache(o.params,o.reader,o.request.callback,o.request.scope,o.request.arg)}else{var result;try{result=o.reader.read(response)}catch(e){this.fireEvent("loadexception",this,o,response,e);o.request.callback.call(o.request.scope,null,o.request.arg,false);return}this.fireEvent("load",this,o,o.request.arg);o.request.callback.call(o.request.scope,result,o.request.arg,true)}}catch(e){this.fireEvent("loadexception",this,o,response,e);o.request.callback.call(o.request.scope,null,o.request.arg,false);return}}else{var result;try{result=o.reader.read(response)}catch(e){this.fireEvent("loadexception",this,o,response,e);o.request.callback.call(o.request.scope,null,o.request.arg,false);return}this.fireEvent("load",this,o,o.request.arg);o.request.callback.call(o.request.scope,result,o.request.arg,true)}},add:function(a,b){this.getData().add(a,b)},remove:function(a){this.getData().remove(a)},removeKey:function(a){this.getData().removeKey(a)},addOrUpdate:function(b,a){this.getData().replace(b,a)},update:function(b,a){this.getData().replace(b,a)}});Disco.Ext.CachedRemoteStore=function(a){Disco.Ext.CachedRemoteStore.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(!a.data?new Disco.Ext.CachedRemoteProxy(a):undefined),reader:new Ext.data.JsonReader(a,a.fields)}));if(!Disco.Ext.CachedRemoteProxy.DATAS[this.varName]){Disco.Ext.CachedRemoteProxy.DATAS[this.varName]=new Ext.util.MixedCollection(true)}};Ext.extend(Disco.Ext.CachedRemoteStore,Ext.data.Store,{refreshCache:function(){this.proxy.getData().clear();this.reload()},enableCache:function(a){this.proxy.enableCache=a===window.undefined?true:!!!a},isCache:function(){return this.proxy.enableCache},sortFn:function(d,c){if(!d||c||!d.toUpperCase||!c.toUpperCase){var h=d,g=c;return h>g?1:(h<g?-1:0)}var f=d.toUpperCase()==c.toUpperCase();if(!f){return d.toUpperCase()<c.toUpperCase()?-1:1}else{var e=0;for(var f=0;f<d.length;f++){if(d[f]!==c[f]){return d[f]<c[f]?1:-1}}return e}},sortData:function(c,d){d=d||"ASC";var a=this.fields.get(c).sortType;var b=this.sortFn;this.data.sort(d,b);if(this.snapshot&&this.snapshot!=this.data){this.snapshot.sort(d,b)}},sort:function(h,a){if(this.isCache===false){Disco.Ext.CachedRemoteStore.superclass.sort.call(this,h,a);return}var d=this.fields.get(h);if(!d){return false}if(!a){if(this.sortInfo&&this.sortInfo.field==d.name){a=(this.sortToggle[d.name]||"ASC").toggle("ASC","DESC")}else{a=d.sortDir}}var j=(this.sortToggle)?this.sortToggle[d.name]:null;var b=(this.sortInfo)?this.sortInfo:null;this.sortToggle[d.name]=a;this.sortInfo={field:d.name,direction:a};if(!this.remoteSort){this.applySort();this.fireEvent("datachanged",this)}else{var g=a||"ASC";var c=this.fields.get(d.name).sortType;var i=this.sortFn;var e=function(k,f){var m=c(k[d.name]),l=c(f[d.name]);return i(m,l)};this.proxy.getData().sort(g,e);if(!this.load(this.lastOptions)){if(j){this.sortToggle[d.name]=j}if(b){this.sortInfo=b}}}}});Disco.Ext.CachedRemoteObject=function(varName,url,collectionType,shareCache){this.varName=varName;this.url=url;this.collectionType=collectionType;this.addEvents("load");if(shareCache){if(!Disco.Ext.CachedRemoteObject.shareCaches[varName]){Disco.Ext.CachedRemoteObject.shareCaches[varName]=eval("new "+(collectionType||"Ext.util.MixedCollection")+"()")}}Disco.Ext.CachedRemoteObject.superclass.constructor.call(this)};Disco.Cache=Disco.Ext.CachedRemoteObject.DATAS={};Disco.shareCaches=Disco.Ext.CachedRemoteObject.shareCaches={};Ext.extend(Disco.Ext.CachedRemoteObject,Ext.util.Observable,{varName:null,url:null,getData:function(){var a=Disco.Ext.CachedRemoteObject.DATAS[this.varName];return a},onload:function(a){this.fireEvent("load",this,Disco.Ext.CachedRemoteObject.DATAS[this.varName]);if(a){a()}},clearData:function(){var a=Disco.Ext.CachedRemoteObject.DATAS[this.varName];if(a.clear){a.clear()}else{a=null}},load:function(b,a){if(Disco.Ext.CachedRemoteObject.DATAS[this.varName]){this.onload.call(this,b,a);return}if(this.varName&&this.url){Disco.Ext.Util.loadJSON2Collection("Disco.Ext.CachedRemoteObject.DATAS['"+this.varName+"']",this.url,this.onload.createDelegate(this,[b]),Disco.shareCaches[this.varName],this.collectionType)}}});CachedRemoteObject=Disco.Ext.CachedRemoteObject;Disco.Ext.MemoryTreeLoader=function(a){Disco.Ext.MemoryTreeLoader.superclass.constructor.call(this,a);if(this.varName&&(this.dataUrl||this.url)){this.remoteObject=new Disco.Ext.CachedRemoteObject(this.varName,(this.url||this.dataUrl),"Disco.Ext.TreeCollection",true);if(!this.lazyLoad){this.remoteObject.load()}}this.shareCache=Disco.Ext.CachedRemoteObject.shareCaches[this.varName]};Ext.extend(Disco.Ext.MemoryTreeLoader,Ext.tree.TreeLoader,{varName:null,remoteObject:null,dataProxy:false,autoLeaf:true,remoteDataProxy:null,transferNode:window.undefined,cascadeNode:function(f,e,d,a){if(e.apply(d||this,a||[f])!==false){if(f.children&&f.children.length){for(var b=0,c=f.children;b<c.length;b++){this.cascadeNode(c[b],e,d,a)}}}},deepFindNode:function(c,b){var a=null;this.cascadeNode(b,function(d){if(d.id==c){a=d;return false}});return a},findNode:function(c,b){if(c=="root"){return Ext.isArray(b)?b:b.items}else{var a=this.deepFindNode(c,{id:"root",children:(Ext.isArray(b)?b:b.items)});return a&&a.children?a.children:null}},load:function(a,c){if(this.clearOnLoad){while(a.firstChild){a.removeChild(a.firstChild)}}var b=this.remoteObject.getData();if(b&&b.length){a.attributes.children=this.findNode(a.id,b)}if(this.doPreload(a)){if(typeof c=="function"){c()}}else{if(this.dataUrl||this.url){this.requestData(a,c)}}},doPreload:function(d){if(d.attributes.children&&d.attributes.children.length){if(d.childNodes.length<1){var c=d.attributes.children;d.beginUpdate();for(var b=0,a=c.length;b<a;b++){var e=Ext.apply({},c[b]);var f=this.createNode(e);if(f===false){continue}var f=d.appendChild(this.createNode(e));if(this.preloadChildren){this.doPreload(f)}}d.endUpdate()}return true}else{return false}},createNode:function(a){a=Ext.apply({},a);if(this.baseAttrs){Ext.applyIf(a,this.baseAttrs)}if(this.transferNode!=window.undefined){if(typeof this.transferNode=="function"){a=this.transferNode(a)}else{if(typeof this.transferNode=="object"){for(var b in this.transferNode){if(this.transferNode.hasOwnProperty(b)&&Ext.isEmpty(a[b])){a[b]=a[this.transferNode[b]]}}}}}if(this.autoLeaf===true){if(!a.children||!a.children.length){a.leaf=true}}return Disco.Ext.MemoryTreeLoader.superclass.createNode.call(this,a)},processResponse:function(response,parentNode,callback){var json=response.responseText;try{var o=eval("("+json+")");var collection=Disco.Ext.CachedRemoteObject.shareCaches[this.varName];collection.clear();collection.addAll(o);Disco.Ext.CachedRemoteObject.DATAS[this.varName]=collection;o=collection.items;parentNode.beginUpdate();collection.each(function(node){var n=this.createNode(node);if(n){parentNode.appendChild(n)}},this);parentNode.endUpdate();if(typeof callback=="function"){callback(this,parentNode)}}catch(e){this.handleFailure(response)}}});Ext.ns("Disco.Ext.Tree");BaseGridList=Ext.extend(Ext.Panel,{layout:"fit",loadData:false,pageSize:10,closable:true,autoScroll:true,pagingToolbar:true,gridForceFit:true,gridViewConfig:{},gridConfig:{},showMenu:true,menu_refresh:false,linkRenderer:Disco.Ext.Util.linkRenderer,linkRender:Disco.Ext.Util.linkRenderer,imgRender:Disco.Ext.Util.imgRender,booleanRender:Disco.Ext.Util.booleanRender,dateRender:Disco.Ext.Util.dateRender,userRender:Disco.Ext.Util.userRender,objectRender:Disco.Ext.Util.objectRender,typesRender:Disco.Ext.Util.typesRender,operaterRender:Disco.Ext.Util.operaterRender,storeType:Ext.data.JsonStore,storeConfig:{},emailRender:function(a){return a?a.email:"\u672a\u77e5"},refresh:function(){this.store.removeAll();this.store.reload({callback:function(a){if(a&&a.length<1){Ext.Msg.alert("\u63d0\u793a","\u6ca1\u6709\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\uff01");Disco.Ext.Util.autoCloseMsg.defer(2000)}}})},showContextMenu:function(b,a,d){var c=d?d:b;c.preventDefault();if(a){this.grid.getSelectionModel().selectRow(a,false)}this.menu.showAt(c.getPoint())},doOperate:function(b,i,c,g){var a=g.getTarget("A",3);if(a){var h=a.getAttribute("theid");var f=a.getAttribute("op");var d=a.getAttribute("cf");if(h&&f&&this.operate){this.operate(f,h,d,b,i,c,g)}}},initComponent:function(){BaseGridList.superclass.initComponent.call(this);if(!this.store){this.store=new this.storeType(Ext.apply({id:"id",url:this.url,root:"result",totalProperty:"rowCount",remoteSort:true,fields:this.storeMapping},this.storeConfig))}this.store.paramNames.sort="orderBy";this.store.paramNames.dir="orderType";this.cm.defaultSortable=true;var a=Ext.apply({forceFit:this.gridForceFit},this.gridViewConfig);var b=Ext.apply({},{store:this.store,cm:this.cm,trackMouseOver:false,loadMask:true,viewConfig:a,bbar:(Ext.isFunction(this.buildGridBbar)?this.buildGridBbar():false)||(this.pagingToolbar?new Ext.ux.PagingComBo({pageSize:this.pageSize,store:this.store}):null)});Ext.apply(b,this.gridConfig);this.menus=this.menus||[];if(this.menu_refresh){this.menus[this.menus.length]={id:"menu_refresh",cls:"x-btn-text-icon",icon:"images/icons/arrow_refresh.png",text:"\u5237\u65b0",handler:this.refresh,scope:this}}this.menu=new Ext.menu.Menu({items:this.menus});if(this.gridTbar){b.tbar=this.gridTbar}if(this.gridBorder===false||this.gridBorder){b.border=this.gridBorder}if(this.columnLock&&Ext.grid.LockingGridPanel){if(!b.columns&&b.cm){b.columns=b.cm.config;delete b.cm}this.grid=new Ext.grid.LockingGridPanel(b)}else{this.grid=new Ext.grid.GridPanel(b)}this.grid.on("rowcontextmenu",function(c,f,d){if(!this.showMenu){return false}if(c.getSelectionModel().selectRow){c.getSelectionModel().selectRow(f)}this.menu.showAt(d.getPoint());d.preventDefault()},this);this.add(this.grid);if(this.loadData){this.store.load()}}});HTMLEditor=Ext.extend(Ext.form.HtmlEditor,{codeStyle:'<br/><pre style="border-right: #999999 1px dotted; padding-right: 5px; border-top: #999999 1px dotted; padding-left: 5px; font-size: 12px; padding-bottom: 5px; margin-left: 10px; border-left: #999999 1px dotted; margin-right: 10px; padding-top: 5px; border-bottom: #999999 1px dotted; background-color: #eeeeee">{0}</pre><br/>',onRender:function(c,a){HTMLEditor.superclass.onRender.call(this,c,a);if(this.keys){if(!this.keys.length){this.keyMap=new Ext.KeyMap(this.getEditorBody(),this.keys)}else{this.keyMap=new Ext.KeyMap(this.getEditorBody(),this.keys[0]);for(var b=1;b<this.keys.length;b++){this.keyMap.addBinding(this.keys[b])}}this.keyMap.stopEvent=true}},showEmoteSelect:function(){emoteSelectWin.editor=this;emoteSelectWin.show()},addImage:function(){function a(){var c=this;b.upload(function(d){if(d){var e="<br/><img src="+d.path;if(d.width){e+=" width="+d.width}if(d.height){e+=" height="+d.height}e+=" /><br/>";c.insertAtCursor(e);b.close()}})}var b=new UploadImageWindow({modal:true,iconCls:"icon-img",buttons:[{text:"\u786e\u5b9a",handler:a,scope:this},{text:"\u53d6\u6d88",handler:function(){b.close()}}]});b.show()},addCode:function(){function a(){var c=b.getComponent("codes").getValue();this.insertAtCursor(String.format(this.codeStyle,c));b.close()}var b=new Ext.Window({title:"\u6dfb\u52a0\u4ee3\u7801",width:500,height:300,modal:true,iconCls:"icon-code",layout:"fit",items:{xtype:"textarea",id:"codes"},buttons:[{text:"\u786e\u5b9a",handler:a,scope:this},{text:"\u53d6\u6d88",handler:function(){b.close()}}]});b.show()},createToolbar:function(a){HTMLEditor.superclass.createToolbar.call(this,a);this.tb.insertButton(16,{cls:"x-btn-icon",icon:"images/qq/img.gif",handler:this.addImage,scope:this});this.tb.insertButton(17,{cls:"x-btn-icon",icon:"images/qq/code.gif",handler:this.addCode,scope:this});this.tb.insertButton(18,{cls:"x-btn-icon",icon:"images/emote/main.png",handler:this.showEmoteSelect,scope:this})},validateValue:function(b){if(b.length>this.maxLength){var a=String.format(this.maxLengthText,this.maxLength);this.markInvalid(a);return false}return true}});Ext.reg("myhtmleditor",HTMLEditor);IFrames={};Disco.Ext.CrudListPanel=function(a){var b=a||{};Ext.apply(this,b);this.addEvents("saveobject","removeobject");Disco.Ext.CrudListPanel.superclass.constructor.call(this)};Ext.extend(Disco.Ext.CrudListPanel,Ext.util.Observable,{layout:"fit",border:false,closable:true,autoScroll:true,importExplain:"",gridForceFit:true,viewWin:{width:650,height:410,title:"\u8be6\u60c5\u67e5\u770b"},searchWin:{width:630,height:300,title:"\u9ad8\u7ea7\u67e5\u8be2"},gridViewConfig:{},gridConfig:{},baseQueryParameter:{}});Ext.apply(Disco.Ext.CrudListPanel.prototype,Disco.Ext.CrudFunction,{afterList:Ext.emptyFn,list:function(){this.initComponent();this.checkAdnLoadColumnField();this.store=new Ext.data.JsonStore({id:this.storeId?this.storeId:"id",url:this.formatUrl("list"),root:"result",totalProperty:"rowCount",remoteSort:true,autoDestroy:true,fields:this.storeMapping});if(Ext.objPcount(this.baseQueryParameter)){this.store.on("beforeload",function(f,g){Ext.apply(f.baseParams,this.baseQueryParameter)},this)}this.store.baseParams=Ext.apply({},{limit:this.pageSize||""},this.initQueryParameter||{});this.store.paramNames.sort="orderBy";this.store.paramNames.dir="orderType";var d=this.buildCrudOperator();var c=Ext.apply({forceFit:this.gridForceFit},this.gridViewConfig);var e=Ext.apply(this.gridConfig,{store:this.store,stripeRows:true,trackMouseOver:false,loadMask:true,viewConfig:c,tbar:d,border:false,bbar:this.pagingToolbar?new Ext.ux.PagingComBo({rowComboSelect:true,pageSize:this.pageSize,store:this.store,displayInfo:true}):null});if(this.summaryGrid){if(e.plugins){if(typeof e.plugins=="object"){e.plugins=[e.plugins]}}else{e.plugins=[]}e.plugins[e.plugins.length]=new Ext.ux.grid.GridSummary()}var b=this.columns,a={};b=b||this.cm.config;delete e.cm;b=b.copy();if(this.gridRowNumberer){b.unshift(new Ext.grid.RowNumberer({header:"\u5e8f\u53f7",width:36}))}if((!e.sm&&!e.selModel)&&this.gridSelModel=="checkbox"){a.sm=new Ext.grid.CheckboxSelectionModel();if(b[0] instanceof Ext.grid.RowNumberer){b.splice(1,0,a.sm)}else{b.unshift(a.sm)}}a.columns=b;e=Ext.applyIf(a,e);if(this.columnLock&&Ext.grid.LockingGridPanel){this.grid=new Ext.grid.LockingGridPanel(e)}else{this.grid=new Ext.grid.GridPanel(e)}this.grid.colModel.defaultSortable=true;this.panel=new Ext.Panel({id:this.id,title:this.title,closable:this.closable,autoScroll:this.autoScroll,layout:this.layout,border:this.border,listeners:{close:function(){delete this.panel},scope:this}});this.panel.add(this.grid);this.loadOperatorsPermission();this.initCrudEventHandler();this.afterList();if(this.autoLoadGridData){this.store.load()}this.panel.service=this;return this.panel}});Ext.namespace("Ext.ux.panel");Ext.ux.panel.DDTabPanel=Ext.extend(Ext.TabPanel,{arrowOffsetX:-9,arrowOffsetY:-8,border:false,enableTabScroll:true,layoutOnTabChange:true,autoScroll:true,resizeTabs:true,tabWidth:136,minTabWidth:136,titleLength:100,initComponent:function(){Ext.ux.panel.DDTabPanel.superclass.initComponent.call(this);if(!this.ddGroupId){this.ddGroupId="dd-tabpanel-group-"+Ext.ux.panel.DDTabPanel.superclass.getId.call(this)}},afterRender:function(){Ext.ux.panel.DDTabPanel.superclass.afterRender.call(this);this.arrow=Ext.DomHelper.append(Ext.getBody(),'<div class="dd-arrow-down"></div>',true);this.arrow.hide();var b=this.ddGroupId;this.dd=new Ext.ux.panel.DDTabPanel.DropTarget(this,{ddGroup:b})},initTab:function(d,e){Ext.ux.panel.DDTabPanel.superclass.initTab.call(this,d,e);var g=this.id+"__"+d.id;var f=this.stripWrap.id;Ext.applyIf(d,{allowDrag:true});Ext.apply(d,{position:(e+1)*2,ds:new Ext.dd.DragSource(g,{ddGroup:this.ddGroupId,dropEl:d,dropElHeader:Ext.get(g,true),scroll:false,onStartDrag:function(){this.constrainTo(f);this.getProxy().ghost.dom.innerHTML=String.format("<div style='width:100px;overflow:hidden;'>{0}</div>",this.dropEl.title);if(this.dropEl.iconCls){this.getProxy().getGhost().select(".x-tab-strip-text").applyStyles({paddingLeft:"1px"})}},onMouseDown:function(a){if(!this.dropEl.isVisible()){this.dropEl.show()}}}),enableDrag:function(){this.allowDrag=true;return this.ds.unlock()},disableDrag:function(){this.allowDrag=false;return this.ds.lock()}});if(d.allowDrag){d.enableDrag()}else{d.disableDrag()}},onDestroy:function(){Ext.destroy(this.dd,this.arrow);Ext.ux.panel.DDTabPanel.superclass.onDestroy.call(this)}});Ext.ux.panel.DDTabPanel.DropTarget=Ext.extend(Ext.dd.DropTarget,{constructor:function(c,d){this.tabpanel=c;Ext.ux.panel.DDTabPanel.DropTarget.superclass.constructor.call(this,c.stripWrap,d)},notifyOver:function(i,w,y){var v=this.tabpanel.items;var s=v.length;if(!w.within(this.getEl())){return"x-dd-drop-nodrop"}var e=this.tabpanel.arrow;var t=this.el.getY();var B;var x=w.getPageX();for(var z=0;z<s;z++){var C=v.itemAt(z);var D=C.ds.dropElHeader;var u=D.getX();var F=u+D.dom.clientWidth/2;if(x<=F){B=u;break}}if(typeof B=="undefined"){var E=v.itemAt(s-1);if(E){var A=E.ds.dropElHeader.dom;B=(new Ext.Element(A).getX()+A.clientWidth)+3}}e.setTop(t+this.tabpanel.arrowOffsetY).setLeft(B+this.tabpanel.arrowOffsetX).show();return this.dropAllowed},notifyDrop:function(e,t,x){this.tabpanel.arrow.hide();var r=this.tabpanel.items;var i=r.length;var v=t.getPageX();var s=i;e.dropEl.position=i*2+1;var u=this.tabpanel.items.indexOf(e.dropEl);for(var y=0;y<i;y++){var z=r.itemAt(y);var A=z.ds.dropElHeader;var q=A.getX();var B=q+A.dom.clientWidth/2;if(v<=B){if(u<y){y-=1}break}}e.proxy.hide();var w=e.dropEl.ownerCt.remove(e.dropEl,false);var z=this.tabpanel.getComponent(y);if(z&&z.tabFixed){y=this.getLastTabFixed()}if(this.tabpanel.items.getCount()<y){y=this.tabpanel.items.getCount()}this.tabpanel.insert(y,w);this.tabpanel.activate(w);return true},getLastTabFixed:function(){var b=this.tabpanel.items.filter("tabFixed",true);return b.getCount()},notifyOut:function(e,f,d){this.tabpanel.arrow.hide()}});Ext.reg("ddtabpanel",Ext.ux.panel.DDTabPanel);ChartTools={createFusionChart:function(d,f,g,e,a,c){c=c||{};var b=new FusionCharts(f,g,e,a,"0","0");d=d||c.url;if(d){if(d.indexOf("?")<1){d+="?"}if(c.params){d+=Ext.urlEncode(c.params)}b.setDataURL(d)}if(c.renderTo&&d){b.render(c.renderTo)}return b},createChart:function(c,d,b){b=b||{};var a=this.createFusionChart(c,d,b.id,b.width,b.height,b);return a},createColumn2D:function(b,a){return this.createChart(b,"FusionCharts/chart/Column2D.swf",a)},createColumn3D:function(b,a){return this.createChart(b,"FusionCharts/chart/Column3D.swf",a)},createGroupColumn2D:function(b,a){return this.createChart(b,"FusionCharts/chart/MSColumn2D.swf",a)},createGroupColumn3D:function(b,a){return this.createChart(b,"FusionCharts/chart/MSColumn3D.swf",a)},createPie2D:function(b,a){return this.createChart(b,"FusionCharts/chart/Pie2D.swf",a)},createPie3D:function(b,a){return this.createChart(b,"FusionCharts/chart/Pie3D.swf",a)},createBar2D:function(b,a){return this.createChart(b,"FusionCharts/chart/Bar2D.swf",a)},createGroupBar2D:function(b,a){return this.createChart(b,"FusionCharts/chart/MSBar2D.swf",a)},createGroupBar3D:function(b,a){return this.createChart(b,"FusionCharts/chart/MSBar3D.swf",a)},createLine:function(b,a){return this.createChart(b,"FusionCharts/chart/Line.swf",a)},createGroupLine:function(b,a){return this.createChart(b,"FusionCharts/chart/MSLine.swf",a)}};ChartWindow=Ext.extend(Ext.Window,{max:20,store:null,datas:null,columnModel:null,url:"",params:null,grid:null,layout:"border",closeAction:"hide",buttonAlign:"center",tpl:new Ext.XTemplate('<chart caption="{title}"> ','<tpl for="list">','<set label="{name}" value="{value}" />',"</tpl></chart>"),initParams:function(){if(this.grid){this.store=this.grid.store;if(!this.columnModel){this.columnModel=this.grid.getColumnModel()}}if(this.columnModel){var a=[];if(this.columnModel.getColumnCount&&this.columnModel.getDataIndex){for(var b=0;b<this.columnModel.getColumnCount();b++){a.push({id:this.columnModel.getDataIndex(b),title:this.columnModel.getColumnHeader(b)})}}else{a=this.columnModel}this.leftTree.root.attributes.children=[];for(var b=0;b<a.length;b++){this.leftTree.root.attributes.children.push({text:a[b].title,id:a[b].id,leaf:true})}this.leftTree.root.reload();this.btn_field.store.loadData(a);this.btn_field.setValue(this.field||"")}this.btn_max.setValue(this.max);this.setTitle(this.title)},loadChart:function(){this.initParams();var l={title:this.title,list:[],order:false};var s="";if(this.btn_orderASC.getValue()){s="ASC"}else{if(this.btn_orderDESC.getValue()){s="DESC"}}if(this.datas&&this.datas.length){l.list=this.datas}else{if(this.store){if(s){this.store.sort(this.field,s)}for(var j=0;j<this.store.getCount()&&j<this.max;j++){var a=this.store.getAt(j).data;var h={name:a[this.label||"sn"],value:a[this.field]};l.list.push(h)}l.order=true}}var m="";if(!l.list.length&&this.url){var c=Ext.lib.Ajax.syncRequest("POST",this.url,Ext.apply(this.params,{sort:s}));m=c.conn.responseText}else{if(!l.order&&s){var n="value";var g=s.toUpperCase()=="DESC"?-1:1;l.list.sort(function(f,e){if(f[n]==e[n]){return 0}else{return f[n]>e[n]?1*g:-1*g}})}m=this.tpl.applyTemplate(l)}var k=ChartTools.createColumn3D;if(this.btn_pie.getValue()){k=ChartTools.createPie3D}else{if(this.btn_pie2d.getValue()){k=ChartTools.createPie2D}else{if(this.btn_bar2d.getValue()){k=ChartTools.createColumn2D}}}var d=this.chartPanel;var q=d.body.getBox();try{this.chart=k.call(ChartTools,null,{width:q.width-20,height:q.height-10})}catch(o){alert(o)}this.chart.setDataXML(m);this.chart.render(d.body.dom)},refreshChart:function(){this.max=this.btn_max.getValue();this.loadChart()},clickDeptNode:function(a){this.params=Ext.apply({},{field:a.attributes.id},this.params);this.field=a.attributes.id;this.title=a.attributes.text;if(this.store){this.datas=null}this.refreshChart()},initComponent:function(){this.btn_field=new Disco.Ext.SmartCombox({name:"colorInput",hiddenName:"colorInput",fieldLabel:"colorInput",displayField:"title",valueField:"id",allowBlank:false,width:100,store:new Ext.data.JsonStore({fields:["id","title"]}),editable:false,mode:"local",triggerAction:"all",emptyText:"\u8bf7\u9009\u62e9..."});this.btn_max=new Ext.form.NumberField({name:"max",xtype:"numberfield",width:30});this.btn_orderType=new Ext.form.ComboBox(Ext.apply({},{width:80},Disco.Ext.Util.buildCombox("type","\u662f\u5426",[["\u7531\u4f4e\u5230\u9ad8","ASC"],["\u7531\u9ad8\u5230\u4f4e","DESC"]],"DESC",true)));this.btn_orderASC=new Ext.form.Radio({boxLabel:"\u7531\u4f4e\u5230\u9ad8",name:"orderTypes",handler:this.refreshChart,scope:this});this.btn_orderDESC=new Ext.form.Radio({boxLabel:"\u7531\u9ad8\u5230\u4f4e",name:"orderTypes",handler:this.refreshChart,scope:this});this.btn_bar=new Ext.form.Radio({boxLabel:"\u67f1\u72b6\u56fe",cls:"x-btn-text-icon",name:"types",handler:this.refreshChart,scope:this,checked:true});this.btn_pie=new Ext.form.Radio({boxLabel:"\u997c\u72b6\u56fe",cls:"x-btn-text-icon",name:"types",handler:this.refreshChart,scope:this});this.btn_bar2d=new Ext.form.Radio({boxLabel:"\u67f1\u72b6\u56fe2D",cls:"x-btn-text-icon",name:"types",handler:this.refreshChart,scope:this});this.btn_pie2d=new Ext.form.Radio({boxLabel:"\u997c\u72b6\u56fe2D",cls:"x-btn-text-icon",name:"types",handler:this.refreshChart,scope:this});this.btn_vdate1=new Ext.form.DateField({format:"Y-m-d"});this.btn_vdate2=new Ext.form.DateField({format:"Y-m-d"});Ext.apply(this,{width:Ext.getBody().getViewSize().width-50,height:Ext.getBody().getViewSize().height-20});ChartWindow.superclass.initComponent.call(this);this.leftTree=new Ext.tree.TreePanel({xtype:"treepanel",title:"\u5206\u6790\u9879\u76ee",border:false,rootVisible:false,root:new Ext.tree.AsyncTreeNode({id:"root",text:"\u6240\u6709\u90e8\u95e8",expanded:true,children:[],loader:new Ext.tree.TreeLoader()}),listeners:{scope:this,click:this.clickDeptNode}});this.chartPanel=new Ext.Panel({html:"\u6b63\u5728\u751f\u6210\u7edf\u8ba1\u56fe..."});this.add({region:"west",width:150,items:[this.leftTree]});this.add({region:"center",layout:"fit",items:this.chartPanel,tbar:["\u6700\u591a\u5206\u6790\u6570",this.btn_max,"\u6392\u5e8f\u65b9\u5f0f:",this.btn_orderASC,this.btn_orderDESC,"-","\u5c55\u793a\u65b9\u5f0f:",this.btn_bar,this.btn_pie,this.btn_bar2d,this.btn_pie2d,"    ","-",{text:"\u5f00\u59cb\u5206\u6790",cls:"x-btn-text-icon",handler:this.refreshChart,scope:this,icon:"images/icons/application_side_expand.png"}]});this.on("show",this.loadChart,this)}});ChartWindow.showChart=function(a,b){if(!ChartWindow.win){ChartWindow.win=new ChartWindow()}Ext.apply(ChartWindow.win,Ext.apply({store:null,datas:null,columnModel:null,url:"",params:null,grid:null},a||{}));ChartWindow.win.show();if(b){b.call(ChartWindow.win)}};SearchResultStatisticsWin=Ext.extend(Ext.Window,{title:"\u67e5\u8be2\u7ed3\u679c\u9884\u89c8",width:300,height:300,layout:"fit",closeAction:"hide",initGrid:function(){var a=[];if(this.data){for(var b in this.data){var c={name:b,value:this.data[b]};a.push(c)}}this.grid.store.removeAll();this.grid.store.loadData(a);if(this.title){this.setTitle(this.title)}},initComponent:function(){this.grid=new Ext.grid.GridPanel({viewConfig:{forceFit:true},store:new Ext.data.JsonStore({fields:["name","value"]}),cm:new Ext.grid.ColumnModel([{header:"\u9879\u76ee\u540d\u79f0",width:100,sortable:false,dataIndex:"name",id:"name",menuDisabled:true},{header:"\u503c",width:100,resizable:false,dataIndex:"value",id:"value",menuDisabled:true}])});SearchResultStatisticsWin.superclass.initComponent.call(this);this.on("show",this.initGrid,this);this.add(this.grid)}});SearchResultStatisticsWin.showWin=function(a){if(!SearchResultStatisticsWin.win){SearchResultStatisticsWin.win=new SearchResultStatisticsWin()}Ext.apply(SearchResultStatisticsWin.win,a);SearchResultStatisticsWin.win.show();return SearchResultStatisticsWin.win};Disco.Ext.MainAppService={IFrameClass:{},NormalClass:{},getSingleTabMode:function(){return window.Global.Config.singleTabMode},openTab:function(a,e){var d=(typeof a=="string"?a:e||a.id);var b=this.getComponent(d);if(b){this.setActiveTab(b)}else{if(typeof a!="string"){if(!this.tabsCheck()){return}a.id=d;var c=this.add(a);if(this.getSingleTabMode()){this.closeAll(c)}this.setActiveTab(c)}}},tabsCheck:function(){if(this.items.getCount()>this.maxTabs){Ext.Msg.alert("\u63d0\u793a","\u7cfb\u7edf\u5141\u8bb8\u540c\u65f6\u6253\u5f00\u7684\u9762\u677f\u6570\u5df2\u7ecf\u8fbe\u5230\u6781\u9650\uff0c\u8bf7\u5148\u5173\u95ed\u5176\u5b83\u4e00\u6253\u5f00\u7684\u9762\u677f\u518d\u91cd\u65b0\u8fdb\u5165");return false}return true},openAppInWin:function(a){a.elements=a.elements.replace(",header","");a.inWinConfig=a.inWinConfig||{};if(!this.appWin){this.appWin=new Ext.Window(Ext.apply({width:Ext.getBody().dom.offsetWidth-20,height:Ext.getBody().dom.offsetHeight-20,closeAction:"hide",layout:"fit",modal:true,maximizable:true,title:a.title,items:a,listeners:{maximize:function(b){b.doLayout()},restore:function(b){b.doLayout()}}},a.inWinConfig));Ext.del(a,"inWinConfig")}else{this.appWin.remove(0);this.appWin.add(a);this.appWin.setSize(a.inWinConfig.width||(Ext.getBody().dom.offsetWidth-20),a.inWinConfig.height||(Ext.getBody().dom.offsetHeight-20));this.appWin.doLayout();this.appWin.setTitle(a.title)}this.appWin.show((typeof main!="undefined")&&Disco_RIA.getCfg("enableAnimate")?Ext.getBody():false,function(b){b.center()})},openExtAppNode:function(b,d){if((!b.attributes.listeners||!b.attributes.listeners.click)&&b.attributes.appClass){var a=Disco.Ext.MainAppService.getClassScriptPath(b);var c=b.attributes.appClass||b.appClass;var f=b.attributes.title?b.attributes.title:b.text;if(Global.Config.iframe&&!b.attributes.frameDisable){main.openExtApp(c,a,f,null,b.attributes.otherScripts,b.attributes.callback,b.attributes.inWin,b.attributes.params)}else{main.openClassApp(c,a,f,c,b.attributes.otherScripts,b.attributes.callback,b.attributes.inWin,b.attributes.params)}}},getClassScriptPath:function(c){var b=c.attributes["package"]?c.attributes["package"]:this["package"];if(!b){b=""}else{b.replace(".","/")}var a=(c.attributes.script?c.attributes.script:this.script);var d=c.attributes.appClass;if(!a){a=d+".js"}a=b+"/"+a;return a},openExtApp:function(id,script,title,appClass,otherScripts,callback,inWin,params){appClass=appClass||id;title=title||id;otherScripts=otherScripts||"";var tab=this.getComponent(id);if(tab){this.setActiveTab(tab)}else{if(!this.tabsCheck()){return}var theParameter=params||{};if(params&&(typeof params=="string")){theParameter=Ext.urlDecode(params)}if(!this.IFrameClass[appClass]){eval("this.IFrameClass."+appClass+"=Ext.extend(ExtAppBasePanel,{id:'"+id+"',title:'"+title+"',appClass:'"+appClass+"',script:'"+script+"',otherScripts:'"+otherScripts+"',params:'"+(Ext.encode(theParameter))+"'});")}if(inWin){this.openAppInWin(new this.IFrameClass[appClass]())}else{eval("var p = this.add(new this.IFrameClass."+appClass+"());");p.on("destroy",new Function("delete IFrames."+appClass));if(this.getSingleTabMode()){this.closeAll(p)}this.setActiveTab(p);if(p){p.doLayout()}}}if(callback){callback()}},openClassApp:function(id,script,title,appClass,otherScripts,callback,inWin,params){appClass=appClass||id;title=title||id;var tab=this.getComponent(id);if(tab){this.setActiveTab(tab);if(callback){callback()}}else{if(!this.tabsCheck()){return}var theParameter=params||{};if(params&&(typeof params=="string")){theParameter=Ext.urlDecode(params)}if(Disco.Ext.MainAppService.NormalClass[appClass]&&!Disco_RIA.devMode){this.openAppHandler(appClass,id,theParameter,title,inWin)}else{function successLoad(req){eval(req.responseText);if(eval(appClass)){this.openAppHandler(appClass,id,theParameter,title,inWin)}}if(otherScripts){var s=otherScripts.split(";");var total=s.length,ld=0;for(var i=0;i<s.length;i++){Ext.Ajax.request({url:s[i],success:function(req){eval(req.responseText);ld++;if(ld>=total){Ext.Ajax.request({waitMsg:"\u6b63\u5728\u52a0\u8f7d\u7a0b\u5e8f\uff0c\u8bf7\u7a0d\u5019\u3002\u3002\u3002",url:Disco_RIA.script+script,success:successLoad,scope:this})}},scope:this})}}else{Ext.Ajax.request({waitMsg:"\u6b63\u5728\u52a0\u8f7d\u7a0b\u5e8f\uff0c\u8bf7\u7a0d\u5019\u3002\u3002\u3002",url:Disco_RIA.script+script,success:successLoad,scope:this})}}if(callback){callback()}}},openAppHandler:function(appClass,id,theParameter,title,inWin){var wrapCls=this.getNormalClass(appClass,id,title);if(wrapCls.superclass.onWindowResize){var win=Ext.getCmp(wrapCls.prototype.id);if(!win){win=new wrapCls(theParameter)}win.show()}else{eval("var tempP = new "+appClass+"(theParameter);if(tempP.list && (typeof tempP.list=='function'))tempP=tempP.list();");if(inWin){var inWinConfig=tempP.inWinConfig||{};Ext.del(tempP,"inWinConfig");this.openAppInWin(new wrapCls({items:tempP,inWinConfig:inWinConfig}))}else{var p=this.add(new wrapCls({items:tempP}));if(this.getSingleTabMode()){this.closeAll(p)}this.setActiveTab(p);if(p){p.doLayout()}}}},getNormalClass:function(appClass,id,title){try{if(typeof eval(appClass)=="undefined"){return}}catch(e){return}var directWin=Disco.Ext.MainAppService.NormalClass[appClass];if(directWin){return directWin}if(eval(appClass+".superclass.onWindowResize")){return eval("Disco.Ext.MainAppService.NormalClass."+appClass+"="+appClass)}return eval("Disco.Ext.MainAppService.NormalClass."+appClass+"=Ext.extend(Ext.Panel,{id:'"+id+"',title:'"+title+"',border:false,layout:'fit',closable:true});")},closeTab:function(a,d){var c=(typeof a=="string"?a:d||a.id);var b=this.getComponent(c);if(b){this.remove(b)}},closeAll:function(a){this.items.each(function(b){if(b.closable&&b!=a){this.closeTab(b)}},this)},savePersonality:function(n,m){var q=[];var o="",b=[];var l=this.getComponent("homePage");if(l&&l.items&&l.getXType()=="ux.portal"){var h=l.items;for(var g=0;g<h.getCount();g++){var k=h.get(g);var a="";for(var e=0;e<k.items.getCount();e++){var f=k.items.get(e);a="id:"+f.getId()+",col:"+g+",row:"+e;b.push({id:f.getId(),col:g,row:e});if(f.customizeUrl){a+=",url:"+f.customizeUrl}if(f.customizeHtml){a+=",html:"+f.customizeHtml}if(f.customizeUrl||f.customizeHtml){a+=",title:"+f.title}o+=a+"@@"}}}var d={portalMode:Disco_RIA.getCfg("portalMode"),maxTabs:Disco_RIA.getCfg("maxTabs"),iframe:Disco_RIA.getCfg("iframe"),singleTabMode:Disco_RIA.getCfg("singleTabMode"),enableAnimate:Disco_RIA.getCfg("enableAnimate"),commonFunction:Disco_RIA.getCfg("commonFunction"),style:Disco_RIA.getCfg("style"),homePage:Disco_RIA.getCfg("homePage"),lang:Disco_RIA.getCfg("lang"),viewMode:Disco_RIA.getCfg("viewMode"),portals:o};if(Disco_RIA.PersonalityUrl){Ext.Ajax.request({url:Disco_RIA.formatUrl(Disco_RIA.PersonalityUrl,"savePersonality"),params:d,waitMsg:m?"":"\u6b63\u5728\u4fdd\u5b58\u6570\u636e,\u8bf7\u7a0d\u5019...",success:function(c){Disco_RIA.setCfg("portalConfig",b);if(!m){Disco.Ext.Msg.alert("\u60a8\u7684\u4e2a\u6027\u5316\u914d\u7f6e\u4fe1\u606f\u5df2\u7ecf\u6210\u529f\u4fdd\u5b58\uff01","\u63d0\u793a",function(){if(n){n()}},this)}else{if(n){n()}}}})}return q},cleanPortlet:function(){var a=this.getComponent("homePage");if(a&&a.items&&a.getXType()=="portal"){for(var b=0;b<a.items.getCount();b++){var c=a.items.get(b);c.items.each(function(d){c.remove(d)})}}},loadPersonality:function(){if(Disco_RIA.PersonalityUrl){Ext.Ajax.request({url:Disco_RIA.formatUrl(Disco_RIA.PersonalityUrl,"loadPersonality"),success:function(b){this.cleanPortlet();var b=Ext.decode(b.responseText);if(b){var a={maxTabs:b.maxTabs,singleTabMode:b.singleTabMode,enableAnimate:b.enableAnimate,style:b.style,homeMenu:b.homePage,viewMode:b.viewMode,commonFunction:b.commonFunctions};b.commonFunction=b.commonFunctions;Ext.apply(this,a);for(var c in b){if(Ext.isDefined(b[c])){Disco_RIA.setCfg(c,b[c])}}if(Ext.isString(this.commonFunction)&&!Ext.isEmpty(this.commonFunction)){this.commonFunction=this.commonFunction.split(/[,;\s]/);a.commonFunction=this.commonFunction}this.fireEvent("loadSystemConfig",a)}var c=Ext.getCmp("homePage");if(c&&c.getXType()=="ux.portal"){c.updatePortalModeHandler()}},scope:this})}},resetPersonality:function(){Ext.Msg.confirm("\u63d0\u793a","\u662f\u5426\u771f\u7684\u8981\u8fd8\u539f\u684c\u9762\u8bbe\u7f6e?",function(a){if(a=="yes"){Ext.Ajax.request({url:"manage.java?cmd=resetPersonality",success:function(b){Ext.Msg.alert("\u63d0\u793a","\u6210\u529f\u8fd8\u539f\u9ed8\u8ba4\u684c\u9762\u8bbe\u7f6e!",function(){this.loadPersonality()},this)},scope:this})}})},resetDesktop:function(){Ext.Msg.confirm("\u63d0\u793a","\u662f\u5426\u771f\u7684\u8981\u8fd8\u539f\u684c\u9762\u8bbe\u7f6e?",function(a){if(a=="yes"){Ext.Ajax.request({url:"manage.java?cmd=resetDesktop",success:function(b){Ext.Msg.alert("\u63d0\u793a","\u6210\u529f\u8fd8\u539f\u9ed8\u8ba4\u684c\u9762\u8bbe\u7f6e!",function(){this.loadPersonality()},this)},scope:this})}})},addPortlet:function(c,f,g,b){var a=this.getComponent("homePage"),e;if(a&&a.getXType()=="ux.portal"){var d=Ext.getObjVal(Global,"Portal.PanelMC");if(d&&d.getCount()){e=d.key(g)}}},changeSkin:function(a){Disco.Ext.Util.applySkin(a)}};Ext.override(Ext.data.JsonWriter,{render:function(c,d,b){if(this.encode===true){Ext.apply(c,d);c[this.meta.root]=Ext.encode(b)}else{var a=Ext.apply({},d);if(Ext.isArray(b)){b=Ext.obj2Arr(b)}if(!Ext.isObject(b)){b={id:b}}Ext.apply(c,b,a)}}});Disco.Ext.CrudRowEditorPanel=Ext.extend(Ext.Panel,{layout:"fit",defaultSortable:true,storeMapping:["id"],gridStore:null,gridStoreAutoLoad:true,gridStoreInitData:null,gridConfig:{},gridViewConfig:{},gridPageSize:20,baseUrl:"",cmdParamName:"cmd",defaultsActions:{create:"save",list:"list",view:"view",update:"update",remove:"remove"},defaultShowButtons:["btn_add","btn_edit","btn_view","btn_remove","btn_refresh","searchField"],extraShowButtons:[],disableShowButtons:["btn_view"],getCmdName:function(a){return this.defaultsActions[a]},getCmdUrl:function(b){var c={},a;c[this.cmdParamName]=this.getCmdName(b);a=Ext.urlAppend(this.baseUrl,Ext.urlEncode(c));return a},clearSearch:function(){this.gridStore.baseParams={};this.gridStore.load({params:{start:0,pageSize:this.gridPageSize}})},crud_operators:[{itemId:"btn_add",name:"btn_add",text:"\u6dfb\u52a0(<u>A</u>)",iconCls:"add",method:"create",cmd:"save",noneSelectRow:true,hidden:true},{itemId:"btn_edit",name:"btn_edit",text:"\u7f16\u8f91(<u>E</u>)",iconCls:"edit",disabled:true,method:"edit",cmd:"update",hidden:true,singleRow:true},{itemId:"btn_view",name:"btn_view",text:"\u67e5\u770b(<u>V</u>)",iconCls:"view",method:"view",disabled:true,hidden:true,singleRow:true},{itemId:"btn_remove",name:"btn_remove",text:"\u5220\u9664(<u>D</u>)",iconCls:"delete",disabled:false,method:"remove",cmd:"remove",hidden:true},{itemId:"btn_refresh",name:"btn_refresh",text:"\u5237\u65b0",iconCls:"refresh",method:"refresh",noneSelectRow:true},{itemId:"btn_advancedSearch",name:"btn_advancedSearch",text:"\u9ad8\u7ea7\u67e5\u8be2(<u>S</u>)",iconCls:"srsearch",method:"advancedSearch",cmd:"list",hidden:true,noneSelectRow:true,clientOperator:true},{itemId:"btn_clearSearch",name:"btn_clearSearch",text:"\u663e\u793a\u5168\u90e8",cls:"x-btn-text-icon",iconCls:"search",noneSelectRow:true,method:"clearSearch",hidden:true},{itemId:"btn_print",name:"btn_print",text:"\u6253\u5370(<u>P</u>)",iconCls:"print-icon",disabled:true,method:"printRecord",hidden:true},{itemId:"btn_export",name:"btn_export",text:"\u5bfc\u51faExcel(<u>O</u>)",iconCls:"export-icon",method:"exportExcel",noneSelectRow:true,hidden:true},{itemId:"btn_import",name:"btn_import",text:"\u5bfc\u5165\u6570\u636e(<u>I</u>)",iconCls:"import-icon",method:"importExcel",noneSelectRow:true,hidden:true},"->",{itemId:"searchField",name:"searchField",type:"searchfield",width:100,noneSelectRow:true,paramName:"searchKey",clientOperator:true}],_getGridButtons:function(){if(!this.grid_CrudButtons){this.grid_CrudButtons=this.crud_operators.concat([])}var a=this.defaultShowButtons.concat(this.extraShowButtons);var b=[];Ext.each(this.grid_CrudButtons,function(c){var d=c.name;if((a.contains(d)&&!this.disableShowButtons.contains(d))||Ext.isString(c)){b.push(c)}},this);return b},_getCheckPermissionsInfo:function(){var b={},e=[],f=[],a=[];var d=this._getGridButtons();var c=this.baseUrl;Ext.each(d,function(g){if(typeof g!="string"){if(!g.clientOperator&&(g.cmd||g.method)){f.push(g.action||c);a.push(g.cmd||g.method||"");e.push(g.name||g.id||"")}}});return{names:e,actions:f,cmds:a}},useOperatorsPermission:function(b){var a=b||this.permissions;var b=[];for(var c=0;c<a.length;c++){b.push(a[c]);var d=this.operators.find(function(f){var e=f.name||f.id;if(e==b[c]){return true}});if(d){d.hidden=false}}this.showOperaterItem(b);this.fireEvent("usepermission",this)},buildCrudOperator:function(){},buildButtons:function(){var d=this._getGridButtons(),c=[];var a=this.defaultShowButtons;var b=[];Ext.each(d,function(i){if(typeof i=="string"){b.push(i)}else{if(!i.showInMenuOnly){var h=this.operatorConfig2Component(i);var f=h.name||h.id;try{if(Ext.isString(h.type)){this[f]=Ext.create(h,h.type)}else{this[f]=new Ext.Toolbar.Button(h)}b.push(this[f])}catch(g){alert(f+":"+g)}}}},this);return b},buildGridStore:function(){var a=this.gridStore;if(!a){a=new Ext.data.JsonStore({root:"result",totalProperty:"rowCount",pageSize:this.gridPageSize,url:this.getCmdUrl("list"),fields:this.storeMapping,restful:false,autoLoad:true,writer:new Ext.data.JsonWriter({encode:false}),proxy:new Ext.data.HttpProxy({api:{update:this.getCmdUrl("update"),create:this.getCmdUrl("create"),destroy:this.getCmdUrl("remove"),read:this.getCmdUrl("list")}})});if(this.gridStoreInitData){a.loadData(this.gridStoreInitData)}else{if(this.gridStoreAutoLoad){a.load()}}}return a},buildGridCm:function(){var a;if(Ext.isArray(this.columns)){a=new Ext.grid.ColumnModel({defaultSortable:this.defaultSortable,columns:this.columns})}return a},onBeforeRowEditor:function(){return this.permissions.contains("btn_edit")},buildGrid:function(){this.rowEditor=new Ext.ux.grid.RowEditor({saveText:"Update",errorSummary:false,listeners:{scope:this,beforeedit:this.onBeforeRowEditor}});this.gridCm=this.buildGridCm();var c={forceFit:true};var d=Ext.apply(c,this.gridViewConfig);var a=Ext.apply({store:this.gridStore,border:false,cm:this.gridCm,sm:this.gridSm,bbar:new Disco.Ext.PagingComBo({displayInfo:true,rowComboSelect:true,store:this.gridStore,pageSize:this.gridPageSize})},this.gridConfig);if(!a.viewConfig){a.viewConfig={}}Ext.apply(a.viewConfig,d);a.plugins=a.plugins||[];a.plugins.push(this.rowEditor);var b=new Ext.grid.GridPanel(a);return b},findOperatorBy:function(b){var a=[];this.operators.each(function(c){if(typeof c!="string"){if(b&&b(c)){a.push(c)}}});return a},findOperatorByProperty:function(a,b){return this.findOperatorBy(function(c){if(c[a]==b){return true}})},toggleSingleRowOperator:function(b){var d=this.findOperatorByProperty("singleRow",true);var a=[];if(d&&d.length){for(var c=0;c<d.length;c++){a.push(d[c].name||d[c].id)}}this[(b?"enable":"disable")+"OperaterItem"](a)},enableOperaterItem:function(){var a=Ext.args();this.getTopToolbar().enables(a)},disableOperaterItem:function(){var a=Ext.args();this.getTopToolbar().disables(a)},showOperaterItem:function(){var a=Ext.args();this.getTopToolbar().shows(a)},hideOperaterItem:function(){var a=Ext.args();this.getTopToolbar().hides(a)},onGridRowSelectionChang:function(f,b,e){var h=this.grid.getSelections();this.toggleSingleRowOperator(!(h&&h.length>1));var d=this.findOperatorByProperty("batch",true);var a=[];if(d&&d.length){for(var c=0;c<d.length;c++){a.push(d[c].name||d[c].id)}}this.enableOperaterItem(a)},operatorConfig2Component:function(c,d){var b=Ext.apply({},c);if(!b.handler){if(b.method&&this[b.method]){b.handler=this[b.method]}}if(b.handler&&!b.scope){b.scope=this}if(!d){if(this.operatorButtonStyle==2){if(b.icon){b.cls="x-btn-icon";b.text=""}}else{if(this.operatorButtonStyle==3){b.icon="";b.cls=""}}}var a=b.name||b.id;if(a=="searchField"){b.store=this.gridStore}else{if(a=="btn_advancedSearch"){b.hidden=!((this.searchFormPanel||this.searchFP)&&this.allowSearch)}}return b},loadOperatorsPermission:function(){if(!this.permissions){var a=this._getCheckPermissionsInfo();if(Disco_RIA.permissionCheck){Ext.Ajax.request({url:(Disco_RIA.permissionCheckAction||"permissionCheck.java"),params:a,callback:function(d,e,b){var c=Ext.decode(b.responseText);if(c&&c.permissions&&c.permissions.length){this.permissions=c.permissions;this.useOperatorsPermission()}if(c&&c.queryObjects){this.addQueryObjectOperator(c.queryObjects)}},scope:this})}else{this.permissions=["btn_add","btn_edit","btn_view","btn_remove","btn_refresh"];this.useOperatorsPermission()}}else{this.useOperatorsPermission()}},initCrudRowEditorEvents:function(){var a=this.grid,b=a.getSelectionModel();b.on("rowselect",this.onGridRowSelectionChang,this,{buffer:200})},create:function(){var a=new this.gridStore.recordType({});this.rowEditor.stopEditing();this.gridStore.insert(0,a);this.rowEditor.startEditing(0)},edit:function(){var a=this.getSingleRow();this.rowEditor.startEditing(a,false);this.rowEditor.doFocus.defer(this.rowEditor.focusDelay,this,[])},view:function(){var a=this.getSingleRow()},remove:function(){var a=this.getSingleRow();this.gridStore.remove(this.gridStore.getAt(a))},refresh:function(){this.grid.getStore().reload()},getSingleRow:function(){var c=this.grid,b=c.getStore();var a=c.getSelections();if(a&&a.length){var d=b.indexOf(a[0])}return d},beforeDestroy:function(){if(this.rowEditor){Ext.destroy(this.rowEditor);delete this.rowEditor}},initComponent:function(){this.gridStore=this.buildGridStore();var a=this.buildButtons();this.operators=new Ext.util.MixedCollection(false,function(b){return b.id||b.name});this.operators.addAll(a);this.tbar=a;this.grid=this.buildGrid();this.items=[this.grid];this.initCrudRowEditorEvents();this.loadOperatorsPermission();Disco.Ext.CrudRowEditorPanel.superclass.initComponent.call(this)}});Disco.Ext.MainTabPanel=Ext.extend(Ext.TabPanel,{singleTabMode:false,iframe:false,enableAnimate:false,resizeTabs:true,minTabWidth:65,tabWidth:120,enableTabScroll:true,activeTab:0,maxTabs:10,initComponent:function(){Disco.Ext.MainTabPanel.superclass.initComponent.call(this)}});Ext.apply(Disco.Ext.MainTabPanel.prototype,{},Disco.Ext.MainAppService);Disco.Ext.MainSinglePanel=Ext.extend(Ext.Panel,{iframe:false,maxTabs:10,singleTabMode:true,enableAnimate:true,layout:"fit",homeMenu:"menu",theStyle:"ext-all",setActiveTab:function(a){a.show();a.ownerCt.doLayout()},getActiveTab:function(){return this.getComponent(0)},getSingleTabMode:function(){return true},closeAll:function(a){this.items.each(function(b){if(b!=a){this.closeTab(b)}},this)},initComponent:function(){Disco.Ext.MainSinglePanel.superclass.initComponent.call(this)}});Ext.apply(Disco.Ext.MainSinglePanel.prototype,{},Disco.Ext.MainAppService);Ext.namespace("Ext.ux.plugins");Disco.Ext.PagingComBo=Ext.extend(Ext.PagingToolbar,{displayMsg:"\u7b2c{0}-{1}\u6761&nbsp;&nbsp;\u5171{2}\u6761&nbsp;&nbsp;&nbsp;&nbsp;\u5171{3}\u9875",style:"font-weight:900",rowComboSelect:true,displayInfo:true,doLoad:function(c){var b={},a=this.getParams()||{};b[a.start]=c;b[a.limit]=this.pageSize;if(this.store.baseParams&&this.store.baseParams[a.limit]){this.store.baseParams[a.limit]=this.pageSize}if(this.fireEvent("beforechange",this,b)!==false){this.store.load({params:b})}},onPagingSelect:function(e,a,b){var f=this.getPageData(),c;c=this.readPage(f);if(c!==false){c=Math.min(Math.max(1,a.data.pageIndex),f.pages)-1;this.doLoad(c*this.pageSize)}},readPage:Ext.emptyFn,onLoad:function(a,e,h){var g=this.getPageData(),c=g.activePage,f=g.pages;this.combo.store.removeAll();if(f==0){this.combo.store.add(new Ext.data.Record({pageIndex:1}));this.combo.setValue(1)}else{for(var b=0;b<f;b++){this.combo.store.add(new Ext.data.Record({pageIndex:b+1}))}this.combo.setValue(c)}if(this.rowComboSelect){this.rowcombo.setValue(this.pageSize)}Disco.Ext.PagingComBo.superclass.onLoad.apply(this,arguments)},updateInfo:function(){if(this.displayItem){var a=this.store.getCount();var c=this.getPageData().activePage;var b=a==0?this.emptyMsg:String.format(this.displayMsg,this.cursor+1,this.cursor+a,this.store.getTotalCount(),Math.ceil(this.store.getTotalCount()/this.pageSize),c);this.displayItem.setText(b)}},onComboPageSize:function(f,b,c){var a=b.get("pageSize");this.store.pageSize=this.pageSize=a;var g=this.getPageData(),e;e=this.readPage(g);if(e!==false){e=Math.min(Math.max(1,b.data.pageIndex),g.pages)-1;this.doLoad(0)}},initComponent:function(){if(Ext.getObjVal(this.store,"pageSize")){this.pageSize=Ext.getObjVal(this.store,"pageSize")}this.combo=Ext.ComponentMgr.create(Ext.applyIf(this.combo||{},{value:1,width:50,store:new Ext.data.SimpleStore({fields:["pageIndex"],data:[[1]]}),mode:"local",xtype:"combo",minListWidth:50,allowBlank:false,triggerAction:"all",displayField:"pageIndex",allowDecimals:false,allowNegative:false,enableKeyEvents:true,selectOnFocus:true,submitValue:false}));this.combo.on("select",this.onPagingSelect,this);this.combo.on("specialkey",function(){this.combo.setValue(this.combo.getValue())},this);var a=Ext.Toolbar;var d=[];if(this.displayInfo){d.push(this.displayItem=new a.TextItem({}))}if(this.rowComboSelect){var c=this.rowComboData?this.rowComboData:[[10],[20],[30],[50],[80],[100],[150],[200]];this.rowcombo=this.rowcombo||Ext.create({store:new Ext.data.SimpleStore({fields:["pageSize"],data:c}),value:this.pageSize,width:50,mode:"local",xtype:"combo",allowBlank:false,minListWidth:50,displayField:"pageSize",triggerAction:"all"});d.push(this.rowcombo,"\u6761/\u9875&nbsp;&nbsp;");this.rowcombo.on("select",this.onComboPageSize,this);this.rowcombo.on("specialkey",function(){this.combo.setValue(this.combo.getValue())},this)}d.push("->",this.first=new a.Button({tooltip:this.firstText,overflowText:this.firstText,iconCls:"x-tbar-page-first",disabled:true,handler:this.moveFirst,scope:this}),this.prev=new a.Button({tooltip:this.prevText,overflowText:this.prevText,iconCls:"x-tbar-page-prev",disabled:true,handler:this.movePrevious,scope:this}),"-",this.beforePageText,this.inputItem=this.combo,this.afterTextItem=new a.TextItem({text:String.format(this.afterPageText,1)}),"-",this.next=new a.Button({tooltip:this.nextText,overflowText:this.nextText,iconCls:"x-tbar-page-next",disabled:true,handler:this.moveNext,scope:this}),this.last=new a.Button({tooltip:this.lastText,overflowText:this.lastText,iconCls:"x-tbar-page-last",disabled:true,handler:this.moveLast,scope:this}),"-",this.refresh=new a.Button({tooltip:this.refreshText,overflowText:this.refreshText,iconCls:"x-tbar-loading",handler:this.doRefresh,scope:this}));var b=this.items||this.buttons||[];if(this.prependButtons===true){this.items=b.concat(d)}else{if(Ext.isNumber(this.prependButtons)){d.splice.apply(d,[this.prependButtons,0].concat(b));this.items=d}else{this.items=d.concat(b)}}delete this.buttons;Ext.PagingToolbar.superclass.initComponent.call(this);this.addEvents("change","beforechange");this.on("afterlayout",this.onFirstLayout,this,{single:true});this.cursor=0;this.bindStore(this.store,true)}});Ext.ux.PagingComBo=Disco.Ext.PagingComBo;Ext.reg("pagingComBo",Ext.ux.PagingComBo);Ext.grid.ObjectColumn=Ext.extend(Ext.grid.Column,{field:"",emptyText:"",constructor:function(a){Ext.grid.ObjectColumn.superclass.constructor.call(this,a);var c=this.emptyText,b=this.field;this.renderer=function(d){if(d){if(!Ext.isArray(b)){return Ext.value(Ext.getObjVal(d,b),c)}else{for(var e=0;e<b.length;e++){if(d.hasOwnProperty(b[e])){return Ext.value(d[b[e]],c)}}}}return c}}});Ext.grid.Column.types.objectcolumn=Ext.grid.ObjectColumn;Ext.apply(Ext.form.Field.prototype,{plugins:new Disco.Ext.HelpIconPlugin()});Ext.Ajax.on("beforerequest",function(b,a){if(a.waitMsg){Ext.Msg.wait(a.waitMsg,a.waitTitle||"\u8bf7\u7a0d\u5019...")}});Ext.Ajax.on("requestcomplete",function(c,a,b){if(a&&a.getResponseHeader&&a.getResponseHeader("LoginRequired")){Disco.Ext.Msg.alert("\u5bf9\u4e0d\u8d77\uff0c\u60a8\u8fd8\u6ca1\u6709\u767b\u5f55\u6216\u8005\u767b\u5f55\u8d85\u65f6\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\uff01","\u63d0\u793a",function(){if(!Disco.Ext.LoginWin){var e=window.top?window.top:window;if(e.relogin&&!Disco.Ext.isLogin){Disco.Ext.isLogin=true;e.relogin()}else{if(!e.relogin){e.location.href=""}}}else{if(!Disco.Ext.isLogin){Disco.Ext.isLogin=true;var d=new Disco.Ext.LoginWin();d.show()}}});return}if(a&&a.getResponseHeader&&a.getResponseHeader("Unauthorized")){Disco.Ext.Msg.alert("\u4f60\u6ca1\u6709\u8be5\u9879\u64cd\u4f5c\u7684\u6743\u9650\uff0c\u8bf7\u4e0e\u7ba1\u7406\u5458\u8054\u7cfb\uff01","\u8b66\u544a");return}if(b.waitMsg){Ext.MessageBox.updateProgress(1);Ext.MessageBox.hide()}});Ext.Ajax.on("requestexception",function(f,a,b){var e=a.status||0;var c=Disco.Ext.Msg;switch(e){case 0:case 12002:case 12029:case 12030:case 12031:case 12152:case 13030:c.error("\u60a8\u7684\u7f51\u7edc\u8fde\u63a5\u53d1\u751f\u4e2d\u65ad!","\u901a\u8baf\u5f02\u5e38!","\u8b66\u544a");return false;break;case -1:return false;break;case 403:Disco.Ext.Msg.alert("\u60a8\u6ca1\u6709\u64cd\u4f5c\u7684\u6743\u9650\uff0c\u8bf7\u4e0e\u7ba1\u7406\u5458\u8054\u7cfb!"+e,"\u8b66\u544a!");return false;break;default:if(e<200||e>=300){var g=Ext.decode(a.responseText);var d="\u53d1\u751f\u4e86\u5176\u5b83\u901a\u8baf\u5f02\u5e38\uff0c\u5f02\u5e38\u72b6\u6001\u7f16\u7801\u4e3a"+e+"\u8b66\u544a!";Disco_RIA.ajaxErrorHandler(g);return false}}return true});new Ext.KeyMap(document.documentElement,[{key:Ext.EventObject.BACKSPACE,fn:function(b,c){var a=/(?:INPUT|TEXTAREA)/;if(!a.test(c.getTarget().nodeName)){c.stopEvent()}}}]);
